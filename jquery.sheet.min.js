var jQuery=window.jQuery||{};var Sheet=(function(d,l,f,a,p,s,t,g,b,q){var k={defaultTheme:0,themeRollerTheme:0,bootstrapTheme:1,customTheme:2,excelSelectModel:0,googleDriveSelectModel:1,openOfficeSelectModel:2};k.CellRange=(function(){function u(v){this.cells=v||[]}u.prototype={clone:function(){var z=[],x=this.cells,w=x.length,v,A;for(var y=0;y<w;y++){v=x[y];A={value:v.value,formula:v.formula,td:v.td,dependencies:v.dependencies,needsUpdated:v.needsUpdated,calcCount:v.calcCount,sheet:v.sheet,calcLast:v.calcLast,html:v.html,state:v.state,jS:v.jS,calcDependenciesLast:v.calcDependenciesLast,style:v.style,cl:v.cl,id:v.id};z.push(A)}return new u(z)}};return u})();k.ActionUI=(function(u,x,v,w,y){var z=function(F,J,P,G,B,L){this.enclosure=F;this.pane=J;this.table=P;this.max=L;this.xIndex=0;this.yIndex=0;this.scrollAxis={x:{},y:{}};this.scrollSize={};this.hiddenColumns=[];this.hiddenRows=[];if(!(this.frozenAt=B)){this.frozenAt={row:0,col:0}}this.frozenAt.row=v.max(this.frozenAt.row,0);this.frozenAt.col=v.max(this.frozenAt.col,0);this.scrolledArea={start:{row:v.max(this.frozenAt.row,1),col:v.max(this.frozenAt.col,1)},end:{row:v.max(this.frozenAt.row,1),col:v.max(this.frozenAt.col,1)}};var E=this,I="#"+P.getAttribute("id"),Q=this.scrollUI=J.scrollOuter=u.createElement("div"),N=J.scrollInner=u.createElement("div"),D=J.scrollStyleX=this.scrollStyleX=new k.StyleUpdater(function(U,V){U=U||[];if(U.length!==E.xIndex||V){E.xIndex=U.length||E.xIndex;if(V===undefined){var T=E.frozenAt.col;V=this.nthCss("col",I,U,E.frozenAt.col+1)+this.nthCss("*",I+" tr",U,E.frozenAt.col+1)+I+" tr *:nth-child("+(U[0]+20)+") ~ * {display: none;}"}this.setStyle(V);if(U.length){E.scrolledArea.start.col=v.max(U.pop()||1,1);E.scrolledArea.end.col=v.max(U.shift()||1,1)}return true}return false},L),C=J.scrollStyleY=this.scrollStyleY=new k.StyleUpdater(function(T,U){T=T||[];if(T.length!==E.yIndex||U){E.yIndex=T.length||E.yIndex;if(U===undefined){var V=E.frozenAt.row;U=this.nthCss("tr",I,T,E.frozenAt.row+1)+I+" tr:nth-child("+(T[0]+40)+") ~ * {display: none;}"}this.setStyle(U);if(T.length){E.scrolledArea.start.row=v.max(T.pop()||1,1);E.scrolledArea.end.row=v.max(T.shift()||1,1)}return true}return false});Q.setAttribute("class",G);Q.appendChild(N);y(Q).disableSelectionSpecial();J.appendChild(D.styleElement);J.appendChild(C.styleElement);var M,R,O,S,H,K,A=P.tBody.children[0];J.resizeScroll=function(T){if(T){M=D.getStyle();R=C.getStyle()}else{M=(P.clientWidth<=F.clientWidth?"":D.getStyle());R=(P.clientHeight<=F.clientHeight?"":C.getStyle())}D.update(null," ");C.update(null," ");if(A===undefined){A=P.tBody.children[0]}O=(A.clientWidth||P.clientWidth)+"px";S=P.clientHeight+"px";H=F.clientWidth+"px";K=F.clientHeight+"px";N.style.width=O;N.style.height=S;Q.style.width=H;Q.style.height=K;E.scrollStart("x");E.scrollStart("y");D.update(null,M);C.update(null,R);if(J.inPlaceEdit){J.inPlaceEdit.goToTd()}};new MouseWheel(J,Q)};z.prototype={putTdInView:function(F){var B=0,A=0,E=0,D,C;this.xIndex=0;this.yIndex=0;while((D=this.directionToSeeTd(F))!==null){C=this.scrolledArea.end;if(D.left){A--;this.scrollTo({axis:"x",value:C.col-1})}else{if(D.right){A++;this.scrollTo({axis:"x",value:C.col+1})}}if(D.up){E--;this.scrollTo({axis:"y",value:C.row-1})}else{if(D.down){E++;this.scrollTo({axis:"y",value:C.row+1})}}B++;if(B<25){break}this.scrollStop()}},directionToSeeTd:function(B){var A=this.pane,K={top:0,bottom:A.clientHeight,left:0,right:A.clientWidth},G=B.clientWidth,E=B.clientHeight,I={top:B.offsetTop,bottom:B.offsetTop+E,left:B.offsetLeft,right:B.offsetLeft+G},C=B.parentNode,H=this.scrolledArea.end;if(!B.col){return null}var J=B.barTop.cellIndex<H.col,D=C.rowIndex<H.row,F={up:D,down:I.bottom>K.bottom&&E<=A.clientHeight,left:J,right:I.right>K.right&&G<=A.clientWidth};if(F.up||F.down||F.left||F.right){return F}return null},redraw:function(){var A=this.pane.style;A.opacity=0.9999;setTimeout(function(){A.opacity=1},0)},hide:function(A,H,K,C){var F=this,G="#"+this.table.getAttribute("id"),J=this.toggleHideStyleX=new k.StyleUpdater(function(){var L=this.nthCss("col",G,F.hiddenColumns,0)+this.nthCss("td",G+" tr",F.hiddenColumns,0);this.setStyle(L)}),I=this.toggleHideStyleY=new k.StyleUpdater(function(){var L=this.nthCss("tr",G,F.hiddenRows,0);this.setStyle(L)}),E,D,B=this.pane;B.appendChild(J.styleElement);B.appendChild(I.styleElement);this.hiddenRows=[];this.hiddenColumns=[];if(A){E=A.length-1;if(E>-1){do{D=A[E];this.toggleHideRow(K[D],D)}while(E--)}}if(H){E=H.length-1;if(E>-1){do{D=H[E];this.toggleHideColumn(C[D],D)}while(E--)}}},remove:function(){},scrollStart:function(F){var G=this.pane,D=G.scrollOuter,E=this.scrollAxis[F],C=this.scrollSize=G.size();E.v=[];E.name=F;switch(F||"x"){case"x":E.value=0;E.max=C.cols;E.min=0;E.size=C.cols;G.scrollStyleX.update();E.scrollStyle=G.scrollStyleX;E.area=D.scrollWidth-D.clientWidth;E.sheetArea=G.table.clientWidth-G.table.corner.clientWidth;E.scrollUpdate=function(){D.scrollLeft=(E.value)*(E.area/E.size)};E.gridSize=100/E.size;break;case"y":E.value=0;E.max=C.rows;E.min=0;E.size=C.rows;G.scrollStyleY.update();E.scrollStyle=G.scrollStyleY;E.area=D.scrollHeight-D.clientHeight;E.sheetArea=G.table.clientHeight-G.table.corner.clientHeight;E.scrollUpdate=function(){D.scrollTop=(E.value)*(E.area/E.size)};E.gridSize=100/E.size;break}var B=E.max;do{var A=new w(E.gridSize*B);A.index=B+1;E.v.unshift(A)}while(B--)},scrollTo:function(D){D=D||{};D.axis=D.axis||"x";D.value=D.value||0;D.pixel=D.pixel||0;if(!this.scrollAxis){this.scrollStart(D.axis)}var C=this.scrollAxis[D.axis];if(!D.value){D.value=c.closest(C.v,v.abs(D.pixel/C.area)*100,C.min).index}D.max=D.max||C.max;var B=((D.value>D.max?D.max:D.value)-C.min),A=[];if(B>=0){do{A.push(B+C.min)}while(B-->0)}C.value=D.value;if(A.length){if(C.scrollStyle){return C.scrollStyle.update(A)}}else{if(C.scrollStyle){return C.scrollStyle.update()}}return false},scrollStop:function(){if(this.scrollAxis.x.scrollUpdate){this.scrollAxis.x.scrollUpdate()}if(this.scrollAxis.y.scrollUpdate){this.scrollAxis.y.scrollUpdate()}},toggleHideRow:function(C,B){var A=y(C);B=v.max(B+1,1);if(A.length&&y.inArray(B,this.hiddenRows)<0){this.hiddenRows.push(B)}else{this.hiddenRows.splice(this.hiddenRows.indexOf(B),1)}this.toggleHideStyleY.update()},rowShowAll:function(){y.each(this.hiddenRows||[],function(A){y(this).removeData("hidden")});this.toggleHideStyleY.setStyle("");this.hiddenRows=[]},toggleHideColumn:function(A,B){var C=y(A);B=v.max(B+1,1);if(C.length&&y.inArray(B,this.hiddenColumns)<0){this.hiddenColumns.push(B)}else{this.hiddenColumns.splice(this.hiddenColumns.indexOf(B),1)}this.toggleHideStyleX.update()},columnShowAll:function(){this.toggleHideStyleX.setStyle("");this.hiddenColumns=[]}};return z})(l,f,g,s,d);k.SpreadsheetUI=(function(){var u=[];function v(x,z,y,w){w=w||{};this.i=x;this.ui=z;this.table=y;this.isLast=w.lastIndex===x;this.enclosure=null;this.pane=null;this.spreadsheet=null;this.sizeCheck=w.sizeCheck||function(){};this.initChildren=w.initChildren||function(){};this.done=w.done||function(){};this.sizeCheck(this)}v.prototype={load:function(){var w=this.table;this.initChildren(this.ui,w,this.i);w.pane.ui=this.ui;this.enclosure=w.enclosure;this.pane=w.pane;this.spreadsheet=w.spreadsheet;u.push(this.i);if(this.isLast){this.loaded()}},loaded:function(){this.done(u,this)}};return v})();k.Theme=(function(u){function v(w){w=w||k.defaultTheme;switch(w){case k.customTheme:this.cl=v.customClasses;break;case k.bootstrapTheme:this.cl=v.bootstrapClasses;break;default:case k.themeRollerTheme:this.cl=v.themeRollerClasses;break}u.extend(this,this.cl)}v.themeRollerClasses={autoFiller:"ui-state-active",bar:"ui-widget-header",barHighlight:"ui-state-active",barHandleFreezeLeft:"ui-state-default",barHandleFreezeTop:"ui-state-default",barMenuTop:"ui-state-default",tdActive:"ui-state-active",tdHighlighted:"ui-state-highlight",control:"ui-widget-header ui-corner-top",controlTextBox:"ui-widget-content",fullScreen:"ui-widget-content ui-corner-all",inPlaceEdit:"ui-state-highlight",menu:"ui-widget-header",menuFixed:"",menuUl:"ui-widget-header",menuLi:"ui-widget-header",menuHover:"ui-state-highlight",pane:"ui-widget-content",parent:"ui-widget-content ui-corner-all",table:"ui-widget-content",tab:"ui-widget-header",tabActive:"ui-state-highlight",barResizer:"ui-state-highlight",barFreezer:"ui-state-highlight",barFreezeIndicator:"ui-state-highlight"};v.bootstrapClasses={autoFiller:"btn-info",bar:"bg-primary",barHighlight:"label-info",barHandleFreezeLeft:"bg-warning",barHandleFreezeTop:"bg-warning",barMenuTop:"bg-warning",tdActive:"active",tdHighlighted:"bg-info",control:"bg-primary",controlTextBox:"form-control",fullScreen:"",inPlaceEdit:"form-control",menu:"panel panel-default",menuFixed:"nav navbar-nav",menuUl:"panel-info",menuLi:"active",menuHover:"bg-primary active",pane:"well",parent:"panel panel-default",table:"table table-bordered table-condensed",tab:"btn-default btn-xs",tabActive:"active",barResizer:"bg-info",barFreezer:"bg-warning",barFreezeIndicator:"bg-warning"};v.customClasses={autoFiller:"",bar:"",barHighlight:"",barHandleFreezeLeft:"",barHandleFreezeTop:"",barMenuTop:"",tdActive:"",tdHighlighted:"",control:"",controlTextBox:"",fullScreen:"",inPlaceEdit:"",menu:"",menuFixed:"",menuUl:"",menuLi:"",menuHover:"",pane:"",parent:"",table:"",tab:"",tabActive:"",barResizer:"",barFreezer:"",barFreezeIndicator:""};return v})(jQuery);k.Highlighter=(function(u,v,w){var x=function(z,B,y,A){this.cssClass=z;this.cssClassBars=B;this.cssClassTabs=y;this.callBack=A||function(){};this.last=w([]);this.lastTop=w([]);this.lastLeft=w([]);this.lastTab=w([]);this.start={row:0,col:0};this.end={row:0,col:0}};x.prototype={set:function(A){if(A.parentNode!==undefined){A=[A]}var y,z=this.last;if(z&&z.length>0){y=z.length-1;do{z[y].isHighlighted=false}while(y-->0)}if(A.length>0){y=A.length-1;do{if(!A[y].isHighlighted){A[y].isHighlighted=true;if(!A[y].className.match(this.cssClass)){A[y].className+=" "+this.cssClass}}}while(y-->0)}this.clear(z);this.last=A;this.callBack();return this},is:function(){return this.last.length>0},clear:function(z){if(this.is()){z=z||this.last;if(z&&z.length){var y=z.length-1;do{if(!z[y].isHighlighted){z[y].className=z[y].className.replace(this.cssClass,"");z[y].isHighlighted=false}}while(y-->0)}}this.last=w([]);return this},setBar:function(y,z){switch(y){case"top":this.lastTop.removeClass(this.cssClassBars);this.lastTop=w(z).addClass(this.cssClassBars);break;case"left":this.lastLeft.removeClass(this.cssClassBars);this.lastLeft=w(z).addClass(this.cssClassBars);break}return this},clearBar:function(){this.lastTop.removeClass(this.cssClassBars);this.lastTop=w([]);this.lastLeft.removeClass(this.cssClassBars);this.lastLeft=w([]);return this},setTab:function(y){this.clearTab();this.lastTab=y.addClass(this.cssClassTabs);return this},clearTab:function(){this.lastTab.removeClass(this.cssClassTabs);return this},setStart:function(y){this.start=y;return this},setEnd:function(y){this.end=y;return this}};return x})(l,f,jQuery);k.ColumnAdder=(function(){function u(){this.qty=-1;this.addedFinishedFn=null;this.createBarFn=null;this.createCellFn=null}u.prototype={setQty:function(x,w){var v=d.sheet.max;if(v){if(v>w.cols&&v<=w.cols+x){this.qty=v-w.cols}else{if(v&&v<=w.cols+x){return false}}}else{this.qty=x}return true},setAddedFinishedFn:function(v){this.addedFinishedFn=v},setCreateBarFn:function(v){this.createBarFn=v},setCreateCellFn:function(v){this.createCellFn=v},createCells:function(A,D,z){var y=(z?0:1),v=D.rows||1,x=A+this.qty,C,w=A,B;for(;w<x;w++){B=this.createBarFn(w+y);for(C=1;C<=v;C++){this.createCellFn(C,w+y,B)}}if(this.addedFinishedFn!==null){this.addedFinishedFn({row:0,col:this.qty})}}};return u})();k.RowAdder=(function(){function u(){this.qty=-1;this.addedFinishedFn=null;this.createBar=null;this.createCell=null}u.prototype={setQty:function(y,w,x){var v=d.sheet.max;if(v){if(v>w.rows&&v<=w.rows+y){this.qty=v-w.rows}else{if(v&&v<=w.rows+y){return false}}}else{this.qty=y}return true},setAddedFinishedFn:function(v){this.addedFinishedFn=v},setCreateBarFn:function(v){this.createBar=v},setCreateCellFn:function(v){this.createCell=v},createCells:function(A,D,z){var y=(z?0:1),v=A+this.qty,x=D.cols||1,B,C=A,w;for(;C<v;C++){B=this.createBar(C+y);for(w=1;w<=x;w++){this.createCell(C+y,w,B)}}if(this.addedFinishedFn!==null){this.addedFinishedFn({row:this.qty,col:0})}}};return u})();k.StyleUpdater=(function(u){function v(x,w){var y=this.styleElement=u.createElement("style");y.styleUpdater=this;this.update=x;if(k.StyleUpdater.prototype.nthCss===null){if(w){k.StyleUpdater.prototype.nthCss=function(z,G,B,D,C){var E=[],A=B.length,F=this.repeat;C=C||"{display: none;}";do{if(B[A]>D){E.push(G+" "+z+":first-child"+F("+"+z,B[A]-1))}}while(A--);if(E.length){return E.join(",")+C}return""}}else{k.StyleUpdater.prototype.nthCss=function(z,F,B,D,C){var E=[],A=B.length;C=C||"{display: none;}";do{if(B[A]>D){E.push(F+" "+z+":nth-child("+B[A]+")")}}while(A--);if(E.length){return E.join(",")+C}return""}}}}if(u.createElement("style").styleSheet){v.prototype={setStyle:function(x){var y=this.styleElement,w=y.styleSheet;w.disabled=false;if(!w.disabled){w.cssText=x}},getStyle:function(){var x=this.styleElement,w=x.styleSheet;w.disabled=false;if(!w.disabled){return w.cssText}return""}}}else{v.prototype={setStyle:function(w){this.styleElement.innerHTML=w},getStyle:function(){return this.styleElement.innerHTML}}}v.prototype.nthCss=null;v.prototype.repeat=function(y,x){var w="";while(x>0){if(x&1){w+=y}x>>=1;y+=y}return w};return v})(l);k.JSONLoader=(function(w,u,v){function x(y){if(y!==undefined){this.json=y;this.count=y.length}else{this.json=[];this.count=0}}x.prototype={size:function(B){var A={cols:0,rows:0},z=this.json,D,C,E,y;if((D=z[B])===undefined){return A}if((C=D.rows)===undefined){return A}if((E=C[0])===undefined){return A}if((y=E.columns)===undefined){return A}return{rows:C.length,cols:y.length}},setWidth:function(y,C,F){var A=this.json,E=A[y],z=E.metadata||{},D=z.widths||[],B=D[C];F.style.width=B+"px"},setRowHeight:function(z,F,C){var A=this.json,D,B,E,y;if((D=A[z])===undefined){return}if((B=D.rows)===undefined){return}if((E=B[F])===undefined){return}if((y=E.height)===undefined){return}C.style.height=y+"px"},setupCell:function(A,F,C,z){var E=u.createElement("td"),D=this.getCell(A,F,C),y,B;if(D!==null){if(D.getCell!==undefined){y=D.getCell();if(y.formula){E.setAttribute("data-formula",y.formula||"");if(y.hasOwnProperty("result")&&y.result!==null){B=y.result.hasOwnProperty("html")?y.result.html:y.result;switch(typeof B){case"object":if(B.appendChild!==undefined){E.appendChild(B);break}case"string":default:E.innerHTML=B;break}}}else{E.innerHTML=y.value}}else{y=z(E);y.value=D.value;if(D.formula){y.formula=D.formula||"";E.setAttribute("data-formula",D.formula||"")}else{E.innerHTML=D.value}}E.className=D["class"]||"";E.setAttribute("style",D.style||"");if(D.rowspan){E.setAttribute("rowspan",D.rowspan||"")}if(D.colspan){E.setAttribute("colspan",D.colspan||"")}if(D.uneditable){E.setAttribute("data-uneditable",D.uneditable||"")}if(D.id){E.setAttribute("id",D.id)}}else{y=z(E)}E.jSCell=y;y.td=E;return y},getCell:function(z,F,B){var A=this.json,D,C,E,y;if((D=A[z])===undefined){return null}if((C=D.rows)===undefined){return null}if((E=C[F-1])===undefined){return null}if((y=E.columns[B-1])===undefined){return null}return y},jitCell:function(y,D,z,B){var C,A;if(B===undefined){B=this.getCell(y,D,z)}if(B===null){return null}if(B.getCell!==undefined){return B.getCell()}A=B.value;C={td:null,html:[],state:[],calcCount:0,calcLast:-1,calcDependenciesLast:-1,cellType:B.cellType||"",formula:B.formula||"",value:(A!==undefined&&A!==null?new v(A):new v()),uneditable:B.uneditable,type:"cell",sheet:y,dependencies:[],id:null,loadedFrom:B};C.value.cell=C;B.getCell=function(){return C};return C},title:function(y){var z=this.json,A;if((A=z[y])===undefined){return""}return A.title||""},hasSpreadsheetAtIndex:function(y){return(this.json[y]!==undefined)},getSpreadsheetIndexByTitle:function(B){var A=this.json,y=this.count,z=0;for(;z<y;z++){if(A[z].title==B){return z}}return -1},addSpreadsheet:function(z,y){if(y===undefined){this.json.push(z)}else{this.json.splice(y,0,z)}this.count=this.json.length},getCellAttribute:function(y,z){return y[z]},setCellAttribute:function(y,z,A){y[z]=A},cycleCells:function(E,D){var F=this.json,B,H,z,y,G,C,A;if((B=F[E])===undefined){return}if((C=(H=B.rows).length)<1){return}if(H[0].columns.length<1){return}C--;do{G=H[C];z=G.columns;A=z.length-1;do{y=z[A];D.call(this.jitCell(E,C,A,y),E,C,A)}while(A-->0)}while(C-->0)},cycleCellsAll:function(A){var z=this.json,y=z.length-1;if(y<0){return}do{this.cycleCells(y,A)}while(y-->0)},toTables:function(){var Q=this.json,G=w([]),D,I,E,A,B,K,J,M,y,L,R,H,C,z,F,P,O,N;for(P=0;P<Q.length;P++){D=Q[P];R=w(u.createElement("table"));if(D.title){R.attr("title",D.title||"")}G=G.add(R);I=D.rows;for(O=0;O<I.length;O++){E=I[O];if(L=(E.height+"").replace("px","")){z=w(u.createElement("tr")).attr("height",L).css("height",L+"px").appendTo(R)}A=E.columns;for(N=0;N<A.length;N++){B=A[N];F=w(u.createElement("td")).appendTo(z);if(B["class"]){F.attr("class",B["class"]||"")}if(B.style){F.attr("style",B.style||"")}if(B.formula){F.attr("data-formula",(B.formula?"="+B.formula:""))}if(B.cellType){F.attr("data-celltype",B.cellType||"")}if(B.value){F.html(B.value||"")}if(B.uneditable){F.html(B.uneditable||"")}if(B.rowspan){F.attr("rowspan",B.rowspan||"")}if(B.colspan){F.attr("colspan",B.colspan||"")}if(B.id){F.attr("id",B.id||"")}if(B.cache){F.html(B.cache)}}}if(K=D.metadata){if(J=K.widths){H=w(u.createElement("colgroup")).prependTo(R);for(N=0;N<J.length;N++){M=(J[N]+"").replace("px","");C=w(u.createElement("col")).attr("width",M).css("width",M+"px").appendTo(H)}}if(y=K.frozenAt){if(y.row){R.attr("data-frozenatrow",y.row)}if(y.col){R.attr("data-frozenatcol",y.col)}}}}return G},fromSheet:function(H,C){C=(C==undefined?false:C);var K=[],P=1*H.i,D=H.spreadsheets.length-1,Q,F,G,B,I,O,A,y,M,J,L,N,E,z;if(D<0){return K}do{N=false;H.i=D;H.evt.cellEditDone();Q={title:(H.obj.table().attr("title")||""),rows:[],metadata:{widths:[],frozenAt:w.extend({},H.obj.pane().actionUI.frozenAt)}};K.unshift(Q);F=H.spreadsheets[D];G=F.length-1;do{E=F[G][1].td[0].parentNode;z=E.style.height;O={columns:[],height:(z?z.replace("px",""):H.s.colMargin)};B=F[G].length-1;do{y=F[G][B];A={};M=y.td[0].attributes;if(C||N||M["class"]||y.formula||y.value||M.style){N=true;J=(M["class"]?w.trim((M["class"].value||"").replace(H.cl.uiCellActive,"").replace(H.cl.uiCellHighlighted,"")):"");L=y.td[0].parentNode;O.columns.unshift(A);if(!O.height){O.height=(L.style.height?L.style.height.replace("px",""):H.s.colMargin)}if(y.formula){A.formula=y.formula}if(y.cellType){A.cellType=y.cellType}if(y.value){A.value=y.value}if(y.uneditable){A.uneditable=y.uneditable}if(y.cache){A.cache=y.cache}if(y.id){A.id=y.id}if(M.style&&M.style.value){A.style=M.style.value}if(J.length){A["class"]=J}if(M.rowspan){A.rowspan=M.rowspan.value}if(M.colspan){A.colspan=M.colspan.value}if(G*1==1){Q.metadata.widths.unshift(w(H.col(null,B)).css("width").replace("px",""))}}}while(B-->1);if(N){Q.rows.unshift(O)}}while(G-->1)}while(D--);H.i=P;return this.json=K}};return x})(jQuery,l,p);k.XMLLoader=(function(v,u){function w(x){if(x!==undefined){this.xml=v.parseXML(x);this.spreadsheets=this.xml.getElementsByTagName("spreadsheets")[0].getElementsByTagName("spreadsheet");this.count=this.xml.length}else{this.xml=null;this.spreadsheets=null;this.count=0}}w.prototype={size:function(z){var x=this.xml[z],A=x.rows,B=A[0],y=B.columns;return{rows:A.length,cols:y.length}},setWidth:function(F,C,A){var B=this.spreadsheets,E=B[F],D=E.getElementsByTagName("metadata")[0]||{},y=D.getElementsByTagName("width")||[],z=y[C],x=(z.textContent||z.text);A.style.width=x+"px"},setRowHeight:function(y,E,C){var A=this.spreadsheets,z,B,D,x;if((z=A[y])===undefined){return}if((B=z.getElementsByTagName("rows")[0].getElementsByTagName("row"))===undefined){return}if((D=B[E])===undefined){return}if((x=D.attributes.height.nodeValue)===undefined){return}C.style.height=x+"px"},setupCell:function(F,A,z,x,B){var y=this.spreadsheets,E,G,C,D;if((E=y[F])===undefined){return false}if((G=E.getElementsByTagName("rows")[0].getElementsByTagName("row")[A-1])===undefined){return false}if((C=G.getElementsByTagName("columns")[0].getElementsByTagName("column")[z-1])===undefined){return false}x.cellType=C.attributes.cellType.nodeValue||"";if((D=C.jitCell)!==undefined){x.html=D.html;x.state=D.state;x.calcLast=D.calcLast;x.calcDependenciesLast=D.calcDependenciesLast;x.cellType=D.cellType;x.value=D.value;x.uneditable=D.uneditable;x.sheet=D.sheet;x.dependencies=D.dependencies}if(C.attributes.formula){x.formula=C.attributes.formula.nodeValue||"";B.setAttribute("data-formula",C.attributes.formula.nodeValue||"")}else{B.innerHTML=x.value=C.attributes.value.nodeValue||""}B.className=C.attributes["class"].nodeValue||"";B.setAttribute("style",C.attributes.style.nodeValue||"");if(C.attributes.rowspan){B.setAttribute("rowspan",C.attributes.rowspan.nodeValue||"")}if(C.attributes.colspan){B.setAttribute("colspan",C.attributes.colspan.nodeValue||"")}return true},getCell:function(x,z,y){return null},jitCell:function(y,D,B){var A=this.spreadsheets,z,C,x;if((z=A[y])===undefined){return false}if((C=z.getElementsByTagName("rows")[0].getElementsByTagName("row")[D-1])===undefined){return false}if((x=C.getElementsByTagName("columns")[0].getElementsByTagName("column")[B-1])===undefined){return false}return{td:{cellIndex:B,parentNode:{rowIndex:D},html:function(){}},html:[],state:[],calcLast:-1,calcDependenciesLast:-1,cellType:x.attributes.cellType.nodeValue||"",formula:x.attributes.formula.nodeValue||"",value:x.attributes.value.nodeValue||"",type:"cell",sheet:y,id:null}},title:function(y){var z=this.spreadsheets,x;if((x=z[y])===undefined){return""}return(x.attributes.title?x.attributes.title.nodeValue:"")},getSpreadsheetIndexByTitle:function(x){},addSpreadsheet:function(x,y){if(y===undefined){this.spreadsheets.append.push(jsonSpreadsheet)}else{this.json.splice(y,0,jsonSpreadsheet)}this.count=this.json.length},setCellAttribute:function(x,y,z){},toTables:function(){var E=this.xml,I=v([]),C=E.getElementsByTagName("spreadsheets")[0].getElementsByTagName("spreadsheet"),F,M,G,A,D,V,P,ab,O,L,N,S,Q;for(var Y=0;Y<C.length;Y++){F=C[Y];var aa=v(u.createElement("table")).attr("title",(F.attributes.title?F.attributes.title.nodeValue:"")),K=v(u.createElement("colgroup")).appendTo(aa),y=v(u.createElement("tbody")).appendTo(aa);I=I.add(aa);M=F.getElementsByTagName("rows")[0].getElementsByTagName("row");P=F.getElementsByTagName("metadata")[0];for(var W=0;W<M.length;W++){G=M[W];var z=v(u.createElement("tr")).appendTo(y);if(Q=G.attributes.height){Q=(Q.nodeValue||"").replace("px","");z.css("height",Q).attr("height",Q+"px")}A=G.getElementsByTagName("columns")[0].getElementsByTagName("column");for(var U=0;U<A.length;U++){D=A[U];var H=v(u.createElement("td")).appendTo(z),x=D.getElementsByTagName("formula")[0],X=D.getElementsByTagName("cellType")[0],T=D.getElementsByTagName("value")[0],Z=D.getElementsByTagName("style")[0],J=D.getElementsByTagName("class")[0],ac=D.getElementsByTagName("rowspan")[0],B=D.getElementsByTagName("colspan")[0],R=D.getElementsByTagName("id")[0];if(x){H.attr("data-formula","="+(x.textContent||x.text))}if(X){H.attr("data-celltype",X.textContent||X.text)}if(T){H.html(T.textContent||T.text)}if(Z){H.attr("style",Z.textContent||Z.text)}if(J){H.attr("class",J.textContent||J.text)}if(ac){H.attr("rowspan",ac.textContent||ac.text)}if(B){H.attr("colspan",B.textContent||B.text)}if(R){H.attr("id",R.textContent||R.text)}}}N=P.getElementsByTagName("width");for(var W=0;W<N.length;W++){S=(N[W].textContent||N[W].text).replace("px","");v(u.createElement("col")).attr("width",S).css("width",S+"px").appendTo(K)}ab=P.getElementsByTagName("frozenAt")[0];if(ab){L=ab.getElementsByTagName("col")[0];O=ab.getElementsByTagName("row")[0];if(L){aa.attr("data-frozenatcol",(L.textContent||L.text)*1)}if(O){aa.attr("data-frozenatrow",(O.textContent||O.text)*1)}}}return I},fromSheet:function(J,D,E){D=(D==undefined?false:D);var M="",T=1*J.i,F=J.spreadsheets.length-1,y,H,I,C,K,R,S,A,z,P,L,N,x,Q,O,G,B;if(F<0){return M}do{Q=false;J.i=F;J.evt.cellEditDone();x=v.extend({},J.obj.pane().actionUI.frozenAt);O=[];H=J.spreadsheets[F];I=H.length-1;R="";do{A="";C=H[I].length-1;do{S="";z=H[I][C];P=z.td[0].attributes;L=(P["class"]?v.trim((P["class"].value||"").replace(J.cl.uiCellActive,"").replace(J.cl.uiCellHighlighted,"")):"");if(D||Q||L||z.formula||z.value||P.style){Q=true;S+="<column>";if(z.formula){S+="<formula>"+z.formula+"</formula>"}if(z.cellType){S+="<cellType>"+z.cellType+"</cellType>"}if(z.value){S+="<value>"+z.value+"</value>"}if(P.style){S+="<style>"+P.style.value+"</style>"}if(L){S+="<class>"+L+"</class>"}if(P.rowspan){S+="<rowspan>"+P.rowspan.value+"</rowspan>"}if(P.colspan){S+="<colspan>"+P.colspan.value+"</colspan>"}if(P.id){S+="<id>"+P.id.value+"</id>"}S+="</column>";A=S+A;if(I*1==1){O[C]="<width>"+v(J.col(null,C)).css("width").replace("px","")+"</width>"}}}while(C-->1);if(A){G=H[I][1].td[0].parentNode;B=G.style.height;R='<row height="'+(B?B.replace("px",""):J.s.colMargin)+'"><columns>'+A+"</columns></row>"+R}}while(I-->1);y='<spreadsheet title="'+(J.obj.table().attr("title")||"")+'"><rows>'+R+"</rows><metadata>"+(x.row||x.col?"<frozenAt>"+(x.row?"<row>"+x.row+"</row>":"")+(x.col?"<col>"+x.col+"</col>":"")+"</frozenAt>":"")+"<widths>"+O.join("")+"</widths></metadata></spreadsheet>";M=y+M}while(F--);J.i=T;M='<?xml version="1.0" encoding="UTF-8"?><spreadsheets xmlns="http://www.w3.org/1999/xhtml">'+M+"</spreadsheets>";if(E!==true){this.xml=v.parseXML(M)}return M}};return w})(jQuery,l);d.fn.extend({sheet:function(v){var w=isNaN,u=d.sheet.events;v=v||{};d(this).each(function(){var D=Globalize,A=d(this),C={editable:true,editableNames:true,barMenus:true,freezableCells:true,allowToggleState:true,menuLeft:null,menuRight:null,newColumnWidth:120,title:null,calcOff:false,lockFormulas:false,parent:A,colMargin:20,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:k.excelSelectModel,autoAddCells:true,resizableCells:true,resizableSheet:true,autoFiller:true,minSize:{rows:1,cols:1},error:function(E){return E.error},endOfNumber:false,encode:function(E){switch(typeof E){case"object":if(E.getMonth){return D.format(E,"d")}return E}if(!E){return E||""}if(!E.replace){return E||""}return E.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},frozenAt:[],contextmenuTop:{"Toggle freeze columns to here":function(G){var E=G.getTdLocation(G.obj.tdActive()).col,F=G.obj.pane().actionUI;F.frozenAt.col=(F.frozenAt.col==E?0:E)},"Insert column after":function(E){E.controlFactory.addColumn(E.colLast);return false},"Insert column before":function(E){E.controlFactory.addColumn(E.colLast,true);return false},"Add column to end":function(E){E.controlFactory.addColumn();return false},"Delete this column":function(E){E.deleteColumn();return false},"Hide column":function(E){E.toggleHideColumn();return false}},contextmenuLeft:{"Toggle freeze rows to here":function(F){var G=F.getTdLocation(F.obj.tdActive()).row,E=F.obj.pane().actionUI;E.frozenAt.row=(E.frozenAt.row==G?0:G)},"Insert row after":function(E){E.controlFactory.addRow(E.rowLast);return false},"Insert row before":function(E){E.controlFactory.addRow(E.rowLast,true);return false},"Add row to end":function(E){E.controlFactory.addRow();return false},"Delete this row":function(E){E.deleteRow();return false},"Hide row":function(E){E.toggleHide.row();return false}},contextmenuCell:{Copy:false,Cut:false,"Insert column after":function(E){E.controlFactory.addColumn(E.colLast);return false},"Insert column before":function(E){E.controlFactory.addColumn(E.colLast,true);return false},"Add column to end":function(E){E.controlFactory.addColumn();return false},"Delete this column":function(E){E.deleteColumn();return false},line1:"line","Insert row after":function(E){E.controlFactory.addRow(E.rowLast);return false},"Insert row before":function(E){E.controlFactory.addRow(E.rowLast,true);return false},"Add row to end":function(E){E.controlFactory.addRow();return false},"Delete this row":function(E){E.deleteRow();return false},line2:"line","Add spreadsheet":function(E){E.addSheet()},"Delete spreadsheet":function(E){E.deleteSheet()}},hiddenRows:[],hiddenColumns:[],cellStartingHandlers:{"$":function(F,E){return n.DOLLAR.call(this,F.substring(1).replace(D.culture().numberFormat[","],""),2,E||"$")},"£":function(E){return B.s.cellStartingHandlers["$"].call(this,E,"£")}},cellEndHandlers:{"%":function(E){return E.substring(0,this.value.length-1)/100}},cellTypeHandlers:{percent:function(G){var F=(w(G)?D.parseFloat(G):G*1),E;if(!w(F)){E=new s(F);E.html=D.format(F,"p");return E}return G},date:function(F){var E=D.parseDate(F);if(E===null){return F}else{E.html=D.format(E,"d");return E}},time:function(F){var E=D.parseDate(F);if(E===null){return F}else{E.html=D.format(E,"t");return E}},currency:function(G){var F=(w(G)?D.parseFloat(G):G*1),E;if(!w(F)){E=new s(F);E.html=D.format(F,"c");return E}return G},number:function(G){var F,E;if(!v.endOfNumber){F=D.culture().numberFormat["."];v.endOfNumber=new b("(["+(F=="."?".":F)+"])([0-9]*?[1-9]+)?(0)*$")}if(!w(G)){E=new s(G);E.html=D.format(G+"","n10").replace(v.endOfNumber,function(J,I,H){return(H?I:"")+(H||"")});return E}return G}},alert:function(E){alert(E)},prompt:function(F,G,E){G(prompt(F,E))},confirm:function(G,E,F){if(confirm(G)){E()}else{if(F){F()}}},initCalcRows:20,initCalcCols:10,initScrollRows:0,initScrollCols:0,loader:null};var B=this.jS;if(B){var y=A.children().detach();B.kill();A.html(y);for(var z in u){if(u.hasOwnProperty(z)){A.unbind(u[z])}}}if((this.className||"").match(/\bnot-editable\b/i)!=null){v.editable=false}for(var x in u){if(u.hasOwnProperty(x)){A.bind(u[x],v[u[x]])}}if(!d.sheet.instance.length){d.sheet.instance=[]}this.jS=B=d.sheet.createInstance(d.extend(C,v),d.sheet.instance.length);d.sheet.instance.push(B)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";this.style["-moz-user-select"]="none"});return this},getSheet:function(){var u=this[0],v=(u.jS||{});return v},getCellValue:function(z,v,u){var w=this[0],x=(w.jS||{});u=(u||0);if(x.updateCellValue){try{return x.updateCellValue(u,z,v)}catch(y){}}return null},setCellValue:function(z,B,w,v){var x=this[0],y=(x.jS||{}),u;v=(v||0);if(y.getCell&&(u=y.getCell(B,w,v))){try{if((z+"").charAt(0)=="="){u.valueOverride=u.value="";u.formula=z.substring(1)}else{u.value=z;u.valueOverride=u.formula=""}u.calcLast=u.calcDependenciesLast=0;y.updateCellValue.call(u,v,B,w);y.updateCellDependencies.call(u);return true}catch(A){}}return false},setCellFormula:function(B,A,w,v){var x=this[0],y=(x.jS||{}),u;v=(v||0);if(y.getCell&&(u=y.getCell(A,w,v))){try{u.formula=B;u.valueOverride=u.value="";u.calcLast=u.calcDependenciesLast=0;y.updateCellValue.call(u,v,A,w)}catch(z){}}return this},setCellHtml:function(x,B,w,v){var y=this[0],z=(y.jS||{}),u;v=(v||0);if(z.getCell&&(u=z.getCell(B,w,v))){try{u.html=[x];u.calcLast=u.calcDependenciesLast=0;z.updateCellValue.call(u,v,B,w)}catch(A){}}return this},isSheetFullScreen:function(){var u=this[0],v=(u.jS||{});if(v.obj){return v.obj.fullScreen().is(":visible")}return false},serializeCellInputs:function(v){var w=this[0],x=(w.jS||{}),u=x.obj.tables().find(":input");if(v){return u.serializeArray()}else{return u.serialize()}},viewSource:function(u){var v="";d(this).each(function(){if(u){v+=d(this).toPrettySource()}else{v+=d(this).toCompactSource()}});d.printSource(v);return v},toCompactSource:function(){var y=this[0];var v="";if(y.nodeType==1){v+="<"+y.tagName.toLowerCase();var A=y.attributes.length;for(var x=0;x<A;x++){var w=y.attributes[x].name,z=y.getAttribute(w);if(z){if(w=="contentEditable"&&z=="inherit"){continue}if(typeof(z)=="string"){v+=" "+w+'="'+z.replace(/"/g,"'")+'"'}else{if(w=="style"&&z.cssText){v+=' style="'+z.cssText+'"'}}}}if(y.tagName=="COL"){v+="/>"}else{v+=">";var u="";d(y.childNodes).each(function(){u+=d(this).toCompactSource()});v+=u;v+="</"+y.tagName.toLowerCase()+">"}}else{if(y.nodeType==3){v+=y.data.replace(/^\s*(.*)\s*$/g,"$1")}}return v},toPrettySource:function(z){var y=this[0],B,x;z=z||"";var v="";if(y.nodeType==1){v+="\n"+z+"<"+y.tagName.toLowerCase();B=y.attributes.length;for(x=0;x<B;x++){var w=y.attributes[x].name,A=y.getAttribute(w);if(A){if(w=="contentEditable"&&A=="inherit"){continue}if(typeof(A)=="string"){v+=" "+w+'="'+d.trim(A.replace(/"/g,"'"))+'"'}else{if(w=="style"&&A.cssText){v+=' style="'+d.trim(A.cssText)+'"'}}}}if(y.childNodes.length<=0){if(y.tagName=="COL"){v+="/>"}else{v+="></"+y.tagName.toLowerCase()+">"}}else{v+=">";var u="";B=y.childNodes.length;for(x=0;x<B;x++){u+=d(y.childNodes[x]).toPrettySource(z+"  ")}v+=u;if(u.indexOf("\n")>=0){v+="\n"+z}v+="</"+y.tagName.toLowerCase()+">"}}else{if(y.nodeType==3){v+=y.data.replace(/^\s*(.*)\s*$/g,"$1")}}return v}});d.sheet={instance:[],dependencies:{coreCss:{css:"jquery.sheet.css"},jQueryUI:{script:"jquery-ui/jquery-ui.min.js",thirdParty:true},jQueryUIThemeRoller:{css:"jquery-ui/themes/smoothness/jquery-ui.min.css",thirdParty:true},globalize:{script:"globalize/lib/globalize.js",thirdParty:true},nearest:{script:"jquery-nearest/src/jquery.nearest.min.js",thirdParty:true},mousewheel:{script:"MouseWheel/MouseWheel.js",thirdParty:true}},optional:{advancedFn:{script:"plugins/jquery.sheet.advancedfn.js"},financeFn:{script:"plugins/jquery.sheet.financefn.js"},colorPicker:{css:"really-simple-color-picker/colorPicker.css",script:"really-simple-color-picker/jquery.colorPicker.min.js",thirdParty:true},elastic:{script:"jquery-elastic/jquery.elastic.source.js",thirdParty:true},globalizeCultures:{script:"globalize/lib/cultures/globalize.cultures.js",thirdParty:true},raphael:{script:"raphael/raphael-min.js",thirdParty:true},gRaphael:{script:"graphael/g.raphael.js",thirdParty:true},gRaphaelBar:{script:"graphael/g.bar.js",thirdParty:true},gRaphaelDot:{script:"graphael/g.dot.js",thirdParty:true},gRaphaelLine:{script:"graphael/g.line.js",thirdParty:true},gRaphaelPie:{script:"graphael/g.pie.js",thirdParty:true},thaw:{script:"thaw.js/thaw.js",thirdParty:true},undoManager:{script:"Javascript-Undo-Manager/js/undomanager.js",thirdParty:true},zeroClipboard:{script:"zeroclipboard/dist/ZeroClipboard.min.js",thirdParty:true}},events:["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],preLoad:function(x,w){x=x||"";w=d.extend({skip:["globalizeCultures"],thirdPartyDirectory:"bower_components/"},w);var v=function(){if(this.script!==undefined){l.write('<script src="'+x+(this.thirdParty?w.thirdPartyDirectory:"")+this.script+'"><\/script>')}if(this.css!==undefined){l.write('<link rel="stylesheet" type="text/css" href="'+x+(this.thirdParty?w.thirdPartyDirectory:"")+this.css+'"></link>')}};for(var u in w.skip){if(this.dependencies[w.skip[u]]){delete this.dependencies[w.skip[u]]}if(this.optional[w.skip[u]]){delete this.optional[w.skip[u]]}}d.each(this.dependencies,function(){v.call(this)});d.each(this.optional,function(){v.call(this)})},createInstance:function(M,F){var L=this,C=function(N,u){var I=u.parentNode;if(I.lastchild==u){I.appendChild(N)}else{I.insertBefore(N,u.nextSibling)}},v=d(f),x=d(l),D=l.body,z=d(D),G=function(){},K=undefined,E=g,w=isNaN,J=NaN,A=f.thaw,B={version:"4.x",i:0,I:F,sheetCount:0,spreadsheets:[],controls:{autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],th:[],ths:function(){var u=d([]);for(var I in this.th[B.i]){u.pushStack(this.th[B.i][I])}return u}},y:{controls:[],handleFreeze:[],menu:[],parent:[],th:[],ths:function(){var u=d([]);for(var I in this.th[B.i]){u.pushStack(this.th[B.i][I])}return u}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],tdMenu:[],cellsEdited:[],enclosure:[],enclosures:null,formula:null,fullScreen:null,header:null,inPlaceEdit:[],inputs:[],label:null,menuLeft:[],menuRight:[],menus:[],pane:[],panes:null,scrolls:null,sheetAdder:null,table:[],tables:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},obj:{autoFiller:function(){return B.controls.autoFiller[B.i]||d([])},barCorner:function(){return B.controls.bar.corner[B.i]||d([])},barHelper:function(){return B.controls.bar.helper[B.i]||(B.controls.bar.helper[B.i]=d([]))},barLeft:function(u){return(B.controls.bar.y.th[B.i]&&B.controls.bar.y.th[B.i][u]?B.controls.bar.y.th[B.i][u]:d([]))},barLeftControls:function(){return B.controls.bar.y.controls[B.i]||d([])},barLefts:function(){return B.controls.bar.y.ths()},barHandleFreezeLeft:function(){return B.controls.bar.y.handleFreeze[B.i]||d([])},barMenuLeft:function(){return B.controls.bar.y.menu[B.i]||d([])},barTop:function(u){return(B.controls.bar.x.th[B.i]&&B.controls.bar.x.th[B.i][u]?B.controls.bar.x.th[B.i][u]:d([]))},barTopControls:function(){return B.controls.bar.x.controls[B.i]||d([])},barTops:function(){return B.controls.bar.x.ths()},barTopParent:function(){return B.controls.bar.x.parent[B.i]||d([])},barHandleFreezeTop:function(){return B.controls.bar.x.handleFreeze[B.i]||d([])},barMenuParentTop:function(){return B.controls.bar.x.menuParent[B.i]||d([])},barMenuTop:function(){return B.controls.bar.x.menu[B.i]||d([])},tdActive:function(){return B.cellLast.td||null},tdMenu:function(){return B.controls.tdMenu[B.i]||d([])},cellsEdited:function(){return(B.controls.cellsEdited!==K?B.controls.cellsEdited:B.controls.cellsEdited=[])},chart:function(){return B.controls.chart[B.i]||d([])},enclosure:function(){return B.controls.enclosure[B.i]||d([])},enclosures:function(){return B.controls.enclosures||d([])},formula:function(){return B.controls.formula||d([])},fullScreen:function(){return B.controls.fullScreen||d([])},header:function(){return B.controls.header||d([])},highlighted:function(){return B.highlighter.last||d([])},menuRight:function(){return B.controls.menuRight[B.i]||d([])},inPlaceEdit:function(){return B.controls.inPlaceEdit[B.i]||d([])},inputs:function(){return B.controls.inputs[B.i]||d([])},label:function(){return B.controls.label||d([])},menus:function(){return B.controls.menus[B.i]||d([])},menuLeft:function(){return B.controls.menuLeft[B.i]||d([])},pane:function(){return B.controls.pane[B.i]||{}},panes:function(){return B.controls.panes||d([])},parent:function(){return M.parent},scrolls:function(){return B.controls.scrolls||d([])},sheetAdder:function(){return B.controls.sheetAdder||d([])},table:function(){return B.controls.table[B.i]||d([])},tables:function(){return B.controls.tables||d([])},tab:function(){return B.controls.tab[B.i]||d([])},tabs:function(){return B.controls.tabs||d([])},tabContainer:function(){return B.controls.tabContainer||d([])},title:function(){return B.controls.title||d([])}},id:"jS_"+F+"_",cl:{autoFiller:"jSAutoFiller",autoFillerHandle:"jSAutoFillerHandle",autoFillerCover:"jSAutoFillerCover",barCorner:"jSBarCorner",barController:"jSBarController",barControllerChild:"jSBarControllerChild",barHelper:"jSBarHelper",barLeft:"jSBarLeft",barHandleFreezeLeft:"jSBarHandleFreezeLeft",barTop:"jSBarTop",barTopMenuButton:"jSBarTopMenuButton",barHandleFreezeTop:"jSBarHandleFreezeTop",barTopParent:"jSBarTopParent",chart:"jSChart",formula:"jSFormula",formulaParent:"jSFormulaParent",header:"jSHeader",fullScreen:"jSFullScreen",inPlaceEdit:"jSInPlaceEdit",menu:"jSMenu",menuFixed:"jSMenuFixed",parent:"jSParent",scroll:"jSScroll",sheetAdder:"jSSheetAdder",table:"jS",label:"jSLoc",pane:"jSEditPane",tab:"jSTab",tabContainer:"jSTabContainer",tabContainerScrollable:"jSTabContainerScrollable",tdMenu:"jSTdMenu",title:"jSTitle",enclosure:"jSEnclosure",ui:"jSUI"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",addSheet:"Add a spreadsheet",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"No column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}",maxRowsBrowserLimitation:"You've reached the maximum amount of rows this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxColsBrowserLimitation:"You've reached the maximum amount of columns this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxSizeBrowserLimitationOnOpen:"The spreadsheet you are loading is larger than the maximum size of cells this browser supports. Try using Chrome, Firefox, or Internet Explorer 9+. You can an proceed, but the spreadsheet may not work as intended."},kill:function(){if(!B){return false}d(l).unbind("keydown");this.obj.fullScreen().remove();(this.obj.inPlaceEdit().destroy||G)();M.parent.trigger("sheetKill").removeClass(B.theme.parent).html("");M.parent[0].jS=K;this.obj.menus().remove();var u=d.sheet.events.length;for(var I=0;I<u;I++){M.parent.unbind(d.sheet.events[I])}d.sheet.instance.splice(F,1);return true},trigger:function(u,I){I=I||[];return M.parent.triggerHandler(u,[B].concat(I))},spreadsheetsToArray:function(u){if(u||B.spreadsheets.length==0){B.cycleCellsAll(function(N,O,I){B.createCell(N,O,I)})}return B.spreadsheets},spreadsheetToArray:function(I,u){u=(u?u:B.i);if(!B.spreadsheets[u]){B.cycleCells(function(O,P,N){B.createCell(O,P,N)})}return B.spreadsheets[u]},createCell:function(Z,V,Y,W,O,Q){var T,ab,P,aa,u,I,X,U,N,S,R;if(!(T=B.spreadsheets[Z])){T=B.spreadsheets[Z]=[]}if(!(ab=T[V])){ab=T[V]=[]}if(!(aa=B.controls.tables[Z])||!(X=aa.tBody)||!(U=X.children[V])||!(N=U.children[Y])){return}P=ab[Y]=N.jSCell={td:N,dependencies:[],formula:N.getAttribute("data-formula")||"",cellType:N.getAttribute("data-celltype")||null,value:N.textContent||N.innerText||"",calcCount:W||0,calcLast:O||-1,calcDependenciesLast:Q||-1,sheet:Z,type:"cell",jS:B,state:[],needsUpdated:true,uneditable:N.getAttribute("data-uneditable")||false,id:N.getAttribute("id")||null};if(P.formula&&P.formula.charAt(0)=="="){P.formula=P.formula.substring(1)}u=aa.colGroup;while(!(I=u.children[Y])){I=l.createElement("col");I.setAttribute("style","width:"+B.s.newColumnWidth+"px;");u.appendChild(I)}B.shortenCellLookupTime(Y,P,N,I,U,X,aa);if(!(R=B.controls.bar.y.th[Z])){R=B.controls.bar.y.th[Z]=[]}if(!R[V]){R[V]=d(U.children[0])}if(!(S=B.controls.bar.x.th[Z])){S=B.controls.bar.x.th[Z]=[]}if(!S[Y]){S[Y]=d(X.children[0].children[Y])}return P},shortenCellLookupTime:function(N,Q,S,I,R,u,P){var O;if(!(O=I.jSCells)){O=I.jSCells=[]}O.unshift(Q);if(!I.tds){I.tds=[]}I.tds.unshift(S);S.col=I;S.type="cell";S.barLeft=S.barLeft||R.children[0];S.barTop=S.barTop||u.children[0].children[N];if(!R.jSCells){R.jSCells=[]}R.jSCells.unshift(Q);if(!R.tds){R.tds=[]}R.tds.unshift(S);if(!P.jSCells){P.jSCells=[]}P.jSCells.unshift(Q);if(!P.tds){P.tds=[]}P.tds.unshift(S);S.table=P},createUnboundCell:function(u,I){return I.jSCell={td:I,dependencies:[],formula:"",cellType:null,value:"",calcCount:0,calcLast:-1,calcDependenciesLast:-1,sheet:u,type:"cell",jS:B,state:[],needsUpdated:true,uneditable:false,id:null}},getCell:function(Q,O,N){var I,P,u;N=(N||0);if(B.spreadsheets&&(I=B.spreadsheets[N])&&(P=I[Q])&&(u=P[O])){return u}return null},getAllCellDependencies:function(I){function N(T,R){var Q=0,S=T.dependencies,P,O=S.length;for(;Q<O;Q++){P=S[Q];R(P);N(P,R)}}var u=[];N(I,function(O){u.push(O)});return u},nav:false,setNav:function(N){var u=d.sheet.instance;for(var I=0;I<u.length;I++){(u[I]||{}).nav=false}B.nav=N},controlFactory:{addRowMulti:function(O,R,N,u,Q){var I=(Q?"row-init":"row");function P(S){if(S){if(!w(S)){B.controlFactory.addCells(O,N,parseInt(S),I,u);B.trigger("sheetAddRow",[O,N,S])}}}if(!R){M.prompt(B.msg.addRowMulti,P)}else{P(R)}},addColumnMulti:function(O,R,N,u,Q){var I=(Q?"col-init":"col");function P(S){if(S){if(!w(S)){B.controlFactory.addCells(O,N,parseInt(S),I,u);B.trigger("sheetAddColumn",[O,N,S])}}}if(!R){M.prompt(B.msg.addColumnMulti,P)}else{P(R)}},rowAdder:new k.RowAdder(),columnAdder:new k.ColumnAdder(),addCells:function(ag,aj,T,O,X){B.autoFillerHide();B.setDirty(true);B.setChanged(true);B.obj.barHelper().remove();var V=B.obj.table(),ah=V[0],P=ah.tBody,ad=ah.colGroup,W=false,ab=B.obj.tdActive(),R=B.spreadsheets[B.i]||(B.spreadsheets[B.i]=[]),ac,Q,ae=M.newColumnWidth+"px",aa=M.colMargin+"px",Y=B.cl.barLeft+" "+B.theme.bar,ai=B.cl.barTop+" "+B.theme.bar,S,U=(M.loader!==null?M.loader:null),Z=(U!==null?U.setupCell:null),N=B.controls.bar.x.th[B.i]||(B.controls.bar.x.th[B.i]=[]),I=B.controls.bar.y.th[B.i]||(B.controls.bar.y.th[B.i]=[]),af=ah.size(),u=l.createDocumentFragment();T=T||1;O=O||"col";switch(O){case"row":Z=null;case"row-init":if(!ag){ag=af.rows;W=true}S={row:ag,col:0};ac=this.rowAdder;if(ac.setQty(T,af)===false){if(!B.isBusy()){M.alert(B.msg.maxRowsBrowserLimitation)}return}ac.setCreateBarFn(function(ak){var al=l.createElement("tr"),am=l.createElement("th");am.setAttribute("class",Y);am.entity="left";am.type="bar";am.style.height=aa;al.appendChild(am);u.appendChild(al);am.innerHTML=al.rowIndex;I.splice(ak,0,d(am));R.splice(ak,0,[]);return al});if(Z!==null){ac.setCreateCellFn(function(ao,am,al){var ak=Z.call(U,B.i,ao,am,function(aq){return B.createUnboundCell(B.i,aq)}),ap=ak.td,an=R[ao];an[am]=ak;if(ak.calcLast<0){B.updateCellValue.call(ak,B.i,ao,am);B.updateCellDependencies.call(ak)}al.insertBefore(ap,al.children[am]);B.shortenCellLookupTime(am,ak,ap,ad.children[am],al,P,ah)})}else{ac.setCreateCellFn(function(am,al,ak){var an=l.createElement("td");ak.insertBefore(an,ak.children[al]);B.createCell(B.i,am,al)})}ac.setAddedFinishedFn(function(ak){P.insertBefore(u,P.children[ag].nextSibling);B.refreshRowLabels(ag);Q=ak});break;case"col":Z=null;case"col-init":if(!ag){ag=af.cols;W=true}S={row:0,col:ag};ac=this.columnAdder;if(ac.setQty(T,af)===false){if(!B.isBusy()){M.alert(B.msg.maxColsBrowserLimitation)}return}ac.setCreateBarFn(function(am){var an=P.children[0],ao=l.createElement("col"),ap=l.createElement("th"),al,ak=P.children[1];ao.style.width=ae;ap.entity="top";ap.type="bar";ap.innerHTML=h.columnLabelString(am);ap.className=ai;if(ak===undefined){al=l.createElement("th");al.setAttribute("class",Y);al.entity="left";al.type="bar";ak=l.createElement("tr");ak.style.height=aa;ak.appendChild(al);P.appendChild(ak);al.innerHTML=ak.rowIndex;I.splice(0,0,d(al))}ad.insertBefore(ao,ad.children[am]);an.insertBefore(ap,an.children[am]);N.splice(am,0,d(ap));return{bar:ap,col:ao,barParent:an}});if(Z!==null){ac.setCreateCellFn(function(ap,am,an){var al=Z.call(U,B.i,ap,am,function(ar){return B.createUnboundCell(B.i,ar)}),aq=al.td,ak=P.children[ap],ao=R[ap];if(ao===undefined){R[ap]=ao=[]}ao[am]=al;if(al.calcLast<0){B.updateCellValue.call(al,B.i,ap,am);B.updateCellDependencies.call(al)}ak.insertBefore(aq,ak.children[am]);B.shortenCellLookupTime(am,al,aq,an.col,ak,P,ah)})}else{ac.setCreateCellFn(function(ao,al,am){var ap=l.createElement("td"),ak=P.children[ao],an=R[ao];if(an===undefined){R[ao]=an=[]}ak.insertBefore(ap,ak.children[al]);R[ao].splice(al,0,{});B.createCell(B.i,ao,al)})}ac.setAddedFinishedFn(function(ak){B.refreshColumnLabels(ag);Q=ak});break}ac.createCells(ag,af,aj);if(!X&&W!=true){B.offsetFormulas(S,Q,aj)}B.obj.pane().resizeScroll(true);if(ab&&ab[0]&&ab[0].cellIndex&&ab[0].parentNode){B.colLast=ab[0].cellIndex;B.rowLast=ab[0].parentNode.rowIndex}return true},addRow:function(I,u){B.controlFactory.addCells(I,u,1,"row");B.trigger("sheetAddRow",[I,u,1])},addColumn:function(I,u){B.controlFactory.addCells(I,u,1,"col");B.trigger("sheetAddColumn",[I,u,1])},barLeft:function(I){var N=I.tBody.children,u=N.length-1;if(u>0){do{N[u].insertBefore(l.createElement("th"),N[u].children[0])}while(u-->1)}},barTop:function(U){var I=U.colGroup,T=I.children,P,N=U.tBody.children[0],R=l.createElement("col"),S=l.createElement("th"),Q=l.createElement("tr"),O=0;if(N===undefined){I.innerHTML=""}else{O=N.children.length;while(T.length>O){I.removeChild(T[T.length-1])}}R.style.width=R.style.minWidth=M.colMargin+"px";I.insertBefore(R,I.children[0]);Q.appendChild(S);Q.className=B.cl.barTopParent;U.tBody.insertBefore(Q,U.tBody.children[0]);U.barTopParent=Q;U.corner=S;S.col=R;B.controls.barTopParent[B.i]=d(Q);P=g.min(O,M.initCalcCols);if(P>0){do{var u=l.createElement("th");if(!T[P]){T[P]=l.createElement("col");I.insertBefore(T[P],R.nextSibling)}T[P].bar=u;u.col=T[P];Q.insertBefore(u,S.nextSibling)}while(P-->1)}U.barTop=B.controls.barTopParent[B.i].children();return Q},barHandleFreeze:{top:function(N){if(B.isBusy()){return false}var u=B.obj.pane().actionUI,X=u.frozenAt,T=u.scrolledArea;if(!(T.end.col<=(X.col+1))){return false}B.obj.barHelper().remove();var Y=N.table,W=Y.tBody,O=W.children[0],Q=O.children,S=d(Q[X.col+1]),V=S.position(),U,P=d(N).offset(),R=l.createElement("div"),I=N.freezeHandleTop=d(R).appendTo(N).addClass(B.theme.barHandleFreezeTop+" "+B.cl.barHelper+" "+B.cl.barHandleFreezeTop).height(S.height()).css("left",(V.left-R.clientWidth)+"px").attr("title",B.msg.dragToFreezeCol);B.controls.bar.helper[B.i]=B.obj.barHelper().add(R);B.controls.bar.x.handleFreeze[B.i]=I;B.draggable(I,{axis:"x",start:function(){B.setBusy(true);U=d(l.createElement("div")).appendTo(N).css("position","absolute").addClass(B.theme.barFreezeIndicator+" "+B.cl.barHelper).height(N.table.corner.clientHeight).fadeTo(0,0.33)},drag:function(){var Z=B.nearest(I,Q).prev();if(Z.length&&Z.position){U.width(Z.position().left+Z.width())}},stop:function(ab,Z){U.remove();B.setBusy(false);B.setDirty(true);var aa=B.nearest(I,Q);B.obj.barHelper().remove();T.end.col=u.frozenAt.col=B.getTdLocation(aa).col-1;B.autoFillerHide();u.scrollStart("x",B.sheetSize(N.table))},containment:[P.left,P.top,E.min(P.left+N.table.clientWidth,P.left+N.clientWidth-f.scrollBarSize.width),P.top]});return true},left:function(N){if(B.isBusy()){return false}var N=B.obj.pane(),u=N.actionUI,W=u.frozenAt,S=u.scrolledArea;if(!(S.end.row<=(W.row+1))){return false}B.obj.barHelper().remove();var X=N.table,V=X.tBody,R=d(V.children[W.row+1].children[0]),U=R.position(),T,O=d(N).offset(),Q=l.createElement("div"),P=V.children,I=N.freezeHandleLeft=d(Q).appendTo(N).addClass(B.theme.barHandleFreezeLeft+" "+B.cl.barHelper+" "+B.cl.barHandleFreezeLeft).width(R.width()).css("top",(U.top-Q.clientHeight+1)+"px").attr("title",B.msg.dragToFreezeRow);B.controls.bar.helper[B.i]=B.obj.barHelper().add(Q);B.controls.bar.y.handleFreeze[B.i]=I;B.draggable(I,{axis:"y",start:function(){B.setBusy(true);T=d(l.createElement("div")).appendTo(N).css("position","absolute").addClass(B.theme.barFreezeIndicator+" "+B.cl.barHelper).width(Q.clientWidth).fadeTo(0,0.33)},drag:function(){var Y=B.nearest(I,P).prev();if(Y.length&&Y.position){T.height(Y.position().top+Y.height())}},stop:function(aa,Y){T.remove();B.setBusy(false);B.setDirty(true);var Z=B.nearest(I,P);B.obj.barHelper().remove();S.end.row=u.frozenAt.row=E.max(B.getTdLocation(Z.children(0)).row-1,0);B.autoFillerHide();N.actionUI.scrollStart("y",B.sheetSize(N.table))},containment:[O.left,O.top,O.left,E.min(O.top+N.table.clientHeight,O.top+N.clientHeight-f.scrollBarSize.height)]});return true},corner:function(){}},menu:function(N,u){var Q,I=d([]),P=B.theme.menuHover;switch(N){case"top":Q=d(l.createElement("div")).addClass(B.theme.menu+" "+B.cl.tdMenu);B.controls.bar.x.menu[B.i]=Q;break;case"left":Q=d(l.createElement("div")).addClass(B.theme.menu+" "+B.cl.tdMenu);B.controls.bar.y.menu[B.i]=Q;break;case"cell":Q=d(l.createElement("div")).addClass(B.theme.menu+" "+B.cl.tdMenu);B.controls.tdMenu[B.i]=Q;break}B.controls.menus[B.i]=B.obj.menus().add(Q);Q.mouseleave(function(){Q.hide()}).bind("contextmenu",function(){return false}).appendTo(z).hide().disableSelectionSpecial();for(var O in u){if(u[O]){if(d.isFunction(u[O])){I.pushStack(d(l.createElement("div")).text(O).data("msg",O).click(function(){u[d(this).data("msg")].call(this,B);Q.hide();return false}).appendTo(Q).hover(function(){I.removeClass(P);d(this).addClass(P)},function(){d(this).removeClass(P)}))}else{if(u[O]=="line"){d(l.createElement("hr")).appendTo(Q)}}}}return Q},barMenu:{top:function(N,u,I){if(B.isBusy()){return false}var P=B.obj.barMenuTop().hide();if(!P.length){P=B.controlFactory.menu("top",M.contextmenuTop)}B.obj.menus().hide();if(!I){P.css("left",(N.pageX-5)+"px").css("top",(N.pageY-5)+"px").show();return P}var O=B.obj.barMenuParentTop().hide();if(!O.length){O=d(l.createElement("div")).addClass(B.theme.barMenuTop+" "+B.cl.barHelper+" "+B.cl.barTopMenuButton).append(d(l.createElement("span")).addClass("ui-icon ui-icon-triangle-1-s")).mousedown(function(Q){O.parent().mousedown().mouseup();var R=O.offset();P.css("left",(Q.pageX-5)+"px").css("top",(Q.pageY-5)+"px").show()}).blur(function(){if(P){P.hide()}});O.get(0).destroy=function(){O.remove();B.controls.bar.x.menuParent[B.i]=null};B.controls.bar.x.menuParent[B.i]=O}O.prependTo(I).show()},left:function(I,u){if(B.isBusy()){return false}B.obj.barMenuLeft().hide();if(u){B.obj.barHandleFreezeLeft().remove()}var N;N=B.obj.barMenuLeft();if(!N.length){N=B.controlFactory.menu("left",M.contextmenuLeft)}B.obj.menus().hide();N.css("left",(I.pageX-5)+"px").css("top",(I.pageY-5)+"px").show();return true},corner:function(){}},tdMenu:function(u){if(B.isBusy()){return false}B.obj.tdMenu().hide();var I=B.obj.tdMenu();if(!I.length){I=B.controlFactory.menu("cell",M.contextmenuCell)}B.obj.menus().hide();I.css("left",(u.pageX-5)+"px").css("top",(u.pageY-5)+"px").show();return true},header:function(){B.obj.header().remove();B.obj.sheetAdder().remove();B.obj.tabContainer().remove();var T=l.createElement("div"),N=l.createElement("table"),Q=l.createElement("tr"),W,O,X=l.createElement("td"),Y,P,I,U,u;T.appendChild(N);N.appendChild(Q);T.className=B.cl.header+" "+B.theme.control;B.controls.header=d(T);if(M.title){if(d.isFunction(M.title)){M.title=B.title(B,F)}X.className=B.cl.title;B.controls.title=d(X).html(M.title)}else{d(X).hide()}Q.appendChild(X);function V(aa){if(d.isFunction(aa)){aa=d(aa.call(B))}else{aa=d(aa)}if(aa.is("ul")){aa.find("ul").hide().addClass(B.theme.menuUl);aa.find("li").addClass(B.theme.menuLi).hover(function(){d(this).find("ul:first").hide().show()},function(){d(this).find("ul:first").hide()})}return aa}if(B.isSheetEditable()){if(M.menuLeft){P=l.createElement("td");P.className=B.cl.menu+" "+B.cl.menuFixed+" "+B.theme.menuFixed;Q.insertBefore(P,X);B.controls.menuLeft[B.i]=d(P).append(V(M.menuLeft)).children().addClass(B.theme.menuFixed);B.controls.menuLeft[B.i].find("img").load(function(){B.sheetSyncSize()})}if(M.menuRight){I=l.createElement("td");I.className=B.cl.menu+" "+B.cl.menuFixed;Q.appendChild(I);B.controls.menuRight[B.i]=d(I).append(V(M.menuRight)).children().addClass(B.theme.menuFixed);B.controls.menuRight[B.i].find("img").load(function(){B.sheetSyncSize()})}Y=l.createElement("td");Y.className=B.cl.label+" "+B.theme.control;B.controls.label=d(Y);U=l.createElement("textarea");U.className=B.cl.formula+" "+B.theme.controlTextBox;U.onkeydown=B.evt.formula.keydown;U.onkeyup=function(){B.obj.inPlaceEdit().value=this.value};U.onchange=function(){B.obj.inPlaceEdit().value=this.value};U.onpaste=B.evt.pasteOverCells;U.onfocus=function(){B.setNav(false)};U.onfocusout=function(){B.setNav(true)};U.onblur=function(){B.setNav(true)};B.controls.formula=d(U);var S=l.createElement("span");S.appendChild(U);W=l.createElement("table");O=l.createElement("tr");W.appendChild(O);T.appendChild(W);u=l.createElement("td");u.className=B.cl.formulaParent;u.appendChild(S);O.appendChild(Y);O.appendChild(u);O.appendChild(l.createElement("td"));B.resizableSheet(d(S),{minHeight:B.controls.formula.height(),maxHeight:78,handles:"s",resize:function(ab,aa){B.controls.formula.height(aa.size.height)},stop:function(){B.sheetSyncSize()}});var Z=d.sheet.instance;for(var R=0;R<Z.length;R++){(Z||{}).nav=false}B.setNav(true);d(l).keydown(B.evt.document.keydown)}return T},ui:function(){var u=l.createElement("div");u.setAttribute("class",B.cl.ui);B.obj.ui=u;return u},sheetAdder:function(){var u=l.createElement("span");if(B.isSheetEditable()){u.setAttribute("class",B.cl.sheetAdder+" "+B.cl.tab+" "+B.theme.tab);u.setAttribute("title",B.msg.addSheet);u.innerHTML="+";u.onmousedown=function(){B.addSheet();return false};u.i=-1}return B.controls.sheetAdder=d(u)},tabContainer:function(){var u=l.createElement("span"),I;u.setAttribute("class",B.cl.tabContainer);u.onmousedown=function(O){O=O||f.event;var N=(O.target||O.srcElement).i;if(N>=0){B.trigger("sheetSwitch",[N])}return false};u.ondblclick=function(O){O=O||f.event;var N=(O.target||O.srcElement).i;if(N>=0){B.trigger("sheetRename",[N])}return false};if(B.isSheetEditable()&&d.fn.sortable){return B.controls.tabContainer=d(u).sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,start:function(O,N){I=N.item.index();B.trigger("sheetTabSortStart",[O,N])},update:function(O,N){B.trigger("sheetTabSortUpdate",[O,N,I])}})}return B.controls.tabContainer=d(u)},sheetUI:function(V,W,P){B.i=P;B.tuneTableForSheetUse(W);B.readOnly[P]=(W.className||"").match(/\breadonly\b/i)!=null;var R=W.tBody.children.length>0,Q=B.controlFactory.enclosure(W),N=Q.pane,I=d(N),S=function(aa){aa=aa||f.event;if(B.isBusy()){return false}if(B.isBar(aa.target)){var Y=aa.target.entity,Z=B.getBarIndex[Y](aa.target);if(Z<0){return false}if(B.evt.barInteraction.first==B.evt.barInteraction.last){B.controlFactory.barMenu[Y](aa,Z)}}else{B.controlFactory.tdMenu(aa)}return false};V.appendChild(Q);B.controlFactory.barTop(W);B.controlFactory.barLeft(W);N.appendChild(W);if(B.isSheetEditable()){B.controlFactory.autoFiller(N)}if(B.isSheetEditable()){var T=B.obj.formula(),X="";I.mousedown(function(Y){B.setNav(true);if(B.isBusy()){return false}if(B.isCell(Y.target)){if(Y.button==2){S.call(this,Y);B.evt.cellOnMouseDown(Y);return true}B.evt.cellOnMouseDown(Y);return false}if(B.isBar(Y.target)){if(Y.button==2){S.call(this,Y)}X=Y.target.entity;B.evt.barInteraction.select(Y.target);return false}return true});N.onmouseup=function(){X=""};N.onmouseover=function(ac){ac=ac||f.event;var ab=ac.target||ac.srcElement;if(B.isBusy()){return false}if(!B.isBar(ab)){return false}var aa=d(ab),Y=ab.entity,Z=B.getBarIndex[Y](ab);if(Z<0){return false}if(B.evt.barInteraction.selecting&&Y==X){B.evt.barInteraction.last=Z;B.cellSetActiveBar(Y,B.evt.barInteraction.first,B.evt.barInteraction.last)}else{B.resizeBar[Y](aa,Z,N,W);if(B.isSheetEditable()){B.controlFactory.barHandleFreeze[Y](N);if(Y=="top"){B.controlFactory.barMenu[Y](ac,Z,aa)}}}return true};N.ondblclick=B.evt.cellOnDblClick;I.bind("contextmenu",S).disableSelectionSpecial().bind("cellEdit",B.evt.cellEdit)}B.createSpreadsheet(W,P);B.checkMinSize(W);B.controlFactory.tab();var O=B.s,u=O.hiddenRows,U=O.hiddenColumns;if(!u.length||!U.length){u=W.attributes["data-hiddenrows"]||{value:""};U=W.attributes["data-hiddencolumns"]||{value:""};if(u.value.length>0){u=c.toNumbers(u.value.split(","))}if(U.value.length>0){U=c.toNumbers(U.value.split(","))}}Q.actionUI.hide(u,U,B.rows(W),B.cols(W));B.setChanged(true)},enclosure:function(P){var S=l.createElement("div"),R=l.createElement("div"),O=d(R),N=new k.ActionUI(R,S,P,B.cl.scroll,B.s.frozenAt[B.i],d.sheet.max),Q=N.scrollUI,I=0,u=0;P.size=function(){return B.tableSize(P)};S.size=function(){return B.sheetSize(P)};Q.onscroll=function(){if(!B.isBusy()){var T=this,V,U;A([function(){V=N.scrollTo({axis:"x",pixel:T.scrollLeft})},function(){U=N.scrollTo({axis:"y",pixel:T.scrollTop})},function(){if(V||U){if(V&&T.scrollLeft>I){I=T.scrollLeft;B.calcVisibleCol(N)}if(U){if(T.scrollTop>u){u=T.scrollTop;B.calcVisibleRow(N)}B.updateYBarWidthToCorner(N)}B.obj.barHelper().remove();B.autoFillerGoToTd();if(S.inPlaceEdit){S.inPlaceEdit.goToTd()}}}])}};Q.onmousedown=function(){B.obj.barHelper().remove()};R.actionUI=S.actionUI=N;R.scrollUI=S.scrollUI=Q;R.appendChild(R.scrollUI);S.setAttribute("class",B.cl.pane+" "+B.theme.pane);R.appendChild(S);R.setAttribute("class",B.cl.enclosure);R.pane=S;R.table=P;S.table=P;S.enclosure=R;S.$enclosure=O;P.pane=S;P.enclosure=R;P.$enclosure=O;B.controls.pane[B.i]=S;B.controls.panes=B.obj.panes().add(S);B.controls.enclosure[B.i]=O;B.controls.enclosures=B.obj.enclosures().add(R);return R},tab:function(){var u=l.createElement("span"),I=B.controls.tab[B.i]=d(u).appendTo(B.obj.tabContainer());u.setAttribute("class",B.cl.tab+" "+B.theme.tab);B.sheetTab(true,function(N){u.innerHTML=N});u.i=B.i;B.controls.tabs=B.obj.tabs().add(I);return u},customTab:function(N){var u=l.createElement("span"),I=d(u).appendTo(B.obj.tabContainer());u.setAttribute("class",B.cl.tab+" "+B.theme.tab);u.innerHTML=N;return I},inPlaceEdit:function(R,I){R=R||B.obj.tdActive();if(R===null){R=B.rowTds(null,1)[1];B.cellEdit(R)}if(R===null){return}(B.obj.inPlaceEdit().destroy||G)();var Q=B.obj.formula(),N=Q.val(),u,P,O=B.obj.pane();if(!R.isHighlighted){return}u=l.createElement("textarea");P=d(u);O.inPlaceEdit=u;u.i=B.i;u.className=B.cl.inPlaceEdit+" "+B.theme.inPlaceEdit;u.td=R;u.goToTd=function(){this.offset=d(R).position();if(!this.offset.left&&!this.offset.right){d(u).hide()}else{this.setAttribute("style","left:"+(this.offset.left-1)+"px;top:"+(this.offset.top-1)+"px;width:"+this.td.clientWidth+"px;height:"+this.td.clientHeight+"px;min-width:"+this.td.clientWidth+"px;min-height:"+this.td.clientHeight+"px;")}};u.goToTd();u.onkeydown=B.evt.inPlaceEdit.keydown;u.onchange=u.onkeyup=function(){Q[0].value=u.value};u.onfocus=function(){B.setNav(false)};u.onblur=u.onfocusout=function(){B.setNav(true)};u.onpaste=B.evt.pasteOverCells;u.destroy=function(){O.inPlaceEdit=null;B.cellLast.isEdit=(u.value!=N);u.parentNode.removeChild(u);B.controls.inPlaceEdit[u.i]=false};O.appendChild(u);u.onfocus();B.controls.inPlaceEdit[B.i]=u;P.focus().val("").val(Q[0].value);if(I){P.select()}if(d.fn.elastic){d(u).elastic()}},autoFiller:function(O){if(!M.autoFiller){return false}var I=l.createElement("div"),u=l.createElement("div"),N=l.createElement("div");I.i=B.i;I.className=B.cl.autoFiller+" "+B.theme.autoFiller;u.className=B.cl.autoFillerHandle;N.className=B.cl.autoFillerCover;I.onmousedown=function(){var Q=B.obj.tdActive();if(Q){var P=B.getTdLocation(Q);B.cellSetActive(Q,P,true,B.autoFillerNotGroup,function(){var S=B.highlighted(),R=B.getTdLocation(S.last());B.fillUpOrDown(R.row<P.row||R.col<P.col);B.autoFillerGoToTd(Q);B.autoFillerNotGroup=false})}return false};O.autoFiller=B.controls.autoFiller[B.i]=d(I);O.appendChild(I);return true}},autoFillerNotGroup:true,tsv:new TSV(),updateCellsAfterPasteToFormula:function(U){var T=0,S=B.obj.formula(),W=new a();U=U||S.val();var R={row:B.cellLast.row,col:B.cellLast.col},I=S.val(),O=I;if(R.row==0&&R.col==0){return false}var X=B.tsv.parse(I);if(!d.isArray(X)){S.val(X);B.fillUpOrDown(false,X);return true}for(var Q=0;Q<X.length;Q++){B.cellLast.isEdit=true;var u=X[Q];for(var P=0;P<u.length;P++){T++;var N=B.getTd(B.i,Q+R.row,P+R.col);N.row=R.row;N.col=R.col;if(N.length){if(!B.spreadsheets[B.i]||!B.spreadsheets[B.i][Q+R.row]||!B.spreadsheets[B.i][Q+R.row][P+R.col]){continue}var V=B.spreadsheets[B.i][Q+R.row][P+R.col];if(V){M.parent.one("sheetPreCalculation",function(){if((u[P]+"").charAt(0)=="="){V.formula=u[P].substring(1);V.value="";N.setAttribute("data-formula",u[P])}else{V.formula="";V.value=u[P];N.removeData("formula")}});B.calcDependencies.call(V);if(Q==0&&P==0){O=u[P]}}}}}if(I!=O){S.val(O)}B.fillUpOrDown(false,O);B.evt.cellEditDone(true);return true},evt:{inPlaceEdit:{enter:function(u){if(u.shiftKey){return true}return B.evt.cellSetActiveFromKeyCode(u,true)},tab:function(u){if(u.shiftKey){return true}return B.evt.cellSetActiveFromKeyCode(u,true)},keydown:function(u){u=u||f.event;B.trigger("sheetFormulaKeydown",[true]);switch(u.keyCode){case r.ENTER:return B.evt.inPlaceEdit.enter(u);break;case r.TAB:return B.evt.inPlaceEdit.tab(u);break;case r.ESCAPE:B.evt.cellEditAbandon();return false;break}}},formula:{keydown:function(u){u=u||f.event;if(B.readOnly[B.i]){return false}if(B.cellLast.row<0||B.cellLast.col<0){return false}B.trigger("sheetFormulaKeydown",[false]);switch(u.keyCode){case r.C:if(u.ctrlKey){return B.evt.document.copy(u)}case r.X:if(u.ctrlKey){return B.evt.document.cut(u)}case r.Y:if(u.ctrlKey){B.evt.document.redo(u);return false}break;case r.Z:if(u.ctrlKey){B.evt.document.undo(u);return false}break;case r.ESCAPE:B.evt.cellEditAbandon();return true;break;case r.ENTER:B.evt.cellSetActiveFromKeyCode(u,true);return false;break;case r.UNKNOWN:return false}B.cellLast.isEdit=true},If:function(I,u){if(I){B.obj.tdActive().dblclick();return true}return false}},document:{enter:function(u){if(!B.cellLast.isEdit&&!u.ctrlKey){B.obj.tdActive().dblclick()}return false},tab:function(u){B.evt.cellSetActiveFromKeyCode(u)},findCell:function(u){if(u.ctrlKey){B.cellFind();return false}return true},redo:function(u){if(u.ctrlKey&&!B.cellLast.isEdit){B.undo.manager.redo();return false}return true},undo:function(u){if(u.ctrlKey&&!B.cellLast.isEdit){B.undo.manager.undo();return false}return true},copy:function(P,I){var O=B.highlighted(true),Q=B.obj.formula(),N=Q.val(),u=B.toTsv(O,I);Q.val(u).focus().select();x.one("keyup",function(){if(I){Q.val("")}else{Q.val(N)}});return true},cut:function(u){return this.copy(u,true)},pageUpDown:function(u){var O=B.sheetSize(),S=B.obj.pane(),N=S.clientHeight,P=0,Q=0,R,I;if(u){for(I=B.cellLast.row;I>0&&P<N;I--){R=B.getTd(B.i,I,1);if(!R.getAttribute("data-hidden")&&R.is(":hidden")){R.show()}P+=R.parent().height()}}else{for(I=B.cellLast.row;I<O.rows&&P<N;I++){R=B.getTd(B.i,I,1);P+=R.parent().height()}}B.cellEdit(R);return false},keydown:function(u){u=u||f.event;if(B.readOnly[B.i]){return false}if(B.cellLast.row<0||B.cellLast.col<0){return false}var I=B.cellLast.td;if(B.nav){switch(u.keyCode){case r.DELETE:B.toTsv(null,true);B.obj.formula().val("");break;case r.TAB:B.evt.document.tab(u);break;case r.ENTER:B.evt.cellSetActiveFromKeyCode(u);break;case r.LEFT:case r.UP:case r.RIGHT:case r.DOWN:(u.shiftKey?B.evt.cellSetHighlightFromKeyCode(u):B.evt.cellSetActiveFromKeyCode(u));break;case r.PAGE_UP:B.evt.document.pageUpDown(true);break;case r.PAGE_DOWN:B.evt.document.pageUpDown();break;case r.HOME:case r.END:B.evt.cellSetActiveFromKeyCode(u);break;case r.V:if(u.ctrlKey){return B.evt.formula.If(!B.evt.pasteOverCells(u),u)}else{d(I).trigger("cellEdit");return true}break;case r.Y:if(u.ctrlKey){B.evt.document.redo(u);return false}else{d(I).trigger("cellEdit");return true}break;case r.Z:if(u.ctrlKey){B.evt.document.undo(u);return false}else{d(I).trigger("cellEdit");return true}break;case r.ESCAPE:B.evt.cellEditAbandon();break;case r.F:if(u.ctrlKey){return B.evt.formula.If(B.evt.document.findCell(u),u)}else{d(I).trigger("cellEdit");return true}break;case r.CAPS_LOCK:case r.SHIFT:case r.ALT:break;case r.CONTROL:B.obj.formula().focus().select();return true;break;default:d(I).trigger("cellEdit");return true;break}return false}}},pasteOverCells:function(I){I=I||f.event;if(I.ctrlKey||I.type=="paste"){var u=function(){B.updateCellsAfterPasteToFormula()};var N=x.one("keyup",function(){u();u=function(){};N.mouseup()}).one("mouseup",function(){u();u=function(){};N.keyup()});B.setDirty(true);B.setChanged(true);return true}return false},cellEditDone:function(N){(B.obj.inPlaceEdit().destroy||G)();if(B.cellLast.isEdit||N){var P=B.obj.formula(),O=B.obj.tdActive();if(B.isFormulaEditable(O)){if(O&&B.cellLast.row>0&&B.cellLast.col>0){var I=P.val(),u=O.jSCell;if(!u.edited){u.edited=true;B.obj.cellsEdited().push(u)}M.parent.one("sheetPreCalculation",function(){if(I.charAt(0)=="="&&B.formulaParser){O.setAttribute("data-formula",I);u.value=I;u.formula=I}else{O.removeAttribute("data-formula");u.value=I;u.formula=""}});B.calcDependencies.call(u);B.cellLast.isEdit=false;B.trigger("sheetCellEdited",[u])}}}},cellEditAbandon:function(u){(B.obj.inPlaceEdit().destroy||G)();B.highlighter.clearBar().clear();if(!u){B.calc()}B.cellLast.td=null;B.cellLast.row=0;B.cellLast.col=0;B.rowLast=0;B.colLast=0;B.highlighter.start={row:0,col:0};B.highlighter.end={row:0,col:0};B.labelUpdate("",true);B.obj.formula().val("").blur();B.autoFillerHide();return false},cellSetHighlightFromKeyCode:function(P){var O=B.highlightedLastOrdered(),N=B.sheetSize(),S=B.obj.tdActive(),Q=B.getTdLocation(S),R=O.start,u=O.end,I=B.highlighter;switch(P.keyCode){case r.UP:if(R.row<Q.row){R.row--;R.row=E.max(R.row,1);break}u.row--;u.row=E.max(u.row,1);break;case r.DOWN:if(R.row===R.end){R.row++;R.row=E.min(R.row,N.rows);break}if(R.row<Q.row){R.row++;R.row=E.max(R.row,1);break}u.row++;u.row=E.min(u.row,N.rows);break;case r.LEFT:if(R.col<Q.col){R.col--;R.col=E.max(R.col,1);break}u.col--;u.col=E.max(u.col,1);break;case r.RIGHT:if(R.col<Q.col){R.col++;R.col=E.min(R.col,N.cols);break}u.col++;u.col=E.min(u.col,N.cols);break}B.highlighter.start=R;B.highlighter.end=u;B.cycleCellArea(function(T){I.set(T.td)},R,u);return false},cellSetActiveFromKeyCode:function(P,u){var Q={row:B.cellLast.row,col:B.cellLast.col},O=false,N,I=false;switch(P.keyCode){case r.UP:Q.row--;break;case r.DOWN:Q.row++;break;case r.LEFT:Q.col--;break;case r.RIGHT:Q.col++;break;case r.ENTER:Q=B.evt.incrementAndStayInGrid(B.highlightedLastOrdered(),Q,"row","col",P.shiftKey);O=true;N=B.highlighted();if(N.length>1){I=true}else{if(!u){Q.row+=(P.shiftKey?-1:1)}if(M.autoAddCells&&Q.row>B.sheetSize().rows){B.controlFactory.addRow()}}break;case r.TAB:Q=B.evt.incrementAndStayInGrid(B.highlightedLastOrdered(),Q,"col","row",P.shiftKey);O=true;N=B.highlighted();if(N.length>1){I=true}else{if(!u){Q.col+=(P.shiftKey?-1:1)}if(M.autoAddCells&&Q.col>B.sheetSize().cols){B.controlFactory.addColumn()}}break;case r.HOME:Q.col=1;break;case r.END:Q.col=B.obj.tdActive().parent().children("td").length-1;break}Q.col=Q.col||1;Q.row=Q.row||1;if(!B.cellLast.isEdit||O){var R=B.getTd(B.i,Q.row,Q.col);if(R){B.cellEdit(R,null,I);return false}}return true},incrementAndStayInGrid:function(O,P,I,u,N){if(N){P[I]--;if(P[I]<O.start[I]){P[I]=O.end[I];P[u]--}if(P[u]<O.start[u]){P[u]=O.end[u]}}else{P[I]++;if(P[I]>O.end[I]){P[I]=O.start[I];P[u]++}if(P[u]>O.end[u]){P[u]=O.start[u]}}return P},cellOnMouseDown:function(u){B.obj.formula().blur();if(u.shiftKey){B.getTdRange(u,B.obj.formula().val())}else{B.cellEdit(u.target,true)}},cellOnDblClick:function(u){if(B.isBusy()){return false}B.controlFactory.inPlaceEdit();return true},cellEdit:function(u){if(B.isBusy()){return false}B.controlFactory.inPlaceEdit(null,true);return true},barInteraction:{first:0,last:0,selecting:false,select:function(N){if(!N){return}if(!N.type=="bar"){return}var u=N.entity,I=B.getBarIndex[u](N);if(I<0){return false}B[u+"Last"]=I;B.evt.barInteraction.last=B.evt.barInteraction.first=I;B.cellSetActiveBar(u,B.evt.barInteraction.first,B.evt.barInteraction.last);B.evt.barInteraction.first=B.evt.barInteraction.last=B[u+"Last"]=I;B.evt.barInteraction.selecting=true;x.one("mouseup",function(){B.evt.barInteraction.selecting=false});return false}}},refreshColumnLabels:function(Q){Q=Q||0;var I=B.obj.barMenuParentTop();if((I)&&(I.length)){var P=I.get(0);if(d.isFunction(P.destroy)){P.destroy()}}var u=B.controls.bar.x.th[B.i],O;if(!u){return}for(var N=g.max(Q,0);N<u.length;N++){if(N>0){O=u[N];O.text(h.columnLabelString(O[0].cellIndex))}}},refreshRowLabels:function(P,u){P=P||0;var I=B.controls.bar.y.th[B.i],O;if(!I){return}u=u||I.length;for(var N=P;N<u;N++){if(N>0){O=I[N];O.text(O[0].parentNode.rowIndex)}}},isCell:function(u){if(u&&u.tagName&&u.tagName=="TD"&&u.type&&u.type=="cell"){return true}return false},isBar:function(u){if(u&&u.tagName&&u.tagName=="TH"&&u.type&&u.type=="bar"){return true}return false},readOnly:[],isSheetEditable:function(u){u=u||B.i;return(M.editable==true&&!B.readOnly[u])},isFormulaEditable:function(u){if(M.lockFormulas){if(u.data("formula")!==K){return false}}return true},toggleFullScreen:function(){if(!B){return}B.evt.cellEditDone();var N=B.obj.fullScreen(),Q=B.obj.pane();if(N.is(":visible")){v.unbind("jSResize");z.removeClass("bodyNoScroll");M.parent=N[0].origParent;M.parent.prepend(N.children());N.remove();B.sheetSyncSize();Q.resizeScroll();B.trigger("sheetFullScreen",[false])}else{z.addClass("bodyNoScroll");var O=d(M.parent),N=l.createElement("div"),I=d._data(M.parent[0],"events");N.className=B.cl.fullScreen+" "+B.theme.fullScreen+" "+B.cl.parent;N.origParent=O;M.parent=B.controls.fullScreen=d(N).append(O.children()).appendTo(z);v.bind("resize",function(){v.trigger("jSResize")}).bind("jSResize",function(){this.w=v.width();this.h=v.height();M.parent.width(this.w).height(this.h);B.sheetSyncSize();Q.resizeScroll()}).trigger("jSResize");O.trigger("sheetFullScreen",[true]);for(var P in I){for(var u=0;u<I[P].length;u++){M.parent.bind(P,I[P][u].handler)}}}},renameSheet:function(u){if(w(u)){return false}if(u>-1){B.sheetTab()}return true},switchSheet:function(u){if(w(u)){return false}if(u==-1){B.addSheet()}else{if(u!=B.i){B.setActiveSheet(u);B.calc(u)}}return true},tuneTableForSheetUse:function(N){var I=d(N);B.controls.table[B.i]=I.addClass(B.cl.table).addClass(B.theme.table).attr("id",B.id+B.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");N.spreadsheetIndex=B.i;B.formatTable(N);B.sheetDecorateRemove(false,I);B.controls.tables=B.obj.tables().add(N);var O=I.attr("data-frozenatrow")*1,u=I.attr("data-frozenatcol")*1;if(!B.s.frozenAt[B.i]){B.s.frozenAt[B.i]={row:0,col:0}}if(O){B.s.frozenAt[B.i].row=O}if(u){B.s.frozenAt[B.i].col=u}},createSpreadsheet:function(I,u){this.createSpreadsheetForArea(I,u)},createSpreadsheetForArea:function(W,R,P,T,Q,X,S){var Z=B.rows(W),Y,I,V=(M.loader!==null?M.loader:null),u=M.colMargin+"px",O=(V!==null?V.setRowHeight:function(ab,af,ae){var ad,ac,aa=u;if((ad=ae.nextSibling)===undefined){return aa}if((ac=ad.style)===undefined){return aa}if(ac.height!==undefined){aa=ac.height}ae.style.height=aa});P=P||0;T=T||Z.length-1;Q=Q||0;X=X||Z[0].children.length-1;if(P===0&&Q===0){W.spreadsheet=B.spreadsheets[R]=[]}Y=T;if(Y<0||I<0){return}do{var U=Z[Y];I=X;if(U===undefined){if(S){B.controlFactory.addCells(null,false,Y-(Z.length-1),"row-init");U=Z[Y]}else{continue}}do{var N=U.children[I];if(N===undefined){if(S){B.controlFactory.addCells(null,false,I-(Z[0].children.length-1),"col-init");N=U.children[I]}else{continue}}if(Y>0&&I>0){if(!N.jSCell){B.createCell(R,Y,I)}}else{if(I==0&&Y>0){N.type="bar";N.entity="left";N.innerHTML=Y;N.className=B.cl.barLeft+" "+B.cl.barLeft+"_"+B.i+" "+B.theme.bar;O.call(V,R,Y,N)}if(Y==0&&I>0){N.type="bar";N.entity="top";N.innerHTML=h.columnLabelString(I);N.className=B.cl.barTop+" "+B.cl.barTop+"_"+B.i+" "+B.theme.bar}if(Y==0&&I==0){N.type="bar";N.entity="corner";N.className=B.theme.bar+"  "+B.cl.barCorner;B.controls.bar.corner[B.i]=N}}}while(I-->Q)}while(Y-->P)},updateYBarWidthToCorner:function(u){var O=u.scrolledArea,T=u.table,Q=T.tBody,R=T.corner,N=g.min(M.initCalcRows+O.end.row,O.end.row+20,Q.lastChild.rowIndex),P=Q.children[N],I,S;if(P===K){return}I=P.children[0];S=(I.innerText!==K?I.innerText:I.textContent);R.col.style.width=(f.defaultCharSize.width*S.length)+"px"},toggleHideRow:function(u){u=u||B.rowLast;if(!u){return}var N=B.rows()[u],I=B.obj.pane().actionUI;I.toggleHideRow(N,u);B.autoFillerGoToTd()},toggleHideColumn:function(I){I=I||B.colLast;if(!I){return}var u=B.cols()[I],N=B.obj.pane().actionUI;N.toggleHideColumn(u,I);B.autoFillerGoToTd()},rowShowAll:function(){B.obj.pane().actionUI.rowShowAll()},columnShowAll:function(){B.obj.pane().actionUI.columnShowAll()},merge:function(R){R=R||B.highlighted();if(!R.length){return}var P=[],u=R[0],O=R[R.length-1],W=B.getTdLocation(u),I=B.getTdLocation(O),Z={},U={},T=0,V=0,Y=new a(),Q=R.length-1,X,aa,N,S;if(W.row){B.setDirty(true);B.setChanged(true);if(W.row<I.row){Z.row=W.row;U.row=I.row;N=u}else{Z.row=I.row;U.row=W.row;N=O}if(N.getAttribute("rowSpan")||N.getAttribute("colSpan")){return false}if(W.col<I.col){Z.col=W.col;U.col=I.col}else{Z.col=I.col;U.col=W.col}V=(U.row-Z.row)+1;T=(U.col-Z.col)+1;S=B.getTdLocation(N);do{aa=R[Q];X=aa.jSCell;if(X.formula||X.value){P.unshift(X.formula?"("+X.formula.substring(1)+")":X.value)}M.parent.one("sheetPreCalculation",function(){if(aa.cellIndex!=S.col||aa.parentNode.rowIndex!=S.row){X.formula=null;X.value="";X.html="";X.defer=N.jSCell;X.calcLast=Y;aa.removeAttribute("data-formula");aa.removeAttribute("data-celltype");aa.innerHTML="";aa.style.display="none";aa.colSpan=T-(aa.cellIndex-N.cellIndex);aa.rowSpan=V-(aa.parentNode.rowIndex-N.parentNode.rowIndex)}});B.calcDependencies.call(X)}while(Q--);N.jSCell.value=P.join(" ");N.jSCell.formula=(N.jSCell.formula?P.join(" "):"");N.jSCell.calcLast=Y;N.style.display="";N.setAttribute("rowSpan",V);N.setAttribute("colSpan",T);B.calcDependencies.call(N.jSCell);B.evt.cellEditDone();B.autoFillerGoToTd(N);B.cellSetActive(N,S)}return true},unmerge:function(I){I=I||B.highlighted();if(!I){return}var Q=B.getTdLocation(I),R=new a(),T=E.max(I.getAttribute("rowSpan")*1,1)-1,u=E.max(I.getAttribute("colSpan")*1,1)-1,P=T+Q.row,N,S,O=[];if(T==0&&u==0){return false}do{N=Q.col+u;do{S=B.getTd(B.i,P,N);S.style.display="";S.removeAttribute("colSpan");S.removeAttribute("rowSpan");S.jSCell.defer=null;B.calcDependencies.call(S.jSCell,R);O.push(S)}while(N-->Q.col)}while(P-->Q.row);B.evt.cellEditDone();B.autoFillerGoToTd(I);B.cellSetActive(I,Q);B.highlighter.set(d(O));return true},fillUpOrDown:function(S,U,W){B.evt.cellEditDone();W=W||B.highlighted(true);if(W.length<1){return false}var P=B.obj.tdActive(),T=new a();if(W.length<1){return false}var Q=B.getTdLocation(W[0].td),X=B.getTdLocation(W[W.length-1].td),u=B.getTdLocation(P),N={row:0,col:0},I=U||P.jSCell.value,V=false,O=W.length-1,R=function(){};U=U||P.jSCell.value;if(O>=0){if(U.charAt&&U.charAt(0)=="="){if(O>=0){do{if(!S){N.row=u.row-X.row;N.col=u.col-X.col}else{N.row=u.row-Q.row;N.col=u.col-Q.col}I=B.reparseFormula(U,N);M.parent.one("sheetPreCalculation",function(){W[O].formula=I;W[O].value="";W[O].td.setAttribute("data-formula",I)});B.calcDependencies.call(W[O],T)}while(O--);return true}}else{if((V=!w(I))||I.length>0){if(V&&I!=""){I*=1;if(S){I-=W.length-1}R=function(){I++}}}do{M.parent.one("sheetPreCalculation",function(){W[O].formula="";W[O].value=I+"";W[O].td.removeAttribute("data-formula")});B.calcDependencies.call(W[O],T);R()}while(O--);return true}}return false},toTsv:function(W,O,U){W=W||B.highlighted(true);if(W.type){W=[W]}U=U||function(Z,Y){if(O){M.parent.one("sheetPreCalculation",function(){Y.formula="";Y.value=""});B.calcDependencies.call(Y,T)}};var R=[],V,Q,I={},T=new a(),N=W.length-1,X,u;if(N>=0){V=B.getTdLocation(W[0].td);Q=B.getTdLocation(W[W.length-1].td);I.row=E.min(V.row,Q.row);I.col=E.min(V.col,Q.col);do{var P=B.getTdLocation(W[N].td),S=(W[N].formula?"="+W[N].formula:W[N].value);X=E.abs(P.row-I.row);u=E.abs(P.col-I.col);if(!R[X]){R[X]=[]}if((S+="").match(/\n/)){S='"'+S+'"'}R[X][u]=(S||"");U.call(W[N].td,P,W[N])}while(N-->0);N=R.length-1;do{R[N]=R[N].join("\t")}while(N-->0);return R.join("\n")}return""},offsetFormulas:function(S,R,N,Q){var I=B.sheetSize(),P={first:{row:1,col:1},last:{row:I.rows,col:I.cols}},O=new a(),u=[];B.cycleCells(function(){var T=this;if(this.formula&&typeof this.formula=="string"&&B.isFormulaEditable(this.td)){this.formula=B.reparseFormula(this.formula,R,S,N,Q);this.td.setAttribute("data-formula","="+this.formula)}u.push(function(){B.calcDependencies.call(T,O,true)})},P.first,P.last);while(u.length){u.pop()()}B.evt.cellEditDone()},reparseFormula:function(P,O,N,u,I){return P.replace(h.regEx.cell,function(R,S,W,X){if(S=="SHEET"){return R}O=O||{loc:0,row:0};var Q={row:W*1,col:h.columnLabelIndex(S)},V,U,T={row:W,col:S,use:false};if(N){if(I){if(u){if(Q.col&&Q.col==N.col-1){T.col="#REF!";T.use=true}if(Q.row&&Q.row==N.row-1){T.row="#REF!";T.use=true}if(Q.col>=N.col){V=true}if(Q.row>=N.row){U=true}}else{if(N.col&&Q.col==N.col){T.col="#REF!";T.use=true}if(N.row&&Q.row==N.row){T.row="#REF!";T.use=true}if(N.col&&Q.col>N.col){V=true}if(N.row&&Q.row>N.row){U=true}}if(T.use){return T.col+T.row}if(V){Q.col+=O.col;return B.makeFormula(Q)}if(U){Q.row+=O.row;return B.makeFormula(Q)}}else{if(u){if(N.col&&Q.col>=N.col){V=true}if(N.row&&Q.row>=N.row){U=true}}else{if(N.col&&Q.col>N.col){V=true}if(N.row&&Q.row>N.row){U=true}}if(V){Q.col+=O.col;return B.makeFormula(Q)}if(U){Q.row+=O.row;return B.makeFormula(Q)}}}else{return B.makeFormula(Q,O)}return R})},makeFormula:function(I,u){u=d.extend({row:0,col:0},u);I.col+=u.col;I.row+=u.row;if(I.col<0){I.col=0}if(I.row<0){I.row=0}return h.parseCellName(I.col,I.row)},cycleCells:function(P,S,N,I){I=I||B.i;S=S||{row:1,col:1};if(!N){var U=B.sheetSize();N={row:U.rows,col:U.cols}}var u=B.spreadsheets[I],O=N.row,R,T,Q;if(O<S.row){return}do{R=N.col;T=u[O];do{Q=T[R];P.call(Q,I,O,R)}while(R-->S.col)}while(O-->S.row)},cycleCellsAll:function(O){var P=B.i,N,I,u;for(N=0;N<=B.sheetCount;N++){B.i=N;I=B.sheetSize();u={row:I.rows,col:I.cols};B.cycleCells(O,{row:0,col:0},u,N)}B.i=P},cycleCellArea:function(T,X,Q,P,U){var u={start:{},end:{}},S,W,Y,V,O=B.i,I={cell:[],td:[]},R=B.spreadsheets[O],N=(U?"unshift":"push");if(P){u.start=X;u.end=Q}else{u.start.row=E.max(E.min(X.row,Q.row),1);u.start.col=E.max(E.min(X.col,Q.col),1);u.end.row=E.max(X.row,Q.row,1);u.end.col=E.max(X.col,Q.col,1)}S=u.end.row;do{W=u.end.col;Y=R[S]||null;do{if(Y){V=Y[W]||null;if(V){I.cell[N](V);I.td[N](V.td)}}}while(W-->u.start.col)}while(S-->u.start.row);if(T){T(I)}},formatTable:function(Y){var W=M.newColumnWidth+"px",R=M.colMargin+"px",I=Y.children,P=I.length-1,O,N,U,u,T,X,Q,V=(M.loader!==null?M.loader:null),S=(V!==null?V.setWidth:function(Z,aa,ab){ab.style.width=W});if(P>-1){do{switch(I[P].nodeName){case"TBODY":X=true;U=I[P];break;case"COLGROUP":Q=true;u=I[P];break}}while(P--)}else{}if(!U){U=l.createElement("tbody");if(I.length>0){do{U.appendChild(I[0])}while(I.length)}}if(!u||u.children.length<1){u=l.createElement("colgroup");Y.appendChild(u);Y.appendChild(U);if(U.children.length>0){T=U.children[0];for(P=0,O=g.min(T.children.length,M.initCalcCols);P<O;P++){N=l.createElement("col");S.call(V,B.i,P,N);u.appendChild(N)}for(P=0,O=g.min(U.children.length,M.initCalcRows);P<O;P++){U.children[P].style.height=R}}}Y.tBody=U;Y.colGroup=u;Y.removeAttribute("width");Y.style.width=""},checkMinSize:function(P){var N=B.tableSize(P),Q=M.minSize.rows||0,u=M.minSize.cols||0,O=B.obj.pane().actionUI,I=O.frozenAt;Q=g.max((I.row>Q?I.row+1:Q),1,M.initScrollRows);u=g.max((I.col>u?I.col+1:u),1,M.initScrollCols);if(N.cols<u){u-=N.cols;B.controlFactory.addColumnMulti(null,u,false,true,true)}N=B.tableSize(P);if(N.rows<Q){Q-=N.rows;B.controlFactory.addRowMulti(null,Q,false,true,true)}},theme:null,highlighter:null,resizable:function(I,u){if(!I.data("resizable")){I.resizable(u)}},busy:[],setBusy:function(u){if(u){B.busy.push(u)}else{B.busy.pop()}},isBusy:function(){return(B.busy.length>0)},draggable:function(I,u){if(!I.data("jSdraggable")){I.data("jSdraggable",true).draggable(u)}},nearest:function(I,u){return d(I).nearest(u)},resizeBar:{top:function(Q,N,S,I){B.obj.barTopControls().remove();var O=l.createElement("div"),R=d(O).addClass(B.cl.barController+" "+B.theme.barResizer).width(Q.width()).prependTo(Q),u,P;B.controls.bar.x.controls[B.i]=B.obj.barTopControls().add(R);B.resizableCells(R,{handles:"e",start:function(U,T){B.autoFillerHide();B.setBusy(true);u=B.col(I,N);if(S.freezeHandleTop){S.freezeHandleTop.remove()}u.removeAttribute("width")},resize:function(U,T){u.style.width=T.size.width+"px";if(S.inPlaceEdit){S.inPlaceEdit.goToTd()}},stop:function(U,T){B.setBusy(false);S.resizeScroll();B.followMe();B.setDirty(true)},minWidth:32});P=O.children[0];P.style.height=Q.outerHeight()+"px";P.style.position="absolute"},left:function(O,R,N,V){B.obj.barLeftControls().remove();var Q=O.offset(),W=l.createElement("div"),T=d(W).addClass(B.cl.barController+" "+B.theme.barResizer).prependTo(O).offset({top:Q.top,left:Q.left}),U=O[0],P=O.next()[0],X=P.parentNode,I=l.createElement("div"),u=d(I).addClass(B.cl.barControllerChild).height(O.height()).prependTo(T),S;B.controls.bar.y.controls[B.i]=B.obj.barLeftControls().add(T);B.resizableCells(u,{handles:"s",start:function(){B.autoFillerHide();B.setBusy(true);if(N.freezeHandleLeft){N.freezeHandleLeft.remove()}X.removeAttribute("height");U.removeAttribute("height");P.removeAttribute("height")},resize:function(Z,Y){W.style.height=P.style.height=U.style.height=X.style.height=Y.size.height+"px";if(N.inPlaceEdit){N.inPlaceEdit.goToTd()}},stop:function(Z,Y){B.setBusy(false);N.resizeScroll();B.followMe();B.setDirty(true)},minHeight:15});S=I.children[0];S.style.width=O.outerWidth()+"px";S.style.position="absolute"},corner:function(){}},sheetDecorateRemove:function(I,u){u=u||B.obj.tables();u=(I?u.clone():u);u.find("td."+B.theme.tdActive).removeClass(B.theme.tdActive);u.find("td."+B.theme.tdHighlighted).removeClass(B.theme.tdHighlighted);return u},labelUpdate:function(I,u){if(!u){I=h.parseCellName(I.col,I.row);if(I){B.obj.label().text(I)}}else{B.obj.label().text(I)}},cellEdit:function(Q,O,N){B.autoFillerNotGroup=true;B.evt.cellEditDone();if(Q===null){return}var P=B.getTdLocation(Q),u=Q.jSCell,I;if(u===null){return}if(u.uneditable){return}B.trigger("sheetCellEdit",[u]);if(Q!==B.cellLast.td){B.followMe(Q)}else{B.autoFillerGoToTd(Q)}B.labelUpdate(P);if(u.formula.length>0){I="="+u.formula}else{I=u.value}B.obj.formula().val(I).blur();B.cellSetActive(Q,P,O,false,null,N)},cellSetActive:function(P,R,I,T,Q,N){R=R||B.getTdLocation(P);if(R.col!=K){B.cellLast.td=P;B.cellLast.row=B.rowLast=R.row;B.cellLast.col=B.colLast=R.col;if(!N){B.highlighter.set(P).setStart(R).setEnd(R)}if(P===null){return}B.highlighter.setBar("left",P.barLeft).setBar("top",P.barTop);var S,U;switch(M.cellSelectModel){case k.excelSelectModel:case k.googleDriveSelectModel:S=function(){};U=function(){};break;case k.openOfficeSelectModel:S=function(V){if(B.isCell(V)){B.cellEdit(V)}};U=function(){};break}if(I){var u={},O=B.obj.pane();u.last=R;O.onmousemove=function(ad){ad=ad||f.event;var ae=ad.target||ad.srcElement;if(B.isBusy()){return false}var V=B.highlighter.end=B.getTdLocation(ae),af=true,ag=B.highlighter;if(V.col<1||V.row<1||V.col==J||V.row==J){return false}if(T){af=false;if(R.col==V.col||R.row==V.row){af=true}}if((u.last.col!=V.col||u.last.row!=V.row)&&af){S(ae);B.cycleCellArea(function(ai){ag.set(ai.td)},R,V,false,true)}B.followMe(d(ae));var Y=ad.clientY,Z=ad.clientX,aa=O.$enclosure.offset(),ah=B.getTdLocation(ae),ab=ah.row,X=ah.col,W=false,ac;if(w(ab)||w(X)){return false}if(Y>aa.top){W=true;ab--}if(Z>aa.left){W=true;X--}if(W){if(ab<1||X<1){return false}ac=B.spreadsheets[B.i][ab][X];B.followMe(d(ac.td),true)}u.last=V;return true};l.onmouseup=function(){O.onmousemove=null;O.onmousemove=null;O.onmouseup=null;l.onmouseup=null;if(Q){Q()}}}}},colLast:0,rowLast:0,cellLast:{td:[],row:0,col:0,isEdit:false},highlightedLastOrdered:function(){var I=this.highlighter,u={start:{},end:{}};u.start.row=g.min(I.start.row,I.end.row);u.start.col=g.min(I.start.col,I.end.col);u.end.row=g.max(I.start.row,I.end.row);u.end.col=g.max(I.start.col,I.end.col);return u},cellStyleToggle:function(R,Q,O){O=O||B.highlighted();if(O.length<1){return false}B.setDirty(true);var S,P,N=O.length-1,u=B.obj.cellsEdited(),I;if(N>=0){I=O[0].className.match(R);do{S=O[N];P=d(S);if(Q){P.removeClass(Q)}if(I){P.removeClass(R)}else{P.addClass(R)}if(!S.jSCell.edited){S.jSCell.edited=true;u.push(S.jSCell)}}while(N--);return true}return false},cellTypeToggle:function(O,I){I=I||B.highlighted(true);if(I.length<1){return}var N=I.length-1,u=I[N].cellType==O;if(N>=0){do{if(u){I[N].cellType=null}else{I[N].cellType=O}I[N].calcLast=0;B.updateCellValue.call(I[N])}while(N--)}},fontReSize:function(Q,P){P=P||B.highlighted();if(P.length<1){return false}var I=0;switch(Q){case"up":I=1;break;case"down":I=-1;break}var S,R,O=P.length-1,N,u=B.obj.cellsEdited();if(O>=0){do{S=P[O];R=d(S);N=(R.css("font-size")+"").replace("px","")*1;R.css("font-size",((N||10)+I)+"px");if(!S.jSCell.edited){S.jSCell.edited=true;u.push(S.jSCell)}}while(O--);return true}return false},callStack:0,updateCellValue:function(Y,T,W){var S,Z,X,U,I,u,O,Q,N,V="";if(this===K||this===null||this.jS===K){u=false;if((S=B.spreadsheets[Y])===undefined){V=new p(V);V.html="#REF!";V.cell=null}else{if((Z=S[T])!==undefined){if((X=Z[W])!==undefined){u=true}}}if(u===false){if(M.loader!==null){if((X=M.loader.jitCell(Y,T,W))===null){if(M.loader.hasSpreadsheetAtIndex(Y)){return""}else{return"#REF!"}}else{if(typeof X.value==="string"){X.td.innerHTML=X.value;return X.value}}}else{return V}}}else{X=this}if(X===undefined){return""}X.oldValue=X.value;if(X.result){delete X.result}switch(X.state[X.state.length-1]){case"updating":return M.error({error:B.msg.loopDetected});case"updatingDependencies":return(X.valueOverride!=K?X.valueOverride:X.value)}if(X.defer){return B.updateCellValue.call(X.defer)}X.state.push("updating");X.fnCount=0;X.result=null;if(X.calcLast!=B.calcLast||X.calcDependenciesLast!=B.calcDependenciesLast){X.valueOverride=null;X.calcLast=B.calcLast;X.calcDependenciesLast=B.calcDependenciesLast;X.needsUpdated=true;X.calcCount++;if(X.formula.length>0){try{if(X.formula.charAt(0)==="="){X.formula=X.formula.substring(1)}if(X.formula.length<1){return""}var P;if(B.callStack){if(!X.formulaParser){X.formulaParser=f.Formula(B.cellHandler)}P=X.formulaParser}else{P=B.formulaParser}B.callStack++;P.setObj(X);X.result=P.parse(X.formula);X.result.cell=X;if(X.hasOwnProperty("loadedFrom")){M.loader.setCellAttribute(X.loadedFrom,"cache",X.result)}}catch(R){X.result=R.toString()}B.callStack--;if(X.result&&X.cellType&&M.cellTypeHandlers[X.cellType]){X.result=M.cellTypeHandlers[X.cellType].call(X,X.result)}I=B.filterValue.call(X)}else{if(X.value&&X.cellType&&M.cellTypeHandlers[X.cellType]){X.result=M.cellTypeHandlers[X.cellType].call(X,X.value);I=B.filterValue.call(X)}else{if(typeof X.value==="string"){U=B.s.cellStartingHandlers[X.value.charAt(0)];if(U){X.valueOverride=U.call(X,X.value)}else{U=B.s.cellEndHandlers[X.value.charAt(X.value.length-1)];if(U){X.valueOverride=U.call(X,X.value)}}}I=B.filterValue.call(X)}}if(M.loader!==null){O=X.td;if(Y===K){Y=X.sheet}if(T===K||W===K){Q=B.getTdLocation(O);T=Q.row;W=Q.col}if((N=M.loader.getCell(Y,T,W))!==null){N.formula=X.formula;N.cellType=X.cellType;N.value=X.value+"";N.cache=I;if(X.uneditable===true){N.uneditable=true}}}}if(X.value===K){X.value=new p("")}X.value.cell=X;if(X.value.cell===K){switch(typeof(X.value)){case"string":default:X.value=new p(X.value);X.value.cell=X}}X.needsUpdated=false;X.state.pop();return(X.valueOverride!=K?X.valueOverride:X.value)},updateCellDependencies:function(){if((this.state||(this.state=[])).length){return}var P,I,O,N,u=this.calcLast,Q=this.calcDependenciesLast;this.state.push("updatingDependencies");P=this.dependencies||[];this.dependencies=[];N=P.length-1;if(N>-1){do{I=P[N];if(I.jSCell!==undefined){I=I.jSCell}O=B.getTdLocation(I.td);I.calcDependenciesLast=0;B.updateCellValue.call(I,I.sheet,O.row,O.col);if(O.row>0&&O.col>0){B.updateCellDependencies.call(I)}}while(N--)}if(this.dependencies.length===0&&this.calcLast===u&&this.calcDependenciesLast===Q){this.dependencies=P}this.state.pop()},filterValue:function(){var I,N,u=this.result,P=this.td,O;if(u!==K&&u!==null){this.value=u;N=u.html}O=typeof this.value;if(O==="string"||(O==="object"&&this.value.toUpperCase!==K)&&this.value.length>0){I=M.encode(this.value)}if(P===null){return this.result}if(N!==K){}else{if(I!==K){N=I}else{if(this.value!==K){N=this.value}}}switch(typeof N){case"object":if(N.appendChild!==K){P.appendChild(N);break}case"string":default:P.innerHTML=N}return P.innerHTML},cellHandler:{variable:function(){if(arguments.length){var O=arguments[0],I=arguments[1],P=B.s.formulaVariables,N,u;switch(O.toLowerCase()){case"true":u=new t(true);u.html="TRUE";return u;case"false":u=new t(false);u.html="FALSE";return u}if(N=P[O]&&!I){return N}else{if(N&&I){return N[I]}else{return""}}}},time:function(I,u){return i.fromString(I,u)},number:function(u){switch(typeof u){case"number":return u;case"string":if(!w(u)){return u*1}case"object":if(u.getMonth){return e.toCentury(u)}}return u},numberInverted:function(N){var I=B.cellHandler.number(N),u=new s(I.valueOf()*-1);if(I.html){u.html=I.html}return u},performMath:function(R,Q,P){if(Q===K){Q=0}if(P===K){P=0}var O,N,S=true,u=true,U=[],T,I=function(V){return V};switch(O=(typeof Q.valueOf())){case"number":break;case"string":if(!w(Q)){Q*=1}else{S=false}break;case"object":if(Q.getMonth){Q=e.toCentury(Q);I=e.get}else{S=false}break;default:S=false}switch(N=(typeof P.valueOf())){case"number":break;case"string":if(!w(P)){P*=1}else{u=false}break;case"object":if(P.getMonth){P=e.toCentury(P)}else{u=false}break;default:u=false}if(!S&&R!=="+"){U.push("not a number: "+Q);Q=0}if(!u){U.push("not a number: "+P);P=0}if(U.length){}switch(R){case"+":T=Q+P;break;case"-":T=Q-P;break;case"/":T=Q/P;if(T==Infinity||T==J){T=0}break;case"*":T=Q*P;break;case"^":T=E.pow(Q,P);break}return I(T)},cellValue:function(I){var N=h.parseLocation(I.colString,I.rowString),u;u=B.cellHandler.createDependencyOnLocation.call(this,this.sheet,N.row,N.col);if(u!==null){B.updateCellValue.call(u,this.sheet,N.row,N.col);return(u.valueOverride!=K?u.valueOverride:u.value)}else{return""}},createDependencyOnLocation:function(I,Q,N){var O,P,u;if((O=B.spreadsheets[I])===K||(P=O[Q])===K||(u=P[N])===K){if(M.loader!==null){u=M.loader.jitCell(I,Q,N)}}if(u===K||u===null){return null}if(!u.dependencies){u.dependencies=[]}if(d.inArray(this,u.dependencies)<0){u.dependencies.push(this)}u.jS=B;return u},createDependencyOnCell:function(u){if(!u.dependencies){u.dependencies=[]}if(d.inArray(this,u.dependencies)<0){u.dependencies.push(this)}u.jS=B},cellRangeValue:function(O,Q){var P=h.parseLocation(O.colString,O.rowString),S=h.parseLocation(Q.colString,Q.rowString),U=E.max(P.row,S.row),V=E.min(P.row,S.row),N=E.max(P.col,S.col),I=E.min(P.col,S.col),T=B.spreadsheets[this.sheet],R=B.cellHandler.createDependencyOnLocation,aa=B.cellHandler.createDependencyOnCell,u=B.updateCellValue,Z=[],X,W,Y;if(T===K){B.spreadsheets[this.sheet]=T={}}if(U>=V||N>=I){do{X=N;Y=(T[U]!==K?T[U]:null);do{if(Y===null||(W=Y[X])===K){W=R.call(this,this.sheet,U,X)}else{aa.call(this,W)}Z.unshift(u.call(W,this.sheet,U,X))}while(X-->I)}while(U-->V);return Z}return Z},fixedCellValue:function(I,u){return B.cellHandler.cellValue.call(this,I.colString,I.rowString,u.colString,u.rowString)},fixedCellRangeValue:function(I,u){return B.cellHandler.cellRangeValue.call(this,I.colString,I.rowString,u.colString,u.rowString)},remoteCellValue:function(O,N){var P=h.parseLocation(N.colString,N.rowString),I=h.parseSheetLocation(O),u;if(I<0){I=B.getSpreadsheetIndexByTitle(O)}u=B.cellHandler.createDependencyOnLocation.call(this,I,P.row,P.col);return B.updateCellValue.call(u,I,P.row,P.col)},remoteCellRangeValue:function(R,u,N){var I=h.parseLocation(u.colString,u.rowString),Q=h.parseLocation(N.colString,N.rowString),S=h.parseSheetLocation(R);if(S<0){S=B.getSpreadsheetIndexByTitle(R)}var T=[];for(var P=I.row;P<=Q.row;P++){for(var O=I.col;O<=Q.col;O++){T.push(B.updateCellValue(S,P,O))}}return[T]},callFunction:function(N,I){N=N.toUpperCase();I=I||[];var O=d.sheet.fn[N],u;if(O!==K){this.fnCount++;u=O.apply(this,I);return u}else{return M.error({error:"Function "+N+" Not Found"})}}},calcLast:0,calcDependenciesLast:0,calc:function(u,N){u=u||B.i;if(B.readOnly[u]||B.isChanged(u)===false&&!N||!B.formulaParser){return false}B.calcLast=new a();if(M.loader!==null){M.loader.cycleCells(u,B.updateCellValue)}else{var I=B.spreadsheetToArray(null,u);h.calc(u,I,B.updateCellValue);B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:I,index:u}])}B.setChanged(false);return true},calcAll:function(N){var I=0,u;if(M.loader){u=M.loader.count;for(;I<u;I++){B.calc(I,N)}}else{u=B.spreadsheets.length;for(;I<u;I++){B.calc(I,N)}}},calcVisiblePos:{row:-1,col:-1},calcVisibleInit:function(U){U=U||B.i;B.calcLast=B.calcLast||new a();var I=B.spreadsheetToArray(null,U)||[],P=B.updateCellValue,N=g.min,O=M.initCalcRows,u=M.initCalcCols,S=N(I.length-1,O),V,T,R={row:-1,col:-1},Q=[];if(S>0){R.row=S;do{if(S>0&&(V=I[S])!==undefined){R.col=T=N(V.length-1,u);if(T>0){do{Q.push({cell:V[T],rowIndex:S,colIndex:T,make:function(){P.call(this.cell,U,this.rowIndex,this.colIndex)}})}while(T-->1)}}}while(S-->1)}A(Q,{each:function(){this.make()},done:function(){B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:I,index:U}])}});this.calcVisiblePos=R;B.setChanged(false)},calcVisibleRow:function(V,S){S=S||B.i;var R=B.spreadsheetToArray(null,S)||[],W=V.scrolledArea.end,aa=V.pane.size(),P=B.updateCellValue,X=M.initCalcRows,Z=M.initCalcCols,O=(W.row+X)-1,N=(W.col+Z)-1,Y,T,ab,ac=this.calcVisiblePos,I={row:Y,col:ac.col},u,U=[];O=O<aa.rows?O:aa.rows;N=N<aa.cols?N:aa.cols;Y=O;if(Y>0){do{ab=N;if((T=R[Y])!==undefined){if(ab>0){do{U.push({row:T,cell:T!==K?T[ab]:K,rowIndex:Y,colIndex:ab,make:function(){var ad=this;if((this.cell=this.row[this.colIndex])===undefined){B.createCell(B.i,this.rowIndex,this.colIndex);this.cell=R[this.rowIndex][this.colIndex]}P.call(ad.cell,S,ad.rowIndex,ad.colIndex)}})}while(ab-->1)}}else{if(ab>0){do{var Q=Y;U.push({row:T,cell:T!==K?T[ab]:K,rowIndex:Y,colIndex:ab,offset:Q,make:function(){while(this.offset>0&&R[this.offset]===undefined){B.createSpreadsheetForArea(V.table,S,this.offset,this.offset,this.colIndex,this.colIndex,true);this.offset--}if((this.row=R[this.rowIndex])!==undefined){P.call(this.row[this.colIndex]!==K?this.row[this.colIndex]:(this.row[this.colIndex]={}),S,this.rowIndex,this.colIndex)}}})}while(ab-->1)}}}while(Y-->ac.row)}this.calcVisiblePos=I;A(U,{each:function(){this.make()}});B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:R,index:S}]);B.setChanged(false)},calcVisibleCol:function(u,aa){aa=aa||B.i;var Q=B.spreadsheetToArray(null,aa)||[],N=u.scrolledArea.end,I=u.pane.size(),U=B.updateCellValue,T=M.initCalcRows,O=M.initCalcCols,P=(N.row+T)-1,S=(N.col+O)-1,X,ab,Z,Y,R=this.calcVisiblePos,V={row:R.row,col:R.col},W=[];P=P<I.rows?P:I.rows;S=S<I.cols?S:I.cols;X=P;if(X>0&&S>0){do{Z=S;ab=Q[X];W.push({row:ab,cell:ab!==K?ab[Z]:K,rowIndex:X,colIndex:Z,make:function(){if(this.row===undefined||this.cell===undefined){B.createSpreadsheetForArea(u.table,aa,this.rowIndex,this.rowIndex,this.colIndex,this.colIndex,true);this.row=Q[this.rowIndex]}Y=this.row[this.colIndex];U.call(Y,aa,this.rowIndex,this.colIndex)}})}while(X-->1)}this.calcVisiblePos=V;A(W,{each:function(){this.make()}});B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:Q,index:aa}]);B.setChanged(false)},calcDependencies:function(N,I){N=N||new a();B.calcDependenciesLast=N;if(!I){var u=this;B.undo.createCells([this],function(O){B.trigger("sheetPreCalculation",[{which:"cell",cell:u}]);B.setDirty(true);B.setChanged(true);B.updateCellValue.call(u);B.updateCellDependencies.call(u);B.trigger("sheetCalculation",[{which:"cell",cell:u}]);return O})}else{B.trigger("sheetPreCalculation",[{which:"cell",cell:this}]);B.setDirty(true);B.setChanged(true);B.updateCellValue.call(this);B.updateCellDependencies.call(this);B.trigger("sheetCalculation",[{which:"cell",cell:this}])}},addSheet:function(u){u=u||{rows:25,cols:10};B.evt.cellEditAbandon();B.setDirty(true);B.controlFactory.sheetUI(B.obj.ui,d.sheet.makeTable(u),B.sheetCount);B.setActiveSheet(B.sheetCount);B.sheetCount++;B.sheetSyncSize();B.obj.pane().resizeScroll();B.trigger("sheetAdd",[B.i])},insertSheet:null,deleteSheet:function(I){var P=I||B.i,O=B.controls.enclosures.toArray(),u;O.splice(P,1);B.obj.barHelper().remove();B.obj.enclosure().remove();B.controls.enclosures=d(O);B.obj.menus().remove();B.obj.tabContainer().children().eq(B.i).remove();B.spreadsheets.splice(P,1);B.controls.autoFiller.splice(P,1);B.controls.bar.helper.splice(P,1);B.controls.bar.corner.splice(P,1);B.controls.bar.x.controls.splice(P,1);B.controls.bar.x.handleFreeze.splice(P,1);B.controls.bar.x.controls.splice(P,1);B.controls.bar.x.menu.splice(P,1);if(B.controls.bar.x.menuParent&&B.controls.bar.x.menuParent[P]){B.controls.bar.x.menuParent.splice(P,1)}B.controls.bar.x.parent.splice(P,1);B.controls.bar.x.th.splice(P,1);B.controls.bar.y.controls.splice(P,1);B.controls.bar.y.handleFreeze.splice(P,1);B.controls.bar.y.controls.splice(P,1);B.controls.bar.y.menu.splice(P,1);if(B.controls.bar.y.menuParent&&B.controls.bar.y.menuParent[P]){B.controls.bar.y.menuParent.splice(P,1)}B.controls.bar.y.parent.splice(P,1);B.controls.bar.y.th.splice(P,1);B.controls.barMenuLeft.splice(P,1);B.controls.barMenuTop.splice(P,1);B.controls.barLeft.splice(P,1);B.controls.barTop.splice(P,1);B.controls.barTopParent.splice(P,1);B.controls.chart.splice(P,1);B.controls.tdMenu.splice(P,1);B.controls.enclosure.splice(P,1);B.controls.fullScreen=null;B.controls.inPlaceEdit.splice(P,1);B.controls.menus.splice(P,1);B.controls.menuLeft.splice(P,1);B.controls.menuRight.splice(P,1);B.controls.pane.splice(P,1);B.controls.tables.splice(P,1);B.controls.table.splice(P,1);for(u=P+1;u<B.controls.tab.length;++u){var N=B.controls.tab[u].get(0);N.i--}B.controls.tab.splice(P,1);B.controls.toggleHide.x.splice(P,1);B.controls.toggleHide.y.splice(P,1);B.readOnly.splice(P,1);B.i=0;B.sheetCount--;B.sheetCount=E.max(B.sheetCount,0);if(B.sheetCount==0){B.addSheet()}B.setActiveSheet(B.i);B.setDirty(true);B.setChanged(true);B.trigger("sheetDelete",[P])},deleteRow:function(Q,P){var O,u,N,S,U=B.sheetSize(),T,I=B.obj.pane(),R=I.table.tBody;if(Q){u=N=Q}else{u=E.min(B.highlighter.start.row,B.highlighter.end.row);N=E.max(B.highlighter.start.row,B.highlighter.end.row)}S=(N-u)+1;if(u<1||U.cols<2||S>=U.rows){return}O=N;do{T=B.getTd(B.i,O,1).parentNode;R.removeChild(T)}while(u<O--);B.controls.bar.y.th[B.i].splice(u,S);B.spreadsheets[B.i].splice(u,S);B.refreshRowLabels(u);B.setChanged(true);B.offsetFormulas({row:u,col:0},{row:-S,col:0},false,true);B.setDirty(true);B.evt.cellEditAbandon();B.obj.pane().resizeScroll();B.trigger("sheetDeleteRow",O)},deleteColumn:function(R){var P,u,O,T,V=B.sheetSize();if(R){u=O=R}else{u=E.min(B.highlighter.start.col,B.highlighter.end.col);O=E.max(B.highlighter.start.col,B.highlighter.end.col)}T=(O-u)+1;if(u<1||V.cols<2||T>=V.cols){return}P=O;B.obj.barHelper().remove();do{var U=B.obj.table(),I=B.col(U[0],P),S=B.obj.barTop(P).remove(),Q=I.tds,N=Q.length-1;do{d(Q[N]).remove()}while(N--);B.obj.barTop(P).remove();d(I).remove()}while(u<P--);B.controls.bar.x.th[B.i].splice(u,T);N=B.spreadsheets[B.i].length-T;do{B.spreadsheets[B.i][N].splice(u,T)}while(N-->1);B.refreshColumnLabels(u);B.setChanged(true);B.offsetFormulas({row:0,col:u},{row:0,col:-T},false,true);B.setDirty(true);B.evt.cellEditAbandon();B.obj.pane().resizeScroll();B.trigger("sheetDeleteColumn",P)},sheetTab:function(I,O){var u="",N;if(I){N=B.obj.table();u=N.attr("title")||B.msg.sheetTitleDefault.replace(/[{]index[}]/gi,B.i+1);if(O){N.attr("title",u);O(u)}return u}else{if(B.isSheetEditable()&&M.editableNames){M.prompt(B.msg.newSheetTitle,function(P){if(!P){u=B.obj.table().attr("title");P=(u?u:B.msg.sheetTitleDefault.replace(/[{]index[}]/gi,B.i+1))}else{B.setDirty(true);B.obj.table().attr("title",P);B.obj.tab().html(P);u=P}if(O){O(d(l.createElement("div")).text(u).html())}},B.sheetTab(true));return null}}},followMe:function(O,u){O=O||B.obj.tdActive();if(O===null){return}var N=B.obj.pane(),I=N.actionUI;B.setBusy(true);I.putTdInView(O);B.setBusy(false);if(!u){B.autoFillerGoToTd(O)}},autoFillerGoToTd:function(O,I,u){if(!M.autoFiller){return}if(O===K){O=B.obj.tdActive()}if(O&&O.type=="cell"){I=I||O.clientHeight;u=u||O.clientWidth;if(!O.offsetHeight||!O.offsetWidth||!O.clientHeight||!O.clientWidth){B.autoFillerHide();return}var N=d(O).position();B.obj.autoFiller().show().css("top",((N.top+(I||O.clientHeight)-3)+"px")).css("left",((N.left+(u||O.clientWidth)-3)+"px"))}},autoFillerHide:function(){if(!M.autoFiller){return}B.obj.autoFiller().hide()},setActiveSheet:function(O,u){if(u!==K){O=u.i}else{O=O||0}if(B.cellLast.row>0||B.cellLast.col>0){B.evt.cellEditDone();B.obj.formula().val("")}var N=B.obj.enclosures(),I=N.length-1,P;B.autoFillerHide();if(I>0){do{if(O!=I){P=N[I];P._scrollLeft=P._scrollLeft||P.scrollUI.scrollLeft;P._scrollTop=P._scrollTop||P.scrollUI.scrollTop;P.style.display="none"}}while(I-->0)}B.i=O;if(u!==undefined){P=u.enclosure}else{P=B.controls.enclosure[O][0]}P.style.display="";B.highlighter.setTab(B.obj.tab());B.readOnly[O]=(P.table.className||"").match(/\breadonly\b/i)!=null;P.pane.resizeScroll(true);P.scrollUI.scrollLeft=P._scrollLeft||P.scrollUI.scrollLeft;P.scrollUI.scrollTop=P._scrollTop||P.scrollUI.scrollTop;P._scrollLeft=P._scrollTop=null;P.scrollUI.onscroll()},getSpreadsheetIndexByTitle:function(Q){if(M.loader!==null){var P=M.loader.getSpreadsheetIndexByTitle(Q);return P}var N=B.obj.tables(),u=N.length,O,I=0;for(;I<u;I++){O=N[I];if(O.getAttribute("title")==Q){return O.spreadsheetIndex}}return null},openSheet:function(I){var N=I.length-1,u=function(){B.setBusy(true);var U=B.controlFactory.header(),T=B.controlFactory.ui(),O=B.controlFactory.sheetAdder(),Q=B.controlFactory.tabContainer(),S,R={sizeCheck:function(V){if(d.sheet.max){var W=B.tableSize(V.table);if(W.rows>d.sheet.max||W.cols>d.sheet.max){B.trigger("sheetMaxSize",[V.table,V.i]);M.confirm(B.msg.maxSizeBrowserLimitationOnOpen,function(){V.load()})}else{V.load()}}else{V.load()}},initChildren:function(X,W,V){B.controlFactory.sheetUI(X,W,V);B.trigger("sheetOpened",[V])},done:function(V){B.sheetSyncSize();B.setActiveSheet(0);B.setDirty(false);B.setBusy(false);while(V.length>0){B.calcVisibleInit(B.i=V.pop())}B.trigger("sheetAllOpened")},lastIndex:N},P;U.ui=T;U.tabContainer=Q;T.header=U;T.sheetAdder=O;T.tabContainer=Q;Q.header=U;Q.ui=T;M.parent.append(U).append(T).append(O).append(Q);B.resizableSheet(M.parent,{minWidth:M.parent.width()*0.1,minHeight:M.parent.height()*0.1,start:function(){B.setBusy(true);B.obj.enclosure().hide();T.sheetAdder.hide();T.tabContainer.hide()},stop:function(){B.obj.enclosure().show();T.sheetAdder.show();T.tabContainer.show();B.setBusy(false);B.sheetSyncSize();B.obj.pane().resizeScroll()}});if(M.loader===null){for(S=0;S<I.length;S++){new k.SpreadsheetUI(S,T,I[S],R);B.sheetCount++}}else{B.insertSheet=function(Y,V,X,W){B.sheetCount++;Y=Y||null;W=W||l.createElement("table");X=X!==undefined?X:true;V=V||B.sheetCount-1;if(Y!==null){loader.addSpreadsheet(Y)}if(!W.hasAttribute("title")){W.setAttribute("title",loader.title(V))}var Z=function(){B.obj.enclosure().hide();B.setBusy(true);var aa=new k.SpreadsheetUI(V,T,W,R);B.setActiveSheet(-1,aa);B.calcVisibleInit(V);B.setBusy(false);B.sheetSyncSize()};if(X){Z();return}B.controlFactory.customTab(M.loader.title(V)).mousedown(function(){Z();B.obj.tab().insertBefore(this);d(this).remove();return false})};P=new k.SpreadsheetUI(0,T,I[0],R);B.sheetCount++;if(I.length>1){for(S=1;S<I.length;S++){B.insertSheet(null,S,false,I[S])}B.i=0;P.loaded()}}};if(B.isDirty){M.confirm(B.msg.openSheet,u)}else{u()}},newSheet:function(){M.parent.html(d.sheet.makeTable()).sheet(M)},sheetSyncSize:function(){var V=M.parent,R=V[0],X=R.clientHeight,S=R.clientWidth,W=B.obj.tabContainer(),Y=W[0],u=Y.style,ab=f.scrollBarSize.width,I,aa,U,T,P=B.obj.ui.style,Q,ac,O,Z,N;if(!X){X=400;V.height(X)}else{if(X<200){X=200;V.height(X)}}N=Y.scrollLeft;u.width="";I=Y.clientWidth;aa=(S-(M.colMargin+ab));U=(S-M.colMargin*2)+"px";T=((M.colMargin+ab)+"px");if(I>aa){u.height=T;W.addClass(B.cl.tabContainerScrollable);X-=ab}else{u.height=null;W.removeClass(B.cl.tabContainerScrollable)}u.width=U;Y.scrollLeft=N;X-=B.obj.header().outerHeight()+M.boxModelCorrection;X-=Y.clientHeight+M.boxModelCorrection;Q=(X-f.scrollBarSize.height-M.boxModelCorrection)+"px";ac=(S-f.scrollBarSize.width)+"px";O=(X+"px");Z=(S+"px");B.obj.panes().each(function(){var af=this.style,ae=this.actionUI.scrollUI.style,ad=this.enclosure.style;af.height=Q;af.width=ac;ad.height=ae.height=O;ad.width=ae.width=Z});P.height=O;P.width=Z},cellChangeStyle:function(N,O,u){u=u||B.highlighted(true);if(u.length<1){return false}B.setDirty(this);var I=u.length-1;if(I>=0){B.undo.createCells(u,function(P){do{P[I].td.css(N,O)}while(I--);return P});return true}return false},cellFind:function(u){function I(O){var N=B.obj.table().children("tbody").children("tr");if(O){var P=N.children('td:contains("'+O+'")');if(P.length<1){P=N.children('td:contains("'+O.toLowerCase()+'")')}if(P.length<1){P=N.children('td:contains("'+O.toUpperCase()+'")')}P=P.eq(0);if(P.length>0){B.cellEdit(P)}else{M.alert(B.msg.cellNoFind)}}}if(!u){M.prompt(B.msg.cellFind,I)}else{I(u)}},cellSetActiveBar:function(T,N,O){var Y=B.sheetSize(),Q=E.min(N,O),V=E.max(N,O),u={},U={},X=function(Z){switch(M.cellSelectModel){case k.openOfficeSelectModel:this.row=(Z?u.row:U.row);this.col=(Z?u.col:U.col);this.td=B.getTd(B.i,this.row,this.col);if(this.td!==B.cellLast.td){B.cellEdit(this.td,false,true)}break;default:this.row=(Z?U.row:u.row);this.col=(Z?U.col:u.col);this.td=B.getTd(B.i,this.row,this.col);if(this.td!==B.cellLast.td){B.cellEdit(this.td,false,true)}break}},P=[],R=B.obj.pane().actionUI.scrolledArea,S=B.obj.table(),I,W;switch(T){case"top":u.row=R.end.row;u.col=Q;U.row=R.end.row;U.col=V;B.highlighter.start.row=1;B.highlighter.start.col=Q;B.highlighter.end.row=Y.rows;B.highlighter.end.col=V;I=V;do{P.push(B.col(S[0],I))}while(I-->Q);break;case"left":u.row=Q;u.col=R.end.col;U.row=V;U.col=R.end.col;B.highlighter.start.row=Q;B.highlighter.start.col=1;B.highlighter.end.row=V;B.highlighter.end.col=Y.cols;W=V;do{P.push(B.getTd(B.i,W,1).parentNode)}while(W-->Q);break;case"corner":u.row=1;u.col=1;U.col=Y.cols;U.row=Y.rows;P.push(S[0]);break}new X(N>O);B.highlighter.set(d(P))},getTdRange:function(O,T,R,S){B.cellLast.isEdit=true;var I=function(V){if(V.first.col>V.last.col||V.first.row>V.last.row){return{first:h.parseCellName(V.last.col,V.last.row),last:h.parseCellName(V.first.col,V.first.row)}}else{return{first:h.parseCellName(V.first.col,V.first.row),last:h.parseCellName(V.last.col,V.last.row)}}},Q=function(Y){var V=I(Y),X=T+"";X=(X.match(/=/)?X:"="+X);if(R||X.charAt(X.length-1)!="("){X=X+(R?R:"")+"("}var Z,W="";if(V.first!=V.last){Z=V.first+":"+V.last}else{Z=V.first}if(X.charAt(X.length-1)=="("){W=")"}return X+Z+W},u="",N,P,U;if(O){N={first:B.getTdLocation([O.target])};P=B.obj.table().mousemove(function(V){N.last=B.getTdLocation([V.target]);u=Q(N);if(!S){B.obj.formula().val(u);B.obj.inPlaceEdit().val(u)}});x.one("mouseup",function(){P.unbind("mousemove");return u})}else{U=B.highlighted().not(B.obj.tdActive());if(U.length){N={first:B.getTdLocation(U.first()),last:B.getTdLocation(U.last())};u=Q(N);if(!S){B.obj.formula().val(u);B.obj.inPlaceEdit().val(u)}return u}else{return""}}return""},getTd:function(P,R,I){var N=B.obj.tables()[P],u,O,Q;if(!N||!(u=N.tBody)||!(O=u.children[R])||!(Q=O.children[I])){Q=l.createElement("td")}return Q},getTdLocation:function(I){var u={col:0,row:0};if(I===K||I===null){return u}if(I.parentNode==K||I.parentNode.rowIndex<0){return u}return{col:parseInt(I.cellIndex),row:parseInt(I.parentNode.rowIndex)}},getBarIndex:{left:function(u){u=u||{};if(!u.parentNode||w(u.parentNode.rowIndex)){return -1}else{return u.parentNode.rowIndex}},top:function(u){u=u||{};if(w(u.cellIndex)){return -1}else{return u.cellIndex}},corner:function(){return 0}},time:{now:new a(),last:new a(),diff:function(){return E.abs(E.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new a()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},changed:[],isChanged:function(u){return B.changed[u||B.i]},setChanged:function(u){B.changed[B.i]=u},isDirty:false,setDirty:function(u){B.dirty=u},appendToFormula:function(u){var N=B.obj.formula(),I=N.val();if(I.charAt(0)!="="){I="="+I}N.val(I+u)},undo:{manager:(f.UndoManager?new UndoManager():{undo:G,redo:G,register:G,notLoaded:true}),cells:[],id:0,createCells:function(u,I,P){if(B.undo.manager.notLoaded){this.createCells=function(Q,R,S){return R(Q)};return this.createCells(u,I,P)}if(P==K){B.undo.id++;P=B.undo.id}var N=(new k.CellRange(u)).clone().cells,O=(I?(new k.CellRange(I(u)).clone()).cells:N);N.id=P;O.id=P;B.undo.manager.add({undo:function(){B.undo.removeCells(N,P)},redo:function(){B.undo.createCells(O,null,P)}});if(P!=B.undo.id||!I){B.calcLast=new a();B.undo.draw(O)}return true},removeCells:function(I,O){var N=0,u=-1;if(I.id===O){u=N}if(u!==-1){B.undo.cells.splice(u,1)}B.undo.draw(I)},draw:function(N){var I,Q;for(I=0;I<N.length;I++){var P=N[I],O=B.getTdLocation(P.td),u=B.spreadsheets[P.sheet][O.row][O.col];u.value=P.value;u.formula=P.formula;Q=u.td=P.td;u.dependencies=P.dependencies;u.needsUpdated=P.needsUpdated;u.calcCount=P.calcCount;u.sheet=P.sheet;u.calcLast=P.calcLast;u.html=P.html;u.state=P.state;u.jS=P.jS;u.calcDependenciesLast=P.calcDependenciesLast;Q.setAttribute("style",P.style);Q.setAttribute("class",P.cl);B.updateCellValue.call(u)}}},cols:function(u){u=u||B.obj.table()[0];if(!u){return[]}if(!u.colGroup){return[]}if(!u.colGroup.children){return[]}return u.colGroup.children},tables:function(U,P){U=U||B.obj.tables();var T=[],N=U.length-1,I,W,S,u,X,O,V,Q,R;do{W=(P?l.body.removeChild(U[N]):U[N].cloneNode(true));if((u=W.children[0])&&(X=u.children[0])){u.removeChild(X)}if(S=W.children[1]){Q=S.children;V=Q[0];S.removeChild(V);I=Q.length-1;do{R=Q[I];O=R.children[0];R.removeChild(O)}while(I-->0)}T[N]=W}while(N-->0);return B.sheetDecorateRemove(false,d(T))},col:function(I,u){I=I||B.obj.table()[0];var N=B.cols(I);if(u===K){u=N.length-1}return N[u]},rowTds:function(I,u){I=I||B.obj.table();var N=B.rows(I);if(!N.length){return[]}if(u==K){u=N.length-1}if(!N[u]){return[]}if(!N[u].children){return[]}return N[u].children},rows:function(u){u=u||B.obj.table()[0];if(!u){return[]}if(!u.tBody){return[]}if(!u.tBody.children){return[]}return u.tBody.children},highlighted:function(I){var O=B.highlighter.last||d([]),P=[],u,N;if(!(u=O)||!O.length||!(u=u[0])||!u.tagName){return I?P:d(P)}switch(u.tagName){case"TD":N=O.length-1;do{P.unshift(I?O[N].jSCell:O[N])}while(N-->0);break;case"TR":N=O.length-1;do{if(O[N].tds){P=P.concat(I?O[N].jSCells:O[N].tds)}}while(N-->0);break;case"COL":O=O.filter("col");N=O.length-1;do{if(O[N].tds){P=P.concat(I?O[N].jSCells:O[N].tds)}}while(N-->0);break;case"TABLE":P=(I?u.jSCells:u.tds);break}return I?P:d(P)},sheetSize:function(N){var I,Q,u={},O=M.minSize||{rows:1,cols:1},P;N=N||B.obj.table()[0];if((u.cols=M.initScrollCols)>0&&(u.rows=M.initScrollRows)>0){}else{I=B.rowTds(N);Q=B.getTdLocation(I[I.length-1]);u.cols=Q.col;u.rows=Q.row}if(M.loader!==null){P=M.loader.size(N.spreadsheetIndex);u.rows=g.max(P.rows,u.rows,O.rows);u.cols=g.max(P.cols,u.cols,O.cols)}return u},test:function(){var u=B.highlighted(true);console.log(B.obj.enclosure())},sortVerticalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){B.sortVertical();return true}else{B.sortVerticalSingle(false);return true}},sortVerticalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){B.sortVertical();return false}else{B.sortVerticalSingle(true);return false}},sortVertical:function(U){var S=B.highlighted(true),P=S[0].td.parent().prev(),u=S.length,N=new a(),R=true,V=[],X=[],Q,T=0,W,I,O;while(T<u){W=S[T];O=W.td;if(!isNaN(W.value)){I=(new s(W.value.valueOf()))}else{R=false;I=(new p(W.value.valueOf()))}I.loc=B.getTdLocation(O);I.row=O.parentNode;I.col=O;I.cell=W;V.push(I);T++}if(U){if(R==false){V.sort(function(Z,Y){return Y-Z})}else{V.sort();V.reverse()}}else{if(R==true){V.sort(function(Z,Y){return Z-Y})}else{V.sort()}}B.undo.createCells(S);while(Q=V.length){I=V.pop();X=B.spreadsheets[B.i].splice(I.row.rowIndex,1);W=I.cell;W.value=I.valueOf();W.calcLast=0;I.row.parentNode.removeChild(I.row);P.after(I.row);I.row.children[0].innerHTML=P[0].rowIndex+Q;B.spreadsheets[B.i].splice(P[0].rowIndex+1,0,X[0]);B.calcDependencies.call(W,N,true)}B.undo.createCells(S)},sortVerticalSingle:function(Q){var O=B.highlighted(true),P=O.length,N=0,I=[],u;while(N<P){I.push(O[N].value);N++}if(Q){I.sort(function(S,R){return R-S})}else{I.sort(function(S,R){return S-R})}while(O.length){u=O.pop();u.value=I[O.length];u.calcLast=0;B.updateCellValue.call(u);B.updateCellDependencies.call(u)}},sortHorizontalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){B.sortHorizontal();return true}else{B.sortHorizontalSingle(false);return true}},sortHorizontalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){B.sortHorizontal();return false}else{B.sortHorizontalSingle(true);return false}},sortHorizontal:function(U){var S=B.highlighted(true),aa=S[0].td[0],W=aa.cellIndex,u=aa.table.colGroup,ab=B.sheetSize().rows,I=S.length,O=new a(),R=true,X=[],Q,T=0,Y,Z,N,V,P;while(T<I){Y=0;Z=S[T];P=Z.td;if(!isNaN(Z.value)){N=new s(Z.value.valueOf())}else{R=false;N=new p(Z.value.valueOf())}N.tds=[];N.loc=B.getTdLocation(P);N.tr=P.parentNode;N.td=P;N.cell=Z;while(Y<=ab){N.tds.push(B.obj.pane().table.children[1].children[Y].children[P.cellIndex]);Y++}X.push(N);T++}if(U){if(R==false){X.sort(function(ad,ac){return ac-ad})}else{X.sort();X.reverse()}}else{if(R==true){X.sort(function(ad,ac){return ad-ac})}else{X.sort()}}B.undo.createCells(S);while(X.length){N=X.pop();while(N.tds.length>1){P=N.tds.pop();V=P.parentNode;Z=B.spreadsheets[B.i][V.rowIndex].splice(P.cellIndex,1);V.insertBefore(P,V.children[W]);P.col=u.children[X.length+P.cellIndex-1];P.barTop=P.col.bar;Z.value=P.jSCell.value;Z.calcLast=O;B.spreadsheets[B.i][V.rowIndex].splice(P.cellIndex,0,Z[0]);B.calcDependencies.call(Z,O,true)}}B.undo.createCells(S)},sortHorizontalSingle:function(Q){var O=B.highlighted(true),P=O.length,N=0,I=[],u;while(N<P){I.push(O[N].value);N++}if(Q){I.sort(function(S,R){return R-S})}else{I.sort(function(S,R){return S-R})}while(O.length){u=O.pop();u.value=I[O.length];u.calcLast=0;B.updateCellValue.call(u);B.updateCellDependencies.call(u)}},tableSize:function(N){N=N||B.obj.table()[0];var u=N.tBody||{},P=u.children||[],O=P[P.length-1]||{},I=O.children||[],Q=I[I.length-1]||{};return{cols:Q.cellIndex||0,rows:O.rowIndex||0}},toggleState:function(u){if(M.allowToggleState){var I=u||B.tables();if(M.editable){B.evt.cellEditAbandon();B.trigger("sheetSave",[I])}B.setDirty(false);B.setChanged(true);M.editable=!M.editable;B.kill();M.parent.html(I).sheet(M);M=null}},setCellRef:function(I){function u(P){if(P){B.s.formulaVariables[P]=B.updateCellValue(B.i,N.row,N.col)}}var O=B.obj.tdActive(),N=B.getTdLocation(O);if(I){u(I)}else{M.prompt(B.msg.setCellRef,u)}},formulaParser:null,print:function(u,I){u=u||B.i;var O=f.open(),N;if(O!==K){N=O.document;N.write('<html>	<head id="head"></head>	<body>		<div id="entry" class="'+B.cl.parent+'" style="overflow: show;">		</div>	</body></html>');if(I!==true){d(N.getElementById("head")).append(d("style,link").clone())}d(N.getElementById("entry")).append(B.obj.pane().cloneNode(true));N.close();O.focus();O.print()}}},y=[],H;B.setBusy(true);M.parent[0].jS=B;if(!f.console){f.console={log:function(){}}}if(f.scrollBarSize===K){f.scrollBarSize=m()}if(f.defaultCharSize===K){f.defaultCharSize=j()}if(f.Formula){B.formulaParser=f.Formula(B.cellHandler)}B.theme=new k.Theme(M.theme);B.highlighter=new k.Highlighter(B.theme.tdHighlighted,B.theme.barHighlight,B.theme.tabActive,function(){B.obj.pane().actionUI.redraw()});M.origHtml=M.parent.children().detach();M.parent.addClass(B.cl.parent);M.parent.bind("sheetSwitch",function(N,I,u){B.switchSheet(u)}).bind("sheetRename",function(N,I,u){B.renameSheet(u)});M.width=(M.width?M.width:M.parent.width());M.height=(M.height?M.height:M.parent.height());if(!d.nearest){B.nearest=G}B.resizableCells=B.resizableSheet=B.resizable;if(!d.ui){B.resizable=B.resizableCells=B.resizableSheet=B.draggable=G}else{if(!M.resizableCells){B.resizableCells=G}if(!M.resizableSheet){B.resizableSheet=G}}if(!d.support.boxModel){M.boxModelCorrection=0}if(!M.barMenus){B.controlFactory.barMenuTop=B.controlFactory.barMenuLeft=G}if(!M.freezableCells){B.controlFactory.barHandleFreeze.top=B.controlFactory.barHandleFreeze.left=G}if(M.calcOff){B.calc=G}if(!f.Raphael){h.chart=G}v.resize(function(){if(B&&!B.isBusy()){M.width=M.parent.width();M.height=M.parent.height();B.sheetSyncSize()}});if(d.sheet.fn){d.sheet.fn=d.extend(d.sheet.fn,M.formulaFunctions);if(d.sheet.advancedfn){d.sheet.fn=d.extend(d.sheet.fn,d.sheet.advancedfn)}if(d.sheet.financefn){d.sheet.fn=d.extend(d.sheet.fn,d.sheet.financefn)}}M.title=M.title||M.parent.attr("title")||"";B.s=M;M.parent.addClass(B.theme.parent);if(M.origHtml.length){B.openSheet(M.origHtml)}else{if(M.loader!==null){while(y.length<M.loader.count){H=l.createElement("table");H.setAttribute("title",M.loader.title(y.length));y.push(H)}B.openSheet(d(y))}else{B.openSheet(d(l.createElement("table")))}}B.setBusy(false);return B},makeTable:function(G,w,u){var E=l;G=G||{rows:25,cols:10};w=w||120;u=u||15;var F=l.createElement("table"),v=l.createElement("colgroup"),D=l.createElement("tbody"),A="width:"+w+"px;",y="height:"+u+"px;",C,x,B,z;B=G.cols;do{x=l.createElement("col");x.setAttribute("style",A);v.appendChild(x)}while(B-->1);B=G.rows;do{C=l.createElement("tr");C.setAttribute("style",y);z=G.cols;do{C.appendChild(l.createElement("td"))}while(z-->1);D.appendChild(C)}while(B-->1);F.appendChild(v);F.appendChild(D);return F},killAll:function(){if(d.sheet){var u=d.sheet.instance;if(u){for(var v=0;v<u.length;v++){if(u[v]&&u[v].kill){u[v].kill()}}d.sheet.instance=[]}}},scrollLocker:function(v){var u=d.sheet.instance;u[v].obj.panes().each(function(w){var x;d(x=this.scrollUI).scroll(function(z){var y=u.length-1,A;if(y>-1){do{A=u[y].controls.enclosure[w][0].scrollUI;if(this!==A){A.scrollLeft=x.scrollLeft;A.scrollTop=x.scrollTop}}while(y--)}})})},switchSheetLocker:function(u){d.each(d.sheet.instance,function(){this.s.parent.bind("sheetSwitch",function(x,w,v){d.each(d.sheet.instance,function(){this.setActiveSheet(v)})})})},I:function(){var u=0;if(this.instance){u=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return u}};var h=d.sheet.engine={calc:function(x,v,y){v=v||[];var A=v.length-1,z,w,u;if(A>0){do{if(A>0&&v[A]){z=v[A];w=z.length-1;if(w>0){do{u=z[w];y.call(u,x,A,w)}while(w-->1)}}}while(A-->1)}},parseLocation:function(u,v){return{row:parseInt(v),col:h.columnLabelIndex(u)}},parseSheetLocation:function(v){var u=((v+"").replace("SHEET","")*1)-1;return isNaN(u)?-1:u},parseCellName:function(u,v){return h.columnLabelString(u)+(v||"")},alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),columnLabels:{},columnLabelIndex:function(u){return this.columnLabels[u.toUpperCase()]},columnIndexes:[],columnLabelString:function(x){if(!this.columnIndexes.length){var z="",y,w,v,u;y=w=v=-1;for(u=1;u<16385;++u){z="";++v;if(v==26){v=0;++w;if(w==26){w=0;++y}}if(y>=0){z+=this.alphabet[y]}if(w>=0){z+=this.alphabet[w]}if(v>=0){z+=this.alphabet[v]}this.columnIndexes[u]=z;this.columnLabels[z]=u}}return this.columnIndexes[x]||""},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+|[#]REF[!])\$?([0-9]+|[#]REF[!])/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},chart:function(x){var w=this.jS,u=this;function v(y,z){if(!y){if(z){y=0}else{y=""}}else{if(z){y=c.toNumbers(y)}else{y=c.flatten(y)}}return y}x=d.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",td:this.td,chart:l.createElement("div"),gR:{}},x);x.chart.className=w.cl.chart;x.chart.onmousedown=function(){d(x.td).mousedown()};x.chart.onmousemove=function(){d(x.td).mousemove();return false};w.controls.chart[w.i]=w.obj.chart().add(x.chart);x.data=v(x.data,true);x.x.data=v(x.x.data,true);x.y.data=v(x.y.data,true);x.legend=v(x.legend);x.x.legend=v(x.x.legend);x.y.legend=v(x.y.legend);x.legend=(x.legend?x.legend:x.data);w.s.parent.one("sheetCalculation",function(){var z=x.chart.clientWidth,y=x.chart.clientHeight,A=Raphael(x.chart);if(x.title){A.text(z/2,10,x.title).attr({"font-size":20})}switch(x.type){case"bar":x.gR=A.barchart(z/8,y/8,z*0.8,y*0.8,x.data,x.legend).hover(function(){this.flag=A.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":x.gR=A.hbarchart(z/8,y/8,z*0.8,y*0.8,x.data,x.legend).hover(function(){this.flag=A.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":x.gR=A.linechart(z/8,y/8,z*0.8,y*0.8,x.x.data,x.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"circle",smooth:true}).hoverColumn(function(){this.tags=A.set();if(this.symbols.length){for(var B=0,C=this.y.length;B<C;B++){this.tags.push(A.tag(this.x,this.y[B],this.values[B],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[B].attr("fill")}]))}}},function(){this.tags&&this.tags.remove()});break;case"pie":x.gR=A.piechart(z/2,y/2,(z<y?z:y)/2,x.data,{legend:x.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":x.gR=A.dotchart(z/8,y/8,z*0.8,y*0.8,x.x.data,x.y.data,x.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:x.x.data.length-1,axisystep:x.y.data.length-1,axisxlabels:(x.x.legend?x.x.legend:x.x.data),axisylabels:(x.y.legend?x.y.legend:x.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||A.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()});break}x.gR.mousedown(function(){d(x.td).mousedown().mouseup()})});return x.chart}};var n=d.sheet.fn={ISNUMBER:function(w){var u;if(!isNaN(w.valueOf())){u=new t(true);u.html="TRUE";return u}u=new t(false);u.html="FALSE";return u},N:function(u){if(u==null){return 0}if(u instanceof a){return u.getTime()}if(typeof(u)=="object"){u=u.toString()}if(typeof(u)=="string"){u=parseFloat(u.replace(h.regEx.n,""))}if(isNaN(u)){return 0}if(typeof(u)=="number"){return u}if(u==true){return 1}return 0},VERSION:function(){return this.jS.version},ABS:function(u){return g.abs(n.N(u))},CEILING:function(v,u){u=u||1;return(parseInt(v/u)*u)+u},EVEN:function(u){u=g.round(u);var w=(u%2==0);if(!w){if(u>0){u++}else{u--}}return u},EXP:function(u){return g.exp(u)},FLOOR:function(w,v){v=v||1;if((w<0&&v>0)||(w>0&&v<0)){var u=new s(0);u.html="#NUM";return u}if(w>=0){return g.floor(w/v)*v}else{return g.ceil(w/v)*v}},INT:function(u){return g.floor(n.N(u))},LN:function(u){return g.log(u)},LOG:function(u,w){w=w||10;return g.log(u)/g.log(w)},LOG10:function(u){return n.LOG(u)},MOD:function(u,w){var v=u%w;if(w<0){v*=-1}return v},ODD:function(u){var x=false;if(u>0){u=g.floor(g.round(u));x=true}else{u=g.ceil(u)}var w=g.abs(u);if((w%2)==0){w++}if(x){return w}else{return -w}},PI:function(){return g.PI},POWER:function(u,v){return g.pow(u,v)},SQRT:function(u){return g.sqrt(u)},RAND:function(){return g.random()},RND:function(){return g.random()},ROUND:function(x,w){var u=g.pow(10,w||0);return g.round(x*u)/u},ROUNDDOWN:function(w,u){var x=(w<0);w=g.abs(w);u=u||0;w=g.floor(w*g.pow(10,u))/g.pow(10,u);return(x?-w:w)},ROUNDUP:function(w,u){var x=(w<0);w=g.abs(w);u=u||0;w=g.ceil(w*g.pow(10,u))/g.pow(10,u);return(x?-w:w)},SUM:function(){var x=0,u=c.toNumbers(arguments),w=u.length-1;if(w<0){return 0}do{x+=u[w]*1}while(w--);return x},TRUNC:function(u,v){v=v||0;u=u+"";if(v==0){return u.split(".").shift()}if(u.match(".")){if(v==1){u=u.substr(0,u.length-1)}else{if(v==-1){u=u.split(".").shift();u=u.substr(0,u.length-1)+"0"}}}return u},AVERAGE:function(u){return n.SUM(arguments)/n.COUNT(arguments)},AVG:function(u){return n.AVERAGE(u)},COUNT:function(){var x=0,u=c.toNumbers(arguments),w=u.length-1;if(w<0){return x}do{if(u[w]!==null){x++}}while(w--);return x},COUNTA:function(){var x=0,u=c.flatten(arguments),w=u.length-1;if(w<0){return x}do{if(u[w]){x++}}while(w--);return x},MAX:function(){var w=c.toNumbers(arguments),u=w[0],x=w.length-1;if(x<0){return 0}do{u=(w[x]>u?w[x]:u)}while(x--);return u},MIN:function(){var u=c.toNumbers(arguments),x=u[0],w=u.length-1;if(w<0){return 0}do{x=(u[w]<x?u[w]:x)}while(w--);return x},ASC:function(u){return u.charCodeAt(0)},CHAR:function(u){return p.fromCharCode(u)},CLEAN:function(u){var w=new b("[cG\x1BcLcJcMcIcK\x07\x1B\f\n\r\t\v]","g");return u.replace(w,"")},CODE:function(u){return n.ASC(u)},CONCATENATE:function(){var w=c.flatten(arguments),v="",u=this;jQuery.each(w,function(x){v+=w[x]});return v},DOLLAR:function(x,w,z){w=w||2;z=z||"$";var u=new s(x),y=n.FIXED(x,w,false);if(x>=0){u.html=z+y}else{u.html="("+z+y.slice(1)+")"}return u},FIXED:function(y,x,w){x=(x===undefined?2:x);var z=g.pow(10,x),u,y=g.round(y*z)/z;u=new p(y.toFixed(x));u.html=Globalize.format(y,"n"+x);if(w){u.html=u.html.replace(Globalize.culture().numberFormat[","],"")}return u},LEFT:function(u,w){w=w||1;return u.substring(0,w)},LEN:function(u){if(!u){return 0}return u.length},LOWER:function(u){return u.toLowerCase()},MID:function(w,x,u){if(!w||!x||!u){return this.jS.s.error({error:"ERROR"})}return w.substring(x-1,u+x-1)},REPLACE:function(v,y,w,x){if(!v||!y||!w||!x){return this.jS.s.error({error:"ERROR"})}var u=v.split("");u.splice(y-1,w);u.splice(y-1,0,x);return u.join("")},REPT:function(w,y){var u="";for(var x=0;x<y;x++){u+=w}return u},RIGHT:function(u,w){w=w||1;return u.substring(u.length-w,u.length)},SEARCH:function(w,u,x){x=x||0;if(x){u=u.split("");u.splice(0,x-1);u=u.join("")}var v=u.search(w);if(v<0){return this.jS.s.error({error:"#VALUE!"})}return x+(x?0:1)+v},SUBSTITUTE:function(x,u,w,y){y=y||0;u=new b(u,"g");var v=1;x=x.replace(u,function(A,C,D,B){var z=A;if(y){if(v>=y){z=w}}else{z=w}v++;return z});return x},TEXT:function(v,u){return v},UPPER:function(u){return u.toUpperCase()},VALUE:function(u){if(jQuery.isNumeric(u)){return u*=1}else{return this.jS.s.error({error:"#VALUE!"})}},NOW:function(){var u=new a();u.html=e.toString(u);return u},TODAY:function(){var v=new a(),u=new s(e.toCentury(v)-1);u.html=e.toString(v,"d");return u},WEEKENDING:function(v){var u=new a();u=new a(u.getFullYear(),u.getMonth(),u.getDate()+5-u.getDay()-((v||0)*7));u.html=e.toString(u,"d");return u},WEEKDAY:function(v,w){v=e.get(v);var u=v.getDay();w=(w?w:1);switch(w){case 3:switch(u){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(u){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:u++;break}return u},WEEKNUM:function(u){u=e.get(u);return e.week(u)+1},YEAR:function(u){u=e.get(u);return u.getFullYear()},DAYSFROM:function(v,w,u){return g.floor((new a()-new a(v,(w-1),u))/e.dayDiv)},DAYS:function(y,w){var v=e.get(y),u=e.get(w),x=1000*60*60*24;return g.round(g.abs(v.getTime()-u.getTime())/x)},DAY:function(u){u=e.get(u);return u.getDate()},DAYS360:function(z,w,B){z=e.get(z);w=e.get(w);var u=z.getDate(),y=w.getDate(),x=e.isLastDayOfMonth(z),A=e.isLastDayOfMonth(w),v=e.diffMonths(z,w);if(B){u=g.min(u,30);y=g.min(y,30)}else{if(x){u=30}if(A){if(u<30){v++;y=1}else{y=30}}}return(v*30)+(y-u)},DATE:function(x,y,v){var w=new a(x,y-1,v),u=new s(e.toCentury(w));u.html=e.toString(w,"d");return u},DATEVALUE:function(v){v=e.get(v);var u=new s(e.toCentury(v));u.html=e.toString(v,"d");return u},EDATE:function(w,v){w=e.get(w);w.setMonth(w.getMonth()+v);var u=new s(e.toCentury(w));u.html=e.toString(w,"d");return u},EOMONTH:function(w,v){w=e.get(w);w.setMonth(w.getMonth()+v+1);w=new a(w.getFullYear(),w.getMonth(),0);var u=new s(e.toCentury(w));u.html=e.toString(w,"d");return u},HOUR:function(u){u=i.fromMath(u);return u.hour},MINUTE:function(u){return i.fromMath(u).minute},MONTH:function(u){u=e.get(u);return u.getMonth()+1},SECOND:function(u){return i.fromMath(u).second},TIME:function(u,z,v){v=(v?v:0);z=(z?z:0);u=(u?u:0);if(v&&v>60){var w=(((v/60)+"").split(".")[0])*1;v=v-(w*60);z+=w}if(z&&z>60){var y=(((z/60)+"").split(".")[0])*1;z=z-(y*60);u+=y}var x=(u*60*60*1000)+(z*60*1000)+(v*1000);return x/e.dayDiv},TIMEVALUE:function(u){if(!isNaN(u)){return u}if(/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(u)){return i.fromString(u,true)}else{if(/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(u)){return i.fromString(u)}}return 0},WORKDAY:function(v,y,x){var z={1:true,2:true,3:true,4:true,5:true},v=e.get(v),y=(y&&!isNaN(y)?y:0),A=0,w=0,u=v,C;if(x){if(!jQuery.isArray(x)){x=[x]}x=c.flatten(x);var B={};jQuery.each(x,function(D){if(x[D]){B[e.toString(e.get(x[D]),"d")]=true}});x=B}else{x={}}while(w<y){u=new a(u.setDate(u.getDate()+1));if(z[u.getDay()]){if(!x[e.toString(u,"d")]){w++}}A++}C=new s(e.toCentury(u));C.html=e.toString(u,"d");return C},YEARFRAC:function(u,y,x){u=e.get(u);y=e.get(y);if(!u||!y){return this.jS.s.error({error:"#VALUE!"})}x=(x?x:0);this.html=[];var w=e.diff(u,y,x),v=e.calcAnnualBasis(u,y,x);return w/v},AND:function(){var v=arguments,w,u=this;d.each(v,function(x){if(v[x].valueOf()!==true&&w==undefined){w=n.FALSE()}});if(!w){w=n.TRUE()}return w},FALSE:function(){var u=new t(false);u.html="FALSE";return u},IF:function(w,v,u){if(w.valueOf()){return v}else{return u}},NOT:function(w){var u;if(!w.valueOf()){u=new t(true);u.html="TRUE"}else{u=new t(false);u.html="FALSE"}return u},OR:function(){var x=arguments,u,y=x.length-1,w;if(y>-1){do{w=x[y].valueOf();if(w){u=new t(true);u.html="TRUE";return u}}while(y--)}u=new t(false);u.html="FALSE";return u},TRUE:function(){var u=new t(true);u.html="TRUE";return u},GREATER:function(w,v){var u;if(w>v){u=new t(true);u.html="TRUE"}else{u=new t(false);u.html="FALSE"}return u},LESS:function(w,v){var u;if(w<v){u=new t(true);u.html="TRUE"}else{u=new t(false);u.html="FALSE"}return u},EQUAL:function(w,v){var u;if(w.valueOf()==v.valueOf()){u=new t(true);u.html="TRUE"}else{u=new t(false);u.html="FALSE"}return u},GREATER_EQUAL:function(w,v){var u;if(w>=v){u=new t(true);u.html="TRUE"}else{u=new t(false);u.html="FALSE"}return u},LESS_EQUAL:function(w,v){var u;if(w<=v){u=new t(true);u.html="TRUE"}else{u=new t(false);u.html="FALSE"}return u},IMG:function(w){var u=new p("");u.html=d(l.createElement("img")).attr("src",w);return u},TRIM:function(u){if(typeof(u)=="string"){u=d.trim(u)}return u},HYPERLINK:function(w,v){v=v||"LINK";var u=new p(v);u.html=d(l.createElement("a")).attr("href",w).attr("target","_new").text(v);return u},DROPDOWN:function(){var F=this,B=this.jS,y=this.td,x=d(F.td),E,A=(y!==null?x.children().detach():null),C,D,w,G;if(A===null||F.needsUpdated||!A.length){E=c.flatten(arguments);E=c.unique(E);C=B.getTdLocation(F.td);w=(this.id!==null?this.id+"-dropdown":"dropdown"+this.sheet+"_"+C.row+"_"+C.col+"_"+B.I);D=l.createElement("select");D.setAttribute("name",w);D.setAttribute("id",w);D.className="jSDropdown";D.cell=this;D.onmouseup=function(){B.cellEdit(this.cell.td)};D.onchange=function(){F.value=this.value;B.calcDependencies.call(F,F.calcDependenciesLast)};B.controls.inputs[B.i]=B.obj.inputs().add(D);for(var z=0;z<(E.length<=50?E.length:50);z++){if(E[z]){var u=l.createElement("option");u.setAttribute("value",E[z]);u.text=u.innerText=E[z];D.appendChild(u)}}if(!B.s.editable){D.setAttribute("disabled",true)}else{B.s.parent.bind("sheetKill",function(){x.text(F.value=D.value)})}D.value=F.value||E[0];D.onchange()}if(typeof F.value!=="object"){G=new p(F.value)}G.html=D;return G},RADIO:function(){var I=this,C=this.jS,z=this.td,x=d(z),H,B=(z.children?z.children().detach():""),E,D,u,y,w,J;if(!B.length||I.needsUpdated){H=c.flatten(arguments);H=c.unique(H);E=C.getTdLocation(I.td);x=d(I.td);D=[];w=(this.id!==null?this.id+"-radio":"radio"+this.sheet+"_"+E.row+"_"+E.col+"_"+C.I);y=l.createElement("span");y.className="jSRadio";y.onmousedown=function(){C.cellEdit(x)};y.jSCell=I;C.controls.inputs[C.i]=C.obj.inputs().add(y);for(var A=0;A<(H.length<=25?H.length:25);A++){if(H[A]){var G=l.createElement("input"),F=l.createElement("span");G.setAttribute("type","radio");G.setAttribute("name",w);G.className=w;G.value=H[A];G.onchange=function(){I.value=jQuery(this).val();C.calcDependencies.call(I,I.calcDependenciesLast)};D.push(G);if(H[A]==I.value){G.setAttribute("checked","true");G.onchange()}F.textContent=F.innerText=H[A];y.appendChild(G);y.input=G;F.onclick=function(){d(this).prev().click()};y.appendChild(F);y.appendChild(l.createElement("br"))}}u=d(D);if(!C.s.editable){I.value=u.filter(":checked").val();u.attr("disabled",true)}else{C.s.parent.bind("sheetKill",function(){I.value=u.filter(":checked").val();x.text(I.value)})}}if(typeof I.value!="object"){J=new p(I.value)}J.html=y;return J},CHECKBOX:function(D){if(d.isArray(D)){D=D[0]}var E=this,z=this.jS,x=this.td,y=(x.children?x.children().detach():""),B,A,w,C,u,F;if((!y.length||E.needsUpdated)){B=z.getTdLocation(E.td);A=d([]);w=d(E.td);u=(this.id!==null?this.id+"checkbox":"checkbox"+this.sheet+"_"+B.row+"_"+B.col+"_"+z.I);A=l.createElement("input");A.setAttribute("type","checkbox");A.setAttribute("name",u);A.setAttribute("id",u);A.className=u;A.value=D;A.onchange=function(){if(d(this).is(":checked")){E.value=D}else{E.value=""}z.calcDependencies.call(E,E.calcDependenciesLast)};if(!z.s.editable){A.setAttribute("disabled","true")}else{z.s.parent.bind("sheetKill",function(){E.value=(E.value=="true"||d(A).is(":checked")?D:"");w.text(E.value)})}y=l.createElement("span");y.className="jSCheckbox";y.appendChild(A);C=l.createElement("span");C.textContent=C.innerText=D;y.appendChild(C);y.appendChild(l.createElement("br"));y.onmousedown=function(){z.cellEdit(w)};y.cell=E;z.controls.inputs[z.i]=z.obj.inputs().add(y);if(D==E.value){A.setAttribute("checked",true);A.onchange()}}F=new p(E.value=="true"||d(A).is(":checked")?D:"");F.html=y;return F},BARCHART:function(v,w,x){var u=new p("");u.html=h.chart.call(this,{type:"bar",data:v,legend:w,title:x});return u},HBARCHART:function(v,w,x){var u=new p("");u.html=h.chart.call(this,{type:"hbar",data:v,legend:w,title:x});return u},LINECHART:function(w,v){var u=new p("");u.html=h.chart.call(this,{type:"line",x:{data:w},y:{data:v},title:""});return u},PIECHART:function(v,w,x){var u=new p("");u.html=h.chart.call(this,{type:"pie",data:v,legend:w,title:x});return u},DOTCHART:function(A,y,v,x,w,z){var u=new p("");u.html=h.chart.call(this,{type:"dot",data:(v?v:A),x:{data:A,legend:x},y:{data:(y?y:A),legend:(w?w:x)},title:z});return u},CELLREF:function(u){return(this.jS.spreadsheets[u]?this.jS.spreadsheets[u]:"Cell Reference Not Found")},CALCTIME:function(x,v){x=x||"";v=v||"";var u=this,w=this.jS;this.jS.s.parent.one("sheetCalculation",function(){w.time.last=w.calcLast;u.td.text(x+w.time.diff()+v)});return""},HLOOKUP:function(A,u,w,D){if(A===undefined){return E}var y=this.jS,C=null,E="",x=u[0],B,z;w=w||1;D=D!==undefined?D:true;if(A!==undefined||((isNaN(A)&&A!="#REF!")||A.length===0)){if(D){C=c.lSearch(x,A)}else{var v=x.indexOf(A);if(v>-1){C=x[v]}}}else{c.getClosestNum(A,x,function(G,F){if(D){C=G}else{if(G==A){C=G}}})}if(C!==null&&(B=C.cell)!==undefined){if(B.td!==undefined){z=y.getTdLocation(B.td);E=y.updateCellValue(B.sheet,z.row,w)}else{E=B.value}}return E},VLOOKUP:function(A,u,w,D){if(A===undefined){return E}var y=this.jS,C=null,E="",x=u[0],B,z;D=D!==undefined?D:true;if((isNaN(A)&&A!="#REF!")||A.length===0){if(D){C=c.lSearch(x,A)}else{var v=x.indexOf(A);if(v>-1){C=x[v]}}}else{c.getClosestNum(A,x,function(G,F){if(D){C=G}else{if(G==A){C=G}}})}if(C!==null&&(B=C.cell)!==undefined){if(B.td!==undefined){z=y.getTdLocation(B.td);E=y.updateCellValue(B.sheet,w,z.col)}else{E=B.value}}return E},THISROWCELL:function(u){var v=this.jS,w=v.getTdLocation(this.td);if(isNaN(u)){u=h.columnLabelIndex(u)}return v.updateCellValue(this.sheet,w.row,u)},THISCOLCELL:function(w){var u=this.jS,v=u.getTdLocation(this.td);return u.updateCellValue(this.sheet,w,v.col)}};var r={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,V:86,X:88,Y:89,Z:90,UNKNOWN:229};var c=f.arrHelpers={math:g,toNumbers:function(u){u=this.flatten(u);var v=u.length-1;if(v<0){return[]}do{if(u[v]){u[v]=d.trim(u[v]);if(isNaN(u[v])){u[v]=0}else{u[v]=u[v]*1}}else{u[v]=0}}while(v--);return u},unique:function(u){var w=[],v=u.length;for(var y=0;y<v;y++){for(var x=y+1;x<v;x++){if(u[y]===u[x]){x=++y}}w.push(u[y])}return w},flatten:function(u){var y=[];for(var w=0,v=u.length;w<v;w++){var x=Object.prototype.toString.call(u[w]).split(" ").pop().split("]").shift().toLowerCase();if(x){y=y.concat(/^(array|collection|arguments|object)$/.test(x)?this.flatten(u[w]):u[w])}}return y},insertAt:function(u,w,v){d(w).each(function(){if(v>-1&&v<=u.length){u.splice(v,0,this)}});return u},closest:function(y,v,w,u){y=y||[];v=v||0;w=w||0;u=u||y.length-1;var x;while(true){x=((w+u)>>1);if(x===u||x===w){return y[x]}if(y[x]>v){u=x}else{if(y[x]<v){w=x}else{return y[x]}}}},getClosestNum:function(w,u,y){var x=0,v,B,A,z;if(u.length){B=u[0];v=x;for(x;x<u.length;x++){A=g.abs(w-B);z=g.abs(w-u[x]);if(z<A){v=x;B=u[x]}A=null;z=null}if(y){return y(B,v)}return B}return false},levenshtein:(function(){var u=[];return function(E,D){if(E===D){return 0}else{var B=E.length,z=D.length;if(B&&z){var w=0,v=0,C,A,y,x,F=u;while(w<B){F[w]=++w}while(v<z){x=D.charCodeAt(v);C=v;++v;A=v;for(w=0;w<B;++w){y=C+(E.charCodeAt(w)===x?0:1);C=F[w];A=A<C?(A<y?A+1:y):(C<y?C+1:y);F[w]=A}}return A}else{return B+z}}}})(),lSearch:function(v,z){var w=0,x,u=v.length,y=-1,A;for(;w<u;w++){x=v[w];A=new s(this.levenshtein(x,z));A.item=x;if(A<y){y=A}}return(A!==undefined?A.item:null)}};var e={dayDiv:86400000,math:g,toCentury:function(u,v){v=v||86400000;return this.math.round(this.math.abs((new a(1900,0,-1))-u)/v)},get:function(v,w){w=w||86400000;if(v.getMonth){return v}else{if(isNaN(v)){return new a(Globalize.parseDate(v))}else{v*=w;var u=(new a(1900,0,-1))*1;v+=u;v=new a(v);return v}}},week:function(u,w){w=w||86400000;var v=new a(u.getFullYear(),0,1);return this.math.ceil((((u-v)/w)+v.getDay()+1)/7)},toString:function(u,v){if(!v){return Globalize.format(u)}return Globalize.format(u,Globalize.culture().calendar.patterns[v])},diff:function(y,v,x,w){w=w||86400000;switch(x){case 0:return this.days360Nasd(y,v,0,true);case 1:case 2:case 3:var u=this.math.abs(v-y)/w;return u;case 4:return this.days360Euro(y,v)}return 0},diffMonths:function(w,v){var u;u=(v.getFullYear()-w.getFullYear())*12;u-=w.getMonth()+1;u+=v.getMonth()+1;return u},days360:function(w,z,x,v,u,y){return((z-w)*360)+((v-x)*30)+(y-u)},days360Nasd:function(v,y,u,w){var x=v.getDate(),C=v.getMonth(),B=v.getFullYear(),A=y.getDate(),z=y.getMonth(),D=y.getFullYear();if((z==2&&this.isEndOfMonth(A,z,D))&&((C==2&&this.isEndOfMonth(x,C,B))||u==3)){A=30}if(A==31&&(x>=30||u==3)){A=30}if(x==31){x=30}if(w&&C==2&&this.isEndOfMonth(x,C,B)){x=30}return this.days360(B,D,C,z,x,A)},days360Euro:function(B,w){var u=B.getDate(),y=B.getMonth(),x=B.getFullYear(),z=w.getDate(),v=w.getMonth(),A=w.getFullYear();if(u==31){u=30}if(z==31){z=30}return this.days360(x,A,y,v,u,z)},isEndOfMonth:function(u,w,v){return u==(new a(v,w+1,0,23,59,59)).getDate()},isLeapYear:function(u){return new a(u,1,29).getMonth()==1},calcAnnualBasis:function(u,w,A){switch(A){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var v=u.getDate(),C=u.getMonth(),z=u.getFullYear(),x=w.getDate(),y=w.getMonth(),D=w.getFullYear(),E=0;if(z==D){if(this.isLeapYear(z)){E=366}else{E=365}}else{if(((D-1)==z)&&((C>y)||((C==y)&&v>=x))){if(this.isLeapYear(z)){if(C<2||(C==2&&v<=29)){E=366}else{E=365}}else{if(this.isLeapYear(D)){if(y>2||(y==2&&x==29)){E=366}else{E=365}}else{E=365}}}else{for(var B=z;B<=D;B++){if(this.isLeapYear(B)){E+=366}else{E+=365}}E=E/(D-z+1)}}return E}return 0},lastDayOfMonth:function(u){u.setDate(0);return u.getDate()},isLastDayOfMonth:function(u){return(u.getDate()==this.lastDayOfMonth(u))}};var i=f.times={math:g,fromMath:function(w){var u={},v=this;u.hour=((w*24)+"").split(".")[0]*1;u.minute=function(x){x=v.math.round(x*24*100)/100;x=(x+"").split(".");var y=0;if(x[1]){if(x[1].length<2){x[1]+="0"}y=x[1]*0.6}return v.math.round(y)}(w);u.second=function(A){A=v.math.round(A*24*10000)/10000;A=(A+"").split(".");var y=0;if(A[1]){for(var z=0;z<4;z++){if(!A[1].charAt(z)){A[1]+="0"}}var x=((A[1]*0.006)+"").split(".");if(x[1]){if(x[1]&&x[1].length>2){x[1]=x[1].substr(0,2)}return v.math.round(x[1]*0.6)}}return y}(w);return u},fromString:function(w,A){var x=new a(),B=w,u,z,y,v,C;if(A){C=B.substr(-2).toLowerCase();B=B.replace(/(am|pm)/i,"")}B=B.split(":");z=B[0]*1;y=B[1]*1;v=(B[2]?B[2]:0)*1;if(A&&C=="pm"){z+=12}return n.TIME(z,y,v)}};d.extend(g,{log10:function(u){return g.log(u)/2.302585092994046},signum:function(u){return(u/g.abs(u))||u},log1p:function(u){var v=0,y=50;if(u<=-1){return"-INF"}if(u<0||u>1){return g.log(1+u)}for(var w=1;w<y;w++){if((w%2)===0){v-=g.pow(u,w)/w}else{v+=g.pow(u,w)/w}}return v}});var m=function(){var A=l,D=d(l.createElement("p")).css({width:"100%",height:"100%"}),C=d(l.createElement("div")).css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(D);d(l.body).append(C);var x=D.width(),z=D.height();C.css("overflow","scroll");var u=D.width(),y=D.height();if(x==u&&C[0].clientWidth){u=C[0].clientWidth}if(z==y&&C[0].clientHeight){y=C[0].clientHeight}C.detach();var B=x-u,v=z-y;return{width:B||15,height:v||15}};var j=function(){var u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",w=d(l.createElement("span")).html(u).appendTo("body"),v={width:w.width()/u.length,height:w.height()};w.remove();return v};var o=function(u,B,w,v,A){v=v||"#"+g.floor(g.random()*16777215).toString(16);if(w){var z=d([]);z=z.add(o(w.left,w.top,null,v,"top-left"));z=z.add(o(w.right,w.top,null,v,"top-right"));z=z.add(o(w.left,w.bottom,null,v,"bottom-left"));z=z.add(o(w.right,w.bottom,null,v,"bottom-right"));return z}return d('<div style="width: 10px; height: 10px; position: absolute;"></div>').css("top",(B-5)+"px").css("left",(u+5)+"px").css("background-color",v).click(function(){console.log(A||"none")}).appendTo("body")};d.printSource=function(v){var u=win.open();u.document.write("<html><body><xmp>"+v+"\n</xmp></body></html>");u.document.close()};if(!Object.getPrototypeOf){Object.getPrototypeOf=function(u){return u||{}}}if(!Array.prototype.indexOf){d.sheet.max=60;Array.prototype.indexOf=function(w,x){for(var v=(x||0),u=this.length;v<u;v++){if(this[v]===w){return v}}return -1}}return k})(jQuery,document,window,Date,String,Number,Boolean,Math,RegExp,Error);var parser=(function(){var S=function(W,V,X,U){for(X=X||{},U=W.length;U--;X[W[U]]=V){}return X},m=[1,5],l=[1,6],k=[1,8],j=[1,9],i=[1,10],h=[1,13],f=[1,11],e=[1,12],d=[1,14],c=[1,15],R=[1,20],Q=[1,18],P=[1,21],O=[1,22],N=[1,17],M=[1,24],L=[1,25],K=[1,26],J=[1,27],I=[1,28],H=[1,29],G=[1,30],F=[1,31],E=[1,32],D=[1,33],C=[4,13,14,15,17,18,19,20,21,22,23,24,36,37],B=[1,36],z=[1,37],y=[1,38],x=[4,13,14,15,17,18,19,20,21,22,23,24,36,37,39],w=[4,13,14,15,17,18,19,20,21,22,23,24,36,37,40],v=[4,13,14,15,17,18,19,20,21,22,23,24,30,36,37],u=[4,14,15,17,18,19,20,21,36,37],t=[1,73],s=[4,14,17,18,19,20,36,37],r=[4,14,15,17,18,19,20,21,22,23,36,37],b=[17,36,37];var A={trace:function q(){},yy:{},symbols_:{error:2,expressions:3,EOF:4,expression:5,variableSequence:6,TIME_AMPM:7,TIME_24:8,number:9,STRING:10,ESCAPED_STRING:11,LETTERS:12,"&":13,"=":14,"+":15,"(":16,")":17,"<":18,">":19,NOT:20,"-":21,"*":22,"/":23,"^":24,E:25,FUNCTION:26,expseq:27,cellRange:28,cell:29,":":30,SHEET:31,"!":32,NUMBER:33,"$":34,REF:35,";":36,",":37,VARIABLE:38,DECIMAL:39,"%":40,"$accept":0,"$end":1},terminals_:{2:"error",4:"EOF",7:"TIME_AMPM",8:"TIME_24",10:"STRING",11:"ESCAPED_STRING",12:"LETTERS",13:"&",14:"=",15:"+",16:"(",17:")",18:"<",19:">",20:"NOT",21:"-",22:"*",23:"/",24:"^",25:"E",26:"FUNCTION",30:":",31:"SHEET",32:"!",33:"NUMBER",34:"$",35:"REF",36:";",37:",",38:"VARIABLE",39:"DECIMAL",40:"%"},productions_:[0,[3,1],[3,2],[5,1],[5,1],[5,1],[5,1],[5,1],[5,1],[5,1],[5,3],[5,3],[5,3],[5,3],[5,4],[5,4],[5,4],[5,3],[5,3],[5,3],[5,3],[5,3],[5,3],[5,3],[5,2],[5,2],[5,1],[5,3],[5,4],[5,1],[28,1],[28,3],[28,3],[28,5],[29,2],[29,3],[29,3],[29,4],[29,1],[29,2],[29,2],[29,2],[29,3],[29,3],[29,3],[29,3],[29,3],[29,3],[29,4],[29,4],[29,4],[27,1],[27,2],[27,2],[27,3],[27,3],[6,1],[6,3],[9,1],[9,3],[9,2]],performAction:function p(W,Z,o,aa,ab,ac,U){var V=ac.length-1;switch(ab){case 1:return null;break;case 2:return ac[V-1];break;case 3:this.$=aa.handler.variable.apply(aa.obj,ac[V]);break;case 4:this.$=aa.handler.time.call(aa.obj,ac[V],true);break;case 5:this.$=aa.handler.time.call(aa.obj,ac[V]);break;case 6:this.$=aa.handler.number(ac[V]);break;case 7:this.$=ac[V].substring(1,ac[V].length-1);break;case 8:this.$=ac[V].substring(2,ac[V].length-2);break;case 9:case 58:this.$=ac[V];break;case 10:this.$=ac[V-2].toString()+ac[V].toString();break;case 11:this.$=aa.handler.callFunction.call(aa.obj,"EQUAL",[ac[V-2],ac[V]]);break;case 12:this.$=aa.handler.performMath("+",ac[V-2],ac[V]);break;case 13:this.$=aa.handler.number(ac[V-1]);break;case 14:this.$=aa.handler.callFunction.call(aa.obj,"LESS_EQUAL",[ac[V-3],ac[V]]);break;case 15:this.$=aa.handler.callFunction.call(aa.obj,"GREATER_EQUAL",[ac[V-3],ac[V]]);break;case 16:this.$=(ac[V-3])!=(ac[V]);if(isNaN(this.$)){this.$=0}break;case 17:this.$=ac[V-2]!=ac[V];break;case 18:this.$=aa.handler.callFunction.call(aa.obj,"GREATER",[ac[V-2],ac[V]]);break;case 19:this.$=aa.handler.callFunction.call(aa.obj,"LESS",[ac[V-2],ac[V]]);break;case 20:this.$=aa.handler.performMath("-",ac[V-2],ac[V]);break;case 21:this.$=aa.handler.performMath("*",ac[V-2],ac[V]);break;case 22:this.$=aa.handler.performMath("/",ac[V-2],ac[V]);break;case 23:var Y=aa.handler.number(ac[V-2]),X=aa.handler.number(ac[V]);this.$=aa.handler.performMath("^",ac[V-2],ac[V]);break;case 24:var Y=aa.handler.numberInverted(ac[V]);this.$=Y;if(isNaN(this.$)){this.$=0}break;case 25:var Y=aa.handler.number(ac[V]);this.$=Y;if(isNaN(this.$)){this.$=0}break;case 26:break;case 27:this.$=aa.handler.callFunction.call(aa.obj,ac[V-2]);break;case 28:this.$=aa.handler.callFunction.call(aa.obj,ac[V-3],ac[V-1]);break;case 30:this.$=aa.handler.cellValue.call(aa.obj,ac[V]);break;case 31:this.$=aa.handler.cellRangeValue.call(aa.obj,ac[V-2],ac[V]);break;case 32:this.$=aa.handler.remoteCellValue.call(aa.obj,ac[V-2],ac[V]);break;case 33:this.$=aa.handler.remoteCellRangeValue.call(aa.obj,ac[V-4],ac[V-2],ac[V]);break;case 34:this.$={colString:ac[V-1],rowString:ac[V]};break;case 35:this.$={colString:ac[V-1],rowString:ac[V]};break;case 36:case 37:this.$={colString:ac[V-2],rowString:ac[V]};break;case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:return"#REF!";break;case 51:this.$=[ac[V]];break;case 54:ac[V-2].push(ac[V]);this.$=ac[V-2];break;case 55:ac[V-2].push(ac[V]);this.$=ac[V-2];break;case 56:this.$=[ac[V]];break;case 57:this.$=($.isArray(ac[V-2])?ac[V-2]:[ac[V-2]]);this.$.push(ac[V]);break;case 59:this.$=(ac[V-2]+"."+ac[V])*1;break;case 60:this.$=ac[V-1]*0.01;break}},table:[{3:1,4:[1,2],5:3,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{1:[3]},{1:[2,1]},{4:[1,23],13:M,14:L,15:K,18:J,19:I,20:H,21:G,22:F,23:E,24:D},S(C,[2,3],{39:[1,34]}),S(C,[2,4]),S(C,[2,5]),S(C,[2,6],{40:[1,35]}),S(C,[2,7]),S(C,[2,8]),S(C,[2,9],{33:B,34:z,35:y}),{5:39,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:40,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:41,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},S(C,[2,26]),{16:[1,42]},S(C,[2,29]),S(x,[2,56]),S(w,[2,58],{39:[1,43]}),S(C,[2,30],{30:[1,44]}),{32:[1,45]},{12:[1,46],35:[1,47]},S(v,[2,38],{33:[1,48],34:[1,50],35:[1,49]}),{1:[2,2]},{5:51,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:52,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:53,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:56,6:4,7:m,8:l,9:7,10:k,11:j,12:i,14:[1,54],15:h,16:f,19:[1,55],21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:58,6:4,7:m,8:l,9:7,10:k,11:j,12:i,14:[1,57],15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:59,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:60,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:61,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:62,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:63,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{38:[1,64]},S(w,[2,60]),S(v,[2,34]),{33:[1,65],35:[1,66]},S(v,[2,40]),{13:M,14:L,15:K,17:[1,67],18:J,19:I,20:H,21:G,22:F,23:E,24:D},S(u,[2,24],{13:M,22:F,23:E,24:D}),S(u,[2,25],{13:M,22:F,23:E,24:D}),{5:70,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,17:[1,68],21:e,25:d,26:c,27:69,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{33:[1,71]},{12:t,29:72,34:P,35:O},{12:t,29:74,34:P,35:O},{33:[1,75],34:[1,76],35:[1,77]},{33:[1,78],34:[1,80],35:[1,79]},S(v,[2,39]),S(v,[2,41]),{33:[1,81],35:[1,82]},S([4,17,36,37],[2,10],{13:M,14:L,15:K,18:J,19:I,20:H,21:G,22:F,23:E,24:D}),S([4,14,17,36,37],[2,11],{13:M,15:K,18:J,19:I,20:H,21:G,22:F,23:E,24:D}),S(u,[2,12],{13:M,22:F,23:E,24:D}),{5:83,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},{5:84,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},S(s,[2,19],{13:M,15:K,21:G,22:F,23:E,24:D}),{5:85,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,28:16,29:19,31:R,33:Q,34:P,35:O,38:N},S(s,[2,18],{13:M,15:K,21:G,22:F,23:E,24:D}),S([4,14,17,20,36,37],[2,17],{13:M,15:K,18:J,19:I,21:G,22:F,23:E,24:D}),S(u,[2,20],{13:M,22:F,23:E,24:D}),S(r,[2,21],{13:M,24:D}),S(r,[2,22],{13:M,24:D}),S([4,14,15,17,18,19,20,21,22,23,24,36,37],[2,23],{13:M}),S(x,[2,57]),S(v,[2,36]),S(v,[2,46]),S(C,[2,13]),S(C,[2,27]),{17:[1,86],36:[1,87],37:[1,88]},S(b,[2,51],{13:M,14:L,15:K,18:J,19:I,20:H,21:G,22:F,23:E,24:D}),S(w,[2,59]),S(C,[2,31]),{33:B,34:z,35:y},S(C,[2,32],{30:[1,89]}),S(v,[2,35]),{33:[1,90]},S(v,[2,43]),S(v,[2,42]),S(v,[2,44]),{33:[1,91],35:[1,92]},S(v,[2,45]),S(v,[2,47]),S(s,[2,14],{13:M,15:K,21:G,22:F,23:E,24:D}),S(s,[2,16],{13:M,15:K,21:G,22:F,23:E,24:D}),S(s,[2,15],{13:M,15:K,21:G,22:F,23:E,24:D}),S(C,[2,28]),S(b,[2,52],{6:4,9:7,28:16,29:19,5:93,7:m,8:l,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,31:R,33:Q,34:P,35:O,38:N}),S(b,[2,53],{6:4,9:7,28:16,29:19,5:94,7:m,8:l,10:k,11:j,12:i,15:h,16:f,21:e,25:d,26:c,31:R,33:Q,34:P,35:O,38:N}),{12:t,29:95,34:P,35:O},S(v,[2,37]),S(v,[2,48]),S(v,[2,50]),S(b,[2,54],{13:M,14:L,15:K,18:J,19:I,20:H,21:G,22:F,23:E,24:D}),S(b,[2,55],{13:M,14:L,15:K,18:J,19:I,20:H,21:G,22:F,23:E,24:D}),S(C,[2,33])],defaultActions:{2:[2,1],23:[2,2]},parseError:function g(U,o){if(o.recoverable){this.trace(U)}else{throw new Error(U)}},parse:function n(W){var ad=this,am=[0],ah=[],aj=[null],ae=[],al=this.table,az="",ac=0,aB=0,aq=0,aC=2,an=1;var av=ae.slice.call(arguments,1);var ax=Object.create(this.lexer);var ar={yy:{}};for(var ay in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,ay)){ar.yy[ay]=this.yy[ay]}}ax.setInput(W,ar.yy);ar.yy.lexer=ax;ar.yy.parser=this;if(typeof ax.yylloc=="undefined"){ax.yylloc={}}var at=ax.yylloc;ae.push(at);var ai=ax.options&&ax.options.ranges;if(typeof ar.yy.parseError==="function"){this.parseError=ar.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function Z(aE){am.length=am.length-2*aE;aj.length=aj.length-aE;ae.length=ae.length-aE}_token_stack:function ag(){var aE;aE=ax.lex()||an;if(typeof aE!=="number"){aE=ad.symbols_[aE]||aE}return aE}var af,ab,aD,V,aA,au,aa={},aw,ak,U,ap;while(true){aD=am[am.length-1];if(this.defaultActions[aD]){V=this.defaultActions[aD]}else{if(af===null||typeof af=="undefined"){af=ag()}V=al[aD]&&al[aD][af]}_handle_error:if(typeof V==="undefined"||!V.length||!V[0]){var Y;var X="";function o(aF){var aE=am.length-1;var aG=0;for(;;){if((aC.toString()) in al[aF]){return aG}if(aF===0||aE<2){return false}aE-=2;aF=am[aE];++aG}}if(!aq){Y=o(aD);ap=[];for(aw in al[aD]){if(this.terminals_[aw]&&aw>aC){ap.push("'"+this.terminals_[aw]+"'")}}if(ax.showPosition){X="Parse error on line "+(ac+1)+":\n"+ax.showPosition()+"\nExpecting "+ap.join(", ")+", got '"+(this.terminals_[af]||af)+"'"}else{X="Parse error on line "+(ac+1)+": Unexpected "+(af==an?"end of input":("'"+(this.terminals_[af]||af)+"'"))}var ao=this.parseError(X,{text:ax.match,token:this.terminals_[af]||af,line:ax.yylineno,loc:at,expected:ap,recoverable:(Y!==false)});if(this.done){if(ao===undefined){return X}else{return ao}}}else{if(ab!==an){Y=o(aD)}}if(aq==3){if(af===an||ab===an){throw new Error(X||"Parsing halted while starting to recover from another error.")}aB=ax.yyleng;az=ax.yytext;ac=ax.yylineno;at=ax.yylloc;af=ag()}if(Y===false){throw new Error(X||"Parsing halted. No suitable error recovery rule available.")}Z(Y);ab=(af==aC?null:af);af=aC;aD=am[am.length-1];V=al[aD]&&al[aD][aC];aq=3}if(V[0] instanceof Array&&V.length>1){throw new Error("Parse Error: multiple actions possible at state: "+aD+", token: "+af)}switch(V[0]){case 1:am.push(af);aj.push(ax.yytext);ae.push(ax.yylloc);am.push(V[1]);af=null;if(!ab){aB=ax.yyleng;az=ax.yytext;ac=ax.yylineno;at=ax.yylloc;if(aq>0){aq--}}else{af=ab;ab=null}break;case 2:ak=this.productions_[V[1]][1];aa.$=aj[aj.length-ak];aa._$={first_line:ae[ae.length-(ak||1)].first_line,last_line:ae[ae.length-1].last_line,first_column:ae[ae.length-(ak||1)].first_column,last_column:ae[ae.length-1].last_column};if(ai){aa._$.range=[ae[ae.length-(ak||1)].range[0],ae[ae.length-1].range[1]]}au=this.performAction.apply(aa,[az,aB,ac,ar.yy,V[1],aj,ae].concat(av));if(typeof au!=="undefined"){return au}if(ak){am=am.slice(0,-1*ak*2);aj=aj.slice(0,-1*ak);ae=ae.slice(0,-1*ak)}am.push(this.productions_[V[1]][0]);aj.push(aa.$);ae.push(aa._$);U=al[am[am.length-2]][am[am.length-1]];am.push(U);break;case 3:return true}}return true}};if(typeof(window)!=="undefined"){window.Formula=function(V){var W=function(){};W.prototype=A.lexer;var U=function(){this.lexer=new W();this.yy={parseError:function(Z,Y){this.done=true;var X=new String(Z);X.hash=Y;return X},lexerError:function(Z,Y){this.done=true;var X=new String(Z);X.hash=Y;return X}}};U.prototype=A;var o=new U;o.setObj=function(X){o.yy.obj=X};o.yy.handler=V;return o}}var T=(function(){var V=({EOF:1,parseError:function W(ae,ad){if(this.yy.parser){this.yy.parser.parseError(ae,ad)}else{throw new Error(ae)}},setInput:function(ad,ae){this.yy=ae||this.yy||{};this._input=ad;this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var ae=this._input[0];this.yytext+=ae;this.yyleng++;this.offset++;this.match+=ae;this.matched+=ae;var ad=ae.match(/(?:\r\n?|\n).*/g);if(ad){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return ae},unput:function(af){var ad=af.length;var ae=af.split(/(?:\r\n?|\n)/g);this._input=af+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-ad);this.offset-=ad;var ah=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(ae.length-1){this.yylineno-=ae.length-1}var ag=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:ae?(ae.length===ah.length?this.yylloc.first_column:0)+ah[ah.length-ae.length].length-ae[0].length:this.yylloc.first_column-ad};if(this.options.ranges){this.yylloc.range=[ag[0],ag[0]+this.yyleng-ad]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(ad){this.unput(this.match.slice(ad))},pastInput:function(){var ad=this.matched.substr(0,this.matched.length-this.match.length);return(ad.length>20?"...":"")+ad.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var ad=this.match;if(ad.length<20){ad+=this._input.substr(0,20-ad.length)}return(ad.substr(0,20)+(ad.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var ad=this.pastInput();var ae=new Array(ad.length+1).join("-");return ad+this.upcomingInput()+"\n"+ae+"^"},test_match:function(ah,af){var ai,ad,ag;if(this.options.backtrack_lexer){ag={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){ag.yylloc.range=this.yylloc.range.slice(0)}}ad=ah[0].match(/(?:\r\n?|\n).*/g);if(ad){this.yylineno+=ad.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:ad?ad[ad.length-1].length-ad[ad.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+ah[0].length};this.yytext+=ah[0];this.match+=ah[0];this.matches=ah;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input=this._input.slice(ah[0].length);this.matched+=ah[0];ai=this.performAction.call(this,this.yy,this,af,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(ai){return ai}else{if(this._backtrack){for(var ae in ag){this[ae]=ag[ae]}return false}}return false},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var ah,af,ad,ae;if(!this._more){this.yytext="";this.match=""}var ai=this._currentRules();for(var ag=0;ag<ai.length;ag++){ad=this._input.match(this.rules[ai[ag]]);if(ad&&(!af||ad[0].length>af[0].length)){af=ad;ae=ag;if(this.options.backtrack_lexer){ah=this.test_match(ad,ai[ag]);if(ah!==false){return ah}else{if(this._backtrack){af=false;continue}else{return false}}}else{if(!this.options.flex){break}}}}if(af){ah=this.test_match(af,ai[ae]);if(ah!==false){return ah}return false}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function o(){var ad=this.next();if(ad){return ad}else{return this.lex()}},begin:function U(ad){this.conditionStack.push(ad)},popState:function X(){var ad=this.conditionStack.length-1;if(ad>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function ac(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions.INITIAL.rules}},topState:function aa(ad){ad=this.conditionStack.length-1-Math.abs(ad||0);if(ad>=0){return this.conditionStack[ad]}else{return"INITIAL"}},pushState:function Z(ad){this.begin(ad)},stateStackSize:function Y(){return this.conditionStack.length},options:{},performAction:function ab(ah,ae,ag,ad){var af=ad;switch(ag){case 0:break;case 1:return 26;break;case 2:return 7;break;case 3:return 8;break;case 4:if(ah.obj.type=="cell"){return 31}return 38;break;case 5:ae.yytext=ae.yytext.substring(1,ae.yytext.length-1);if(ah.obj.type=="cell"){return 31}return 38;break;case 6:return 10;break;case 7:return 10;break;case 8:return 11;break;case 9:return 11;break;case 10:return 12;break;case 11:return 38;break;case 12:return 38;break;case 13:return 33;break;case 14:return 34;break;case 15:return 13;break;case 16:return" ";break;case 17:return 39;break;case 18:return 30;break;case 19:return 36;break;case 20:return 37;break;case 21:return 22;break;case 22:return 23;break;case 23:return 21;break;case 24:return 15;break;case 25:return 24;break;case 26:return 16;break;case 27:return 17;break;case 28:return 19;break;case 29:return 18;break;case 30:return 20;break;case 31:return"PI";break;case 32:return 25;break;case 33:return'"';break;case 34:return"'";break;case 35:return'"';break;case 36:return"'";break;case 37:return"!";break;case 38:return 14;break;case 39:return 40;break;case 40:return 35;break;case 41:return"#";break;case 42:return 4;break}},rules:[/^(?:\s+)/,/^(?:([A-Za-z]{1,})([A-Za-z_0-9]+)?(?=[(]))/,/^(?:([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm))/,/^(?:([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?)/,/^(?:(([A-Za-z0-9]+))(?=[!]))/,/^(?:((['](\\[']|[^'])*['])|(["](\\["]|[^"])*["]))(?=[!]))/,/^(?:((['](\\[']|[^'])*['])))/,/^(?:((["](\\["]|[^"])*["])))/,/^(?:(([\\]['].+?[\\]['])))/,/^(?:(([\\]["].+?[\\]["])))/,/^(?:[A-Z]+(?=[0-9$]))/,/^(?:[A-Za-z]{1,}[A-Za-z_0-9]+)/,/^(?:[A-Za-z_]+)/,/^(?:[0-9]+)/,/^(?:\$)/,/^(?:&)/,/^(?: )/,/^(?:[.])/,/^(?::)/,/^(?:;)/,/^(?:,)/,/^(?:\*)/,/^(?:\/)/,/^(?:-)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:>)/,/^(?:<)/,/^(?:NOT\b)/,/^(?:PI\b)/,/^(?:E\b)/,/^(?:")/,/^(?:')/,/^(?:\\")/,/^(?:\\')/,/^(?:!)/,/^(?:=)/,/^(?:%)/,/^(?:#REF!)/,/^(?:[#])/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],inclusive:true}}});return V})();A.lexer=T;function a(){this.yy={}}a.prototype=A;A.Parser=a;return new a})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)};exports.main=function commonjsMain(a){if(!a[1]){console.log("Usage: "+a[0]+" FILE");process.exit(1)}var b=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(b)};if(typeof module!=="undefined"&&require.main===module){exports.main(process.argv.slice(1))}}var parser=(function(){var n=function(w,u,x,t){for(x=x||{},t=w.length;t--;x[w[t]]=u){}return x},l=[1,10],j=[1,11],i=[1,12],h=[1,13],g=[5,7,8,9,10],f=[1,19],c=[1,20],a=[5,7,8,9,10,12,13],s=[1,21],r=[5,7,8,9,10,12,13,14,16];var k={trace:function p(){},yy:{},symbols_:{error:2,grid:3,rows:4,EOF:5,row:6,END_OF_LINE:7,END_OF_LINE_WITH_EMPTY_NEXT_FIRST_COLUMN:8,END_OF_LINE_WITH_NO_COLUMNS:9,END_OF_LINE_WITH_EMPTY_COLUMN:10,string:11,COLUMN_EMPTY:12,COLUMN_STRING:13,CHAR:14,QUOTE_ON:15,QUOTE_OFF:16,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",7:"END_OF_LINE",8:"END_OF_LINE_WITH_EMPTY_NEXT_FIRST_COLUMN",9:"END_OF_LINE_WITH_NO_COLUMNS",10:"END_OF_LINE_WITH_EMPTY_COLUMN",12:"COLUMN_EMPTY",13:"COLUMN_STRING",14:"CHAR",15:"QUOTE_ON",16:"QUOTE_OFF"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,3],[4,3],[4,3],[4,3],[6,1],[6,1],[6,2],[6,3],[6,1],[6,2],[6,3],[11,1],[11,2],[11,3]],performAction:function e(o,v,w,z,y,u,x){var t=u.length-1;switch(y){case 1:return u[t-1];break;case 2:return[[""]];break;case 3:this.$=[u[t]];break;case 4:this.$=[];break;case 5:this.$=[""];break;case 6:this.$=[""];break;case 7:this.$=[""];break;case 8:this.$=u[t-1];break;case 9:u[t-1].push([""]);this.$=u[t-1];break;case 10:u[t-1].push([""]);this.$=u[t-1];break;case 11:u[t-1][u[t-1].length-1].push("");this.$=u[t-1];break;case 12:u[t-2].push(u[t]);this.$=u[t-2];break;case 13:u[t].unshift("");u[t-2].push(u[t]);this.$=u[t-2];break;case 14:u[t-2].push([""]);u[t-2].push(u[t]);this.$=u[t-2];break;case 15:u[t-2][u[t-2].length-1].push("");u[t-2].push(u[t]);this.$=u[t-2];break;case 16:this.$=[u[t].join("")];break;case 17:this.$=[""];break;case 18:u[t-1].push("");this.$=u[t-1];break;case 19:u[t-2].push("");u[t-2].push(u[t].join(""));this.$=u[t-2];break;case 20:break;case 21:break;case 22:u[t-2].push(u[t].join(""));this.$=u[t-2];break;case 23:this.$=[u[t]];break;case 24:u[t-1].push(u[t]);this.$=u[t-1];break;case 25:this.$=u[t-1];break}},table:[{3:1,4:2,5:[1,3],6:4,7:[1,5],8:[1,6],9:[1,7],10:[1,8],11:9,12:l,13:j,14:i,15:h},{1:[3]},{5:[1,14],7:[1,15],8:[1,16],9:[1,17],10:[1,18]},{1:[2,2]},n(g,[2,3],{12:f,13:c}),n(g,[2,4]),n(g,[2,5]),n(g,[2,6]),n(g,[2,7]),n(a,[2,16],{14:s}),n(a,[2,17]),n(a,[2,20]),n(r,[2,23]),{11:22,14:i,15:h},{1:[2,1]},n(g,[2,8],{11:9,6:23,12:l,13:j,14:i,15:h}),n(g,[2,9],{11:9,6:24,12:l,13:j,14:i,15:h}),n(g,[2,10],{11:9,6:25,12:l,13:j,14:i,15:h}),n(g,[2,11],{11:9,6:26,12:l,13:j,14:i,15:h}),n(a,[2,18],{11:27,14:i,15:h}),n(a,[2,21],{11:28,14:i,15:h}),n(r,[2,24]),{14:s,16:[1,29]},n(g,[2,12],{12:f,13:c}),n(g,[2,13],{12:f,13:c}),n(g,[2,14],{12:f,13:c}),n(g,[2,15],{12:f,13:c}),n(a,[2,19],{14:s}),n(a,[2,22],{14:s}),n(r,[2,25])],defaultActions:{3:[2,2],14:[2,1]},parseError:function q(t,o){if(o.recoverable){this.trace(t)}else{throw new Error(t)}},parse:function m(D){var L=this,A=[0],K=[],V=[null],F=[],X=this.table,u="",E=0,T=0,w=0,C=2,J=1;var x=F.slice.call(arguments,1);var o=Object.create(this.lexer);var W={yy:{}};for(var S in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,S)){W.yy[S]=this.yy[S]}}o.setInput(D,W.yy);W.yy.lexer=o;W.yy.parser=this;if(typeof o.yylloc=="undefined"){o.yylloc={}}var v=o.yylloc;F.push(v);var y=o.options&&o.options.ranges;if(typeof W.yy.parseError==="function"){this.parseError=W.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function I(Z){A.length=A.length-2*Z;V.length=V.length-Z;F.length=F.length-Z}_token_stack:function H(){var Z;Z=o.lex()||J;if(typeof Z!=="number"){Z=L.symbols_[Z]||Z}return Z}var R,N,z,Q,Y,G,P={},M,U,t,B;while(true){z=A[A.length-1];if(this.defaultActions[z]){Q=this.defaultActions[z]}else{if(R===null||typeof R=="undefined"){R=H()}Q=X[z]&&X[z][R]}if(typeof Q==="undefined"||!Q.length||!Q[0]){var O="";B=[];for(M in X[z]){if(this.terminals_[M]&&M>C){B.push("'"+this.terminals_[M]+"'")}}if(o.showPosition){O="Parse error on line "+(E+1)+":\n"+o.showPosition()+"\nExpecting "+B.join(", ")+", got '"+(this.terminals_[R]||R)+"'"}else{O="Parse error on line "+(E+1)+": Unexpected "+(R==J?"end of input":"'"+(this.terminals_[R]||R)+"'")}this.parseError(O,{text:o.match,token:this.terminals_[R]||R,line:o.yylineno,loc:v,expected:B})}if(Q[0] instanceof Array&&Q.length>1){throw new Error("Parse Error: multiple actions possible at state: "+z+", token: "+R)}switch(Q[0]){case 1:A.push(R);V.push(o.yytext);F.push(o.yylloc);A.push(Q[1]);R=null;if(!N){T=o.yyleng;u=o.yytext;E=o.yylineno;v=o.yylloc;if(w>0){w--}}else{R=N;N=null}break;case 2:U=this.productions_[Q[1]][1];P.$=V[V.length-U];P._$={first_line:F[F.length-(U||1)].first_line,last_line:F[F.length-1].last_line,first_column:F[F.length-(U||1)].first_column,last_column:F[F.length-1].last_column};if(y){P._$.range=[F[F.length-(U||1)].range[0],F[F.length-1].range[1]]}G=this.performAction.apply(P,[u,T,E,W.yy,Q[1],V,F].concat(x));if(typeof G!=="undefined"){return G}if(U){A=A.slice(0,-1*U*2);V=V.slice(0,-1*U);F=F.slice(0,-1*U)}A.push(this.productions_[Q[1]][0]);V.push(P.$);F.push(P._$);t=X[A[A.length-2]][A[A.length-1]];A.push(t);break;case 3:return true}}return true}};if(typeof GLOBAL!=="undefined"){GLOBAL.window=GLOBAL}if(typeof window.TSV==="undefined"){var m=k.parse;k.parse=function(o){var t=this.lexer.setInput;this.lexer.setInput=function(u){t.call(this,u);this.begin("BOF");return this};this.parse=m;return m.call(this,o)};window.TSV=function(t){var v=function(){};v.prototype=k.lexer;var u=function(){this.lexer=new v();this.yy={}};u.prototype=k;var o=new u;o.setObj=function(w){o.yy.obj=w};o.yy.handler=t;return o}}var b=(function(){var u=({EOF:1,parseError:function v(D,C){if(this.yy.parser){this.yy.parser.parseError(D,C)}else{throw new Error(D)}},setInput:function(C,D){this.yy=D||this.yy||{};this._input=C;this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var D=this._input[0];this.yytext+=D;this.yyleng++;this.offset++;this.match+=D;this.matched+=D;var C=D.match(/(?:\r\n?|\n).*/g);if(C){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return D},unput:function(E){var C=E.length;var D=E.split(/(?:\r\n?|\n)/g);this._input=E+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-C);this.offset-=C;var G=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(D.length-1){this.yylineno-=D.length-1}var F=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:D?(D.length===G.length?this.yylloc.first_column:0)+G[G.length-D.length].length-D[0].length:this.yylloc.first_column-C};if(this.options.ranges){this.yylloc.range=[F[0],F[0]+this.yyleng-C]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(C){this.unput(this.match.slice(C))},pastInput:function(){var C=this.matched.substr(0,this.matched.length-this.match.length);return(C.length>20?"...":"")+C.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var C=this.match;if(C.length<20){C+=this._input.substr(0,20-C.length)}return(C.substr(0,20)+(C.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var C=this.pastInput();var D=new Array(C.length+1).join("-");return C+this.upcomingInput()+"\n"+D+"^"},test_match:function(G,E){var H,C,F;if(this.options.backtrack_lexer){F={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){F.yylloc.range=this.yylloc.range.slice(0)}}C=G[0].match(/(?:\r\n?|\n).*/g);if(C){this.yylineno+=C.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:C?C[C.length-1].length-C[C.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+G[0].length};this.yytext+=G[0];this.match+=G[0];this.matches=G;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input=this._input.slice(G[0].length);this.matched+=G[0];H=this.performAction.call(this,this.yy,this,E,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(H){return H}else{if(this._backtrack){for(var D in F){this[D]=F[D]}return false}}return false},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var G,E,C,D;if(!this._more){this.yytext="";this.match=""}var H=this._currentRules();for(var F=0;F<H.length;F++){C=this._input.match(this.rules[H[F]]);if(C&&(!E||C[0].length>E[0].length)){E=C;D=F;if(this.options.backtrack_lexer){G=this.test_match(C,H[F]);if(G!==false){return G}else{if(this._backtrack){E=false;continue}else{return false}}}else{if(!this.options.flex){break}}}}if(E){G=this.test_match(E,H[D]);if(G!==false){return G}return false}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function o(){var C=this.next();if(C){return C}else{return this.lex()}},begin:function t(C){this.conditionStack.push(C)},popState:function w(){var C=this.conditionStack.length-1;if(C>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function B(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions.INITIAL.rules}},topState:function z(C){C=this.conditionStack.length-1-Math.abs(C||0);if(C>=0){return this.conditionStack[C]}else{return"INITIAL"}},pushState:function y(C){this.begin(C)},stateStackSize:function x(){return this.conditionStack.length},options:{},performAction:function A(G,D,F,C){var E=C;switch(F){case 0:return 14;break;case 1:this.popState();return 16;break;case 2:if(D.yytext==this.quoteChar){this.popState();this.begin("STRING");return 16}else{return 14}break;case 3:this.popState();this.begin("STRING");return 14;break;case 4:this.popState();this.quoteChar=D.yytext.substring(0);this.begin("QUOTE");return 15;break;case 5:this.quoteChar=D.yytext;this.popState();this.begin("QUOTE");return 15;break;case 6:this.begin("PRE_QUOTE");return 13;break;case 7:this.begin("PRE_QUOTE");return 7;break;case 8:return 14;break;case 9:this.popState();return 8;break;case 10:this.popState();return 9;break;case 11:this.popState();return 7;break;case 12:this.popState();return 13;break;case 13:return 14;break;case 14:this.popState();break;case 15:return"BUFFIN";break;case 16:return 9;break;case 17:return 10;break;case 18:return 12;break;case 19:return 7;break;case 20:this.begin("STRING");return 14;break;case 21:return 5;break}},rules:[/^(?:(\n|\\n))/,/^(?:([\'\"])(?=$))/,/^(?:([\'\"]))/,/^(?:(?=(\t)))/,/^(?:([\'\"]))/,/^(?:([\'\"]))/,/^(?:(\t|\\t)(?=[\'\"]))/,/^(?:(\n|\\n)(?=[\'\"]))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:(\n\t|\\n\\t))/,/^(?:(\n\n|\\n\\n))/,/^(?:(\n|\\n))/,/^(?:(\t|\\t))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:)/,/^(?:(\n\t|\\n\\t)(?=.))/,/^(?:(\n\n|\\n\\n))/,/^(?:(\t\n))/,/^(?:(\t))/,/^(?:(\n))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:$)/],conditions:{BOF:{rules:[4,6,7,14,15,16,17,18,19,20,21],inclusive:true},PRE_QUOTE:{rules:[5,6,7,15,16,17,18,19,20,21],inclusive:true},QUOTE:{rules:[0,1,2,3,6,7,8,15,16,17,18,19,20,21],inclusive:true},STRING:{rules:[6,7,9,10,11,12,13,15,16,17,18,19,20,21],inclusive:true},INITIAL:{rules:[6,7,15,16,17,18,19,20,21],inclusive:true}}});return u})();k.lexer=b;function d(){this.yy={}}d.prototype=k;k.Parser=d;return new d})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)};exports.main=function commonjsMain(a){if(!a[1]){console.log("Usage: "+a[0]+" FILE");process.exit(1)}var b=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(b)};if(typeof module!=="undefined"&&require.main===module){exports.main(process.argv.slice(1))}};